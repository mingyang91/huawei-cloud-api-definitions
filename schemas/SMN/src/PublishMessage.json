{"base_path":"/","components":null,"consumes":"[\"application/json;charset=UTF-8\"]","definitions":{"FailedResp":{"properties":{"code":{"description":"服务异常错误信息编码。","example":"SMN.0167","type":"string"},"message":{"description":"服务异常错误信息描述。","example":"xxxxxxxx","type":"string"},"request_id":{"description":"请求的唯一标识ID。","example":"6a63a18b8bab40ffb71ebd9cb80d0085","type":"string"}},"required":["request_id","code","message"]},"MessageAttribute":{"description":"消息属性","properties":{"name":{"description":"属性名称。属性名称只能包含小写英文字母([a-z])、数字([0-9])、下划线(_),下划线不能出现在开始或结尾,下划线不能连续出现,长度为1到32个字符","example":"smn_protocol","maxLength":32,"minLength":1,"pattern":"^[a-z0-9](?!.*?_{2,})([a-z0-9_]{0,30}[a-z0-9])?$","type":"string"},"type":{"description":"属性类型\nSTRING:字符串(String)类型\nSTRING_ARRAY:字符串数组(String.Array)类型\nPROTOCOL:协议类型","enum":["STRING","STRING_ARRAY","PROTOCOL"],"example":"PROTOCOL","type":"string"},"value":{"description":"属性值。\n当属性类型为“STRING”时,属性值只能包含中英文、数字、下划线,长度为1到32个字符。\n当属性类型为“STRING_ARRAY”时,属性值为字符串数组,数组长度为1到10,数组中的元素内容不能重复,数组中的每个字符串都只能包含中英文、数字、下划线,且长度为1到32个字符。\n当属性类型为“PROTOCOL”时,属性值为支持协议类型的字符串数组。","example":"[\"email\",\"sms\"]","type":"object"}},"required":["name","type","value"],"type":"object"},"PublishMessageRequestBody":{"properties":{"locale":{"description":"语言,发送出去的消息中SMN附加系统内容的语言,若没传入,使用账号的语言。取值范围是该局点支持的语言,比如:zh-cn,en-us等","example":"zh-cn","type":"string"},"message":{"description":"发送的消息。消息体必须是UTF-8编码的字符串,大小至多256KB。如果订阅者是手机号码,短信长度限制为490字,超出则可能被运营商拦截。短信内容不能包含“[]”或者“【】”符号。\n说明:\n三种消息发送方式:message、message_structure、message_template_name\n\n至少设置其中一个,如果同时设置,生效的优先级为\nmessage_structure > message_template_name > message。","example":"Message test message v2","type":"string"},"message_attributes":{"description":"消息属性列表","items":{"$ref":"#/definitions/MessageAttribute"},"maxItems":10,"minItems":0,"type":"array"},"message_structure":{"description":"Json格式的字符串。支持“email”、“sms”、“http”、“https”、“functiongraph”、“functionstage”、“dingding”、“wechat”、“feishu”、“welink”、“dingTalkBot”。必须设置默认的消息“default”,当匹配不到消息协议时,按“default”中的内容发送。\n - 其中,钉钉、微信、飞书、welink、dingTalkBot协议类型的消息需指定msgType字段;钉钉,微信和飞书机器人协议支持msgType为text(纯文本)和markdown(MD)格式消息,welink机器人类型暂仅支持msgType为text的纯文本消息。\n\n - 企业微信机器人对消息长度的限制请参考[官方文档](https://developer.work.weixin.qq.com/document/path/91770)。\n\n- 钉钉机器人协议支持通过at字段实现@群组成员。当您需要@群成员时,可以在isAtAll字段中传入布尔值,表示是否需要@群组内所有人。您可以在atMobiles字段中传入需要@的人的手机号列表,或在atUserIds字段中传入需要@的钉钉userID列表。当您使用atMobiles字段或atUserIds字段时,需要在消息内容中同时传入@对应手机号或userID的信息。展示效果请参考钉钉[官方文档](https://open.dingtalk.com/document/orgapp/custom-robots-send-group-messages)。钉钉群机器人消息限制在20000bytes以内,详情请参考[钉钉官方文档](https://open.dingtalk.com/document/orgapp/custom-robot-access)描述。\n\n- 飞书机器人协议的markdown消息支持通过传入color字段设置标题的底色。能够支持的color字段可参考飞书[官方文档](https://open.feishu.cn/document/common-capabilities/message-card/message-cards-content/card-header)。飞书群机器人消息限制在30KB以内,详情请参考[飞书官方文档](https://feishu.apifox.cn/doc-1944903)描述。\n\n - 个人钉钉消息对长度的限制请参考[官方文档](https://open.dingtalk.com/document/orgapp/the-robot-sends-a-group-message)。\n\n说明:\n三种消息发送方式:message、message_structure、message_template_name\n\n至少设置其中一个,如果同时设置,生效的优先级为\nmessage_structure > message_template_name > message。","example":"{   \"default\": \"Message structure test message v2\",   \"sms\": \"Message structure test message v2\",   \"email\": \"Message structure test message v2\",   \"wechat\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"dingding\": \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"at\\\":{\\\"atMobiles\\\": [\\\"15XXXXXX\\\"],\\\"atUserIds\\\": [\\\"1234567XXX\\\"],\\\"isAtAll\\\": true},\\\"markdown\\\":{\\\"content\\\":\\\"Message structure test message v2 @15XXXXXX @1234567XXX\\\",\\\"title\\\":\\\"Message structure title\\\"}}\",   \"feishu\": \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"color\\\":\\\"blue\\\",\\\"markdown\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"welinkRed\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"http\": \"Message structure test message v2\",   \"https\": \"Message structure test message v2\",   \"dingTalkBot\": \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"markdown\\\":{\\\"content\\\":\\\"Message structure test message v2 dingTalkBot markdown\\\",\\\"title\\\":\\\"Message structure title\\\"}}\",   \"functionstage\": \"Message structure test message v2\" }","type":"string"},"message_template_name":{"description":"消息模板名称,可通过[查询消息模板列表](ListMessageTemplates.xml)获取名称。\n\n说明:\n三种消息发送方式:message、message_structure、message_template_name\n\n至少设置其中一个,如果同时设置,生效的优先级为\nmessage_structure > message_template_name > message。","example":"confirm_message","type":"string"},"subject":{"description":"消息标题,给邮箱订阅者发送邮件时作为邮件主题,长度不能超过512个字节。","example":"test message v2","type":"string"},"tags":{"additionalProperties":{"type":"string"},"description":"tag以及替换tag的参数组成的字典。消息模板中的标签对应的值。使用消息模板方式的消息发布必须携带该参数。字典中的key为消息模板中的参数名称,不超过21个字符。字典中的value为消息模板中的参数被替换后的值,不超过1KB。","example":{"topic_id":"topic_id3332","topic_urn":"topic_urn3331"},"type":"object"},"time_to_live":{"description":"指消息在SMN系统内部的最长存留时间。超过该存留时间,系统将不再发送该消息。单位是s,变量默认值是3600s,即一小时。值为正整数且小于等于3600*24。","example":"3600","type":"string"}},"type":"object"},"PublishMessageResponseBody":{"properties":{"message_id":{"description":"唯一的消息ID。","example":"bf94b63a5dfb475994d3ac34664e24f2","type":"string"},"request_id":{"description":"请求的唯一标识ID。","example":"9974c07f6d554a6d827956acbeb4be5f","type":"string"}},"required":["request_id","message_id"]}},"description":null,"group_id":"28d7e20abf9b4048b20fdaf3ce746d32","host":"smn.cn-north-4.myhuaweicloud.com","id":"206d8c97d7e24114aa5d806581591eb4","info_version":"v2","method":"post","name":"PublishMessage","parameters":{"X-Auth-Token":{"description":"用户Token。\n\n通过调用IAM服务获取用户Token接口获取(响应消息头中X-Subject-Token的值)。","in":"header","name":"X-Auth-Token","required":true,"type":"string","x-example":"MIIDkgYJKoZIhvcNAQcCoIIDgzCCXXXXXX..."}},"paths":{"/v2/{project_id}/notifications/topics/{topic_urn}/publish":{"post":{"description":"将消息发送给Topic的所有订阅端点。当返回消息ID时,该消息已被保存并开始尝试将其推送给Topic的订阅者。为确保您的消息能够成功推送到各个订阅者,请确保您的消息内容符合当地法律法规要求。\n三种消息发送方式\n\nmessage\n\nmessage_structure\n\nmessage_template_name\n\n只需要设置其中一个,如果同时设置,生效的优先级为\nmessage_structure > message_template_name > message。","operationId":"PublishMessage","parameters":[{"description":"项目ID。\n\n获取项目ID请参考 [获取项目ID](smn_api_66000.xml)。","in":"path","name":"project_id","required":true,"type":"string","x-example":"2c31ed520xxxxxxebedb6e81xxxxxxxx"},{"description":"Topic的唯一的资源标识,可通过[查询主题列表](smn_api_51004.xml)获取该标识。","in":"path","name":"topic_urn","required":true,"type":"string","x-example":"urn:smn:regionId:f96188c7ccaf4ffba0c9aa149ab2bd57:test_topic_v2"},{"$ref":"#/parameters/X-Auth-Token"},{"in":"body","name":"PublishMessageRequestBody","required":false,"schema":{"$ref":"#/definitions/PublishMessageRequestBody"}}],"responses":{"200":{"description":"OK","examples":{"application/json":{"message_id":"bf94b63a5dfb475994d3ac34664e24f2","request_id":"6a63a18b8bab40ffb71ebd9cb80d0085"}},"schema":{"$ref":"#/definitions/PublishMessageResponseBody"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/FailedResp"}},"403":{"description":"Unauthorized","schema":{"$ref":"#/definitions/FailedResp"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/FailedResp"}},"429":{"description":"Too Many Requests","schema":{"$ref":"#/definitions/FailedResp"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/FailedResp"}}},"summary":"消息发布","tags":["发布消息操作"],"x-apiexplorer-hide":"N","x-iftype":"externalAPI","x-is-registered":"Y","x-name":"消息发布","x-open-region-cloud":"hk,hc,hcso,fcs,hk_vdf,ctc,cmcc,otc,ocb,hws_ocb,g42,tm,sbc,hk_g42,hk_tm,hk_sbc,srg","x-request-examples-1":{"message":"Message test message v2","message_attributes":[{"name":"smn_protocol","type":"PROTOCOL","value":["email","sms"]}],"subject":"test message v2","time_to_live":"3600"},"x-request-examples-2":{"message_attributes":[{"name":"smn_protocol","type":"PROTOCOL","value":["email","sms"]}],"message_structure":"{   \"default\": \"Message structure test message v2\",   \"sms\": \"Message structure test message v2\",   \"email\": \"Message structure test message v2\",   \"wechat\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"dingding\": \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"at\\\":{\\\"atMobiles\\\": [\\\"15XXXXXX\\\"],\\\"atUserIds\\\": [\\\"1234567XXX\\\"],\\\"isAtAll\\\": true},\\\"markdown\\\":{\\\"content\\\":\\\"Message structure test message v2 @15XXXXXX @1234567XXX\\\",\\\"title\\\":\\\"Message structure title\\\"}}\",   \"feishu\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"welinkRed\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"http\": \"Message structure test message v2\",   \"https\": \"Message structure test message v2\",   \"dingTalkBot\": \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"markdown\\\":{\\\"content\\\":\\\"Message structure test message v2 dingTalkBot markdown\\\",\\\"title\\\":\\\"Message structure title\\\"}}\",   \"functionstage\": \"Message structure test message v2\" }","subject":"test message v2","time_to_live":"3600"},"x-request-examples-3":{"message_attributes":[{"name":"smn_protocol","type":"PROTOCOL","value":["email","sms"]}],"message_template_name":"confirm_message","subject":"test message template v2","tags":{"topic_id":"topic_id3332","topic_urn":"topic_urn3331"},"time_to_live":"3600"},"x-request-examples-description-1":"消息发布","x-request-examples-description-2":"使用消息结构体方式的消息发布","x-request-examples-description-3":"使用消息模板方式的消息发布","x-request-examples-text-1":{"message":"Message test message v2","message_attributes":[{"name":"smn_protocol","type":"PROTOCOL","value":["email","sms"]}],"subject":"test message v2","time_to_live":"3600"},"x-request-examples-text-2":{"message_attributes":[{"name":"smn_protocol","type":"PROTOCOL","value":["email","sms"]}],"message_structure":"{   \"default\": \"Message structure test message v2\",   \"sms\": \"Message structure test message v2\",   \"email\": \"Message structure test message v2\",   \"wechat\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"dingding\": \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"at\\\":{\\\"atMobiles\\\": [\\\"15XXXXXX\\\"],\\\"atUserIds\\\": [\\\"1234567XXX\\\"],\\\"isAtAll\\\": true},\\\"markdown\\\":{\\\"content\\\":\\\"Message structure test message v2 @15XXXXXX @1234567XXX\\\",\\\"title\\\":\\\"Message structure title\\\"}}\",   \"feishu\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"welinkRed\": \"{\\\"msgtype\\\":\\\"text\\\",\\\"text\\\":{\\\"content\\\":\\\"Message structure test message v2\\\"}}\",   \"http\": \"Message structure test message v2\",   \"https\": \"Message structure test message v2\",   \"dingTalkBot\": \"{\\\"msgtype\\\":\\\"markdown\\\",\\\"markdown\\\":{\\\"content\\\":\\\"Message structure test message v2 dingTalkBot markdown\\\",\\\"title\\\":\\\"Message structure title\\\"}}\",   \"functionstage\": \"Message structure test message v2\" }","subject":"test message v2","time_to_live":"3600"},"x-request-examples-text-3":{"message_attributes":[{"name":"smn_protocol","type":"PROTOCOL","value":["email","sms"]}],"message_template_name":"confirm_message","subject":"test message template v2","tags":{"topic_id":"topic_id3332","topic_urn":"topic_urn3331"},"time_to_live":"3600"},"x-request-examples-url-1":"POST https://{SMN_Endpoint}/v2/{project_id}/notifications/topics/urn:smn:regionId:f96188c7ccaf4ffba0c9aa149ab2bd57:test_create_topic_v2/publish","x-request-examples-url-2":"POST https://{SMN_Endpoint}/v2/{project_id}/notifications/topics/urn:smn:regionId:f96188c7ccaf4ffba0c9aa149ab2bd57:test_create_topic_v2/publish","x-request-examples-url-3":"POST https://{SMN_Endpoint}/v2/{project_id}/notifications/topics/urn:smn:regionId:f96188c7ccaf4ffba0c9aa149ab2bd57:test_create_topic_v2/publish","x-support-sdk":"Y"}}},"product_short":"SMN","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"消息发布","tags":"发布消息操作","uri":null,"version":"2.0"}