{"base_path":"/","components":null,"consumes":"","definitions":{"ErrorResp":{"description":"失败时返回的错误对象","properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":8,"type":"string"},"error_msg":{"description":"错误描述","maxLength":512,"minLength":2,"type":"string"}},"required":["error_code","error_msg"]},"QueryLatestDeadLockResp":{"properties":{"find_lock":{"description":"表示系统是否成功检测到死锁事件","example":true,"type":"boolean"},"happen_time":{"description":"死锁事件发生的 Unix 时间戳","example":1752111106000,"format":"int32","type":"integer"},"mysql_dead_lock":{"description":"MySQL 死锁事件的所有详细信息","properties":{"happen_time":{"description":"死锁事件发生的 Unix 时间戳(毫秒级)","example":1752111106000,"format":"int64","type":"integer"},"mysql_transactions":{"description":"参与死锁的每个事务的详细信息","items":{"properties":{"holding_lock":{"description":"该事务当前持有的锁的详细描述","example":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap","type":"string"},"holding_lock_index":{"description":"持有的锁的针对表的索引","example":"PRIMARY","type":"string"},"holding_lock_type":{"description":"持有的锁的具体类型。X 是排他锁,rec 是记录锁","example":"X locks rec but not gap","type":"string"},"request_type":{"description":"请求类型","example":"statistics","type":"string"},"session_id":{"description":"会话的 ID","example":"96576368","type":"string"},"sql":{"description":"前正在执行或最近执行的 SQL 语句","example":"SELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE","type":"string"},"table":{"description":"事务操作的具体表","example":"`yyj_das_test`.`test1`","type":"string"},"thread_id":{"description":"线程id","example":"20200294","type":"string"},"transaction_id":{"description":"内部的事务 ID","example":"70996","type":"string"},"waiting_lock":{"description":"事务正在等待的锁的详细描述","example":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting","type":"string"},"waiting_lock_index":{"description":"正在等待的锁是针对表的索引","example":"PRIMARY","type":"string"},"waiting_lock_type":{"description":"正在等待的锁的具体类型","example":"X locks rec but not gap waiting","type":"string"}}},"type":"array"},"raw":{"description":"原始的、未经解析的 MySQL 死锁日志文本","example":"2025-07-10 09:31:46 140522909734656\n*** (1) TRANSACTION:\nTRANSACTION 70996, ACTIVE 12 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200294, OS thread handle 140522684937984, query id 96576368 100.125.13.72 root statistics\nSELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE\n\n*** (1) HOLDS THE LOCK(S):\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n\n\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED:\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n\n\n*** (2) TRANSACTION:\nTRANSACTION 70997, ACTIVE 8 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200308, OS thread handle 140521527826176, query id 96576422 100.125.13.72 root statistics\nSELECT *\nFROM test1\nWHERE id = 1\nLIMIT 0, 50\nFOR UPDATE\n\n*** (2) HOLDS THE LOCK(S):\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n\n\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED:\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n\n*** WE ROLL BACK TRANSACTION (2)","type":"string"},"rollback_trx_id":{"description":"MySQL 在检测到死锁后,会自动选择一个事务进行回滚(通常是代价较小的那个)","example":"(2)","type":"string"},"time":{"description":"死锁事件发生的日期和时间","example":"2025-07-10 09:31:46","type":"string"}}}},"type":"object"}},"description":null,"group_id":"7f831fc0dd494cfe86eff0b79e4f207d","host":"das.cn-north-4.myhuaweicloud.com","id":"febaf7a814374f44a145b4a36b11ec74","info_version":"v3","method":"get","name":"ShowLatestDeadLockSnapshot","parameters":{},"paths":{"/v3/{project_id}/connections/{connection_id}/instance/show-latestdeadlock-snapshot":{"get":{"consumes":["application/json"],"description":"获取死锁的快照信息","operationId":"ShowLatestDeadLockSnapshot","parameters":[{"description":"项目id","in":"path","name":"project_id","required":true,"type":"string"},{"description":"连接id","in":"path","name":"connection_id","required":true,"type":"string"},{"description":"死锁id","format":"int32","in":"query","name":"id","required":true,"type":"integer"},{"description":"用户token","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"description":"语言","enum":["zh-cn","en-us"],"in":"header","name":"X-Language","required":false,"type":"string"}],"produces":["application/json"],"responses":{"200":{"description":"成功","examples":{"application/json":{"find_lock":true,"happen_time":1752111106000,"mysql_dead_lock":{"happen_time":1752111106000,"mysql_transactions":[{"holding_lock":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap","holding_lock_index":"PRIMARY","holding_lock_type":"X locks rec but not gap","request_type":"statistics","session_id":"96576368","sql":"SELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE","table":"`yyj_das_test`.`test1`","thread_id":"20200294","transaction_id":"70996","waiting_lock":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting","waiting_lock_index":"PRIMARY","waiting_lock_type":"X locks rec but not gap waiting"},{"holding_lock":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap","holding_lock_index":"PRIMARY","holding_lock_type":"X locks rec but not gap","request_type":"statistics","session_id":"96576422","sql":"SELECT *\nFROM test1\nWHERE id = 1\nLIMIT 0, 50\nFOR UPDATE","table":"`yyj_das_test`.`test1`","thread_id":"20200308","transaction_id":"70997","waiting_lock":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap waiting","waiting_lock_index":"PRIMARY","waiting_lock_type":"X locks rec but not gap waiting"}],"raw":"2025-07-10 09:31:46 140522909734656\n*** (1) TRANSACTION:\nTRANSACTION 70996, ACTIVE 12 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200294, OS thread handle 140522684937984, query id 96576368 100.125.13.72 root statistics\nSELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE\n\n*** (1) HOLDS THE LOCK(S):\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n\n\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED:\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n\n\n*** (2) TRANSACTION:\nTRANSACTION 70997, ACTIVE 8 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200308, OS thread handle 140521527826176, query id 96576422 100.125.13.72 root statistics\nSELECT *\nFROM test1\nWHERE id = 1\nLIMIT 0, 50\nFOR UPDATE\n\n*** (2) HOLDS THE LOCK(S):\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n\n\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED:\nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n\n*** WE ROLL BACK TRANSACTION (2)","rollback_trx_id":"(2)","time":"2025-07-10 09:31:46"}}},"schema":{"$ref":"#/definitions/QueryLatestDeadLockResp"}},"400":{"description":"BadRequest","schema":{"$ref":"#/definitions/ErrorResp"}},"500":{"description":"InternelServerError","schema":{"$ref":"#/definitions/ErrorResp"}}},"summary":"获取死锁的快照信息","tags":["云DBA"],"x-api-type":"open-api","x-is-registered":"Y","x-request-examples-url-1":"GET https://das.cn-north-1.myhuaweicloud.com/v3/63be57f43e114de790a9735d1c5bc95d/connections/dbfa1738-218a-470b-a191-1a9e0162fdca/instance/show-latestdeadlock-snapshot?id=65","x-support-sdk":"Y"}}},"product_short":"DAS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"获取死锁的快照信息","tags":"云DBA","uri":null,"version":"2.0"}