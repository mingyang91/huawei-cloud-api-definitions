{"base_path":"/","components":null,"consumes":"","definitions":{"ErrorResp":{"description":"失败时返回的错误对象","properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":8,"type":"string"},"error_msg":{"description":"错误描述","maxLength":512,"minLength":2,"type":"string"}},"required":["error_code","error_msg"]},"FullDeadLockListResp":{"properties":{"full_deadlock_list":{"description":"死锁具体信息","items":{"properties":{"happen_time":{"description":"死锁事件发生的 Unix 时间戳(毫秒级)","example":1752111106615,"format":"int64","type":"integer"},"mysql_deadlock":{"description":"死锁事件详细信息","properties":{"happen_time":{"description":"死锁事件发生的 Unix 时间戳(毫秒级)","example":1752111106615,"format":"int64","type":"integer"},"mysql_transactions":{"description":"参与这次死锁的每个事务的详细结构化信息","items":{"properties":{"request_type":{"description":"请求类型","example":"statistics","type":"string"},"session_id":{"description":"会话id","example":"96576368","type":"string"},"sql":{"description":"具体sql","example":"SELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE","type":"string"},"table":{"description":"表","example":"`yyj_das_test`.`test1`","type":"string"},"thread_id":{"description":"线程id","example":"20200294","type":"string"},"transaction_id":{"description":"内部事务id","example":"70996","type":"string"},"waiting_lock":{"description":"事务正在等待的锁的描述","example":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting","type":"string"},"waiting_lock_index":{"description":"锁针对的索引","example":"PRIMARY","type":"string"},"waiting_lock_type":{"description":"锁类型","example":"X locks rec but not gap waiting","type":"string"}}},"type":"array"},"raw":{"description":"死锁事件详细信息","example":"Transactions deadlock detected, dumping detailed information.\n*** (1) TRANSACTION: \nTRANSACTION 70996, ACTIVE 12 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200294, OS thread handle 140522684937984, query id 96576368 100.*.*.* root statistics\nSELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE\n*** (1) HOLDS THE LOCK(S): \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED: \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n*** (2) TRANSACTION: \nTRANSACTION 70997, ACTIVE 8 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200308, OS thread handle 140521527826176, query id 96576422 100.*.*.* root statistics\nSELECT *\nFROM test1\nWHERE id = 1\nLIMIT 0, 50\nFOR UPDATE\n*** (2) HOLDS THE LOCK(S): \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED: \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n*** WE ROLL BACK TRANSACTION (2)\n","type":"string"},"rollback_trx_id":{"description":"MySQL InnoDB 引擎在检测到死锁后,会自动选择一个事务进行回滚以解除死锁。","example":"(2)","type":"string"}}}}},"type":"array"},"total":{"description":"死锁数量","example":1,"format":"int32","type":"integer"}},"type":"object"}},"description":null,"group_id":"7f831fc0dd494cfe86eff0b79e4f207d","host":"das.cn-north-4.myhuaweicloud.com","id":"d2d1e7ebd4f24971b8bb2516e2e9bc00","info_version":"v3","method":"get","name":"ShowFullDeadLockList","parameters":{},"paths":{"/v3/{project_id}/instances/{instance_id}/show-fulldeadlock-list":{"get":{"consumes":["application/json"],"description":"获取全量死锁信息","operationId":"ShowFullDeadLockList","parameters":[{"description":"项目id","in":"path","name":"project_id","required":true,"type":"string"},{"description":"实例id","in":"path","name":"instance_id","required":true,"type":"string"},{"description":"开始时间","format":"int64","in":"query","name":"start_at","required":true,"type":"integer"},{"description":"结束时间","format":"int64","in":"query","name":"end_at","required":true,"type":"integer"},{"description":"当前页数","format":"int32","in":"query","name":"page_num","required":false,"type":"integer"},{"description":"每页返回数量,默认10","format":"int32","in":"query","name":"page_size","required":false,"type":"integer"},{"description":"用户的token","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"description":"语言","enum":["zh-cn","en-us"],"in":"header","name":"X-Language","required":false,"type":"string"}],"produces":["application/json"],"responses":{"200":{"description":"成功","examples":{"application/json":{"full_deadlock_list":[{"happen_time":1752111106615,"mysql_deadlock":{"happen_time":1752111106615,"mysql_transactions":[{"request_type":"statistics","session_id":"96576368","sql":"SELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE","table":"`yyj_das_test`.`test1`","thread_id":"20200294","transaction_id":"70996","waiting_lock":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting","waiting_lock_index":"PRIMARY","waiting_lock_type":"X locks rec but not gap waiting"},{"request_type":"statistics","session_id":"96576422","sql":"SELECT *\nFROM test1\nWHERE id = 1\nLIMIT 0, 50\nFOR UPDATE","table":"`yyj_das_test`.`test1`","thread_id":"20200308","transaction_id":"70997","waiting_lock":"index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap waiting","waiting_lock_index":"PRIMARY","waiting_lock_type":"X locks rec but not gap waiting"}],"raw":"Transactions deadlock detected, dumping detailed information.\n*** (1) TRANSACTION: \nTRANSACTION 70996, ACTIVE 12 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200294, OS thread handle 140522684937984, query id 96576368 100.*.*.* root statistics\nSELECT *\nFROM test1\nWHERE id = 2\nLIMIT 0, 50\nFOR UPDATE\n*** (1) HOLDS THE LOCK(S): \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED: \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70996 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n*** (2) TRANSACTION: \nTRANSACTION 70997, ACTIVE 8 sec starting index read\nmysql tables in use 1, locked 1\nLOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s)\nMySQL thread id 20200308, OS thread handle 140521527826176, query id 96576422 100.*.*.* root statistics\nSELECT *\nFROM test1\nWHERE id = 1\nLIMIT 0, 50\nFOR UPDATE\n*** (2) HOLDS THE LOCK(S): \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap\nRecord lock, heap no 3 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000002; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603f1; asc     &  ;;\n 3: len 4; hex 0000001f; asc     ;;\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED: \nRECORD LOCKS space id 8 page no 4 n bits 72 index PRIMARY of table `yyj_das_test`.`test1` trx id 70997 lock_mode X locks rec but not gap waiting\nRecord lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\n 0: len 4; hex 00000001; asc     ;;\n 1: len 6; hex 000000002315; asc     # ;;\n 2: len 7; hex 020000012603ce; asc     &  ;;\n 3: len 4; hex 0000002a; asc    *;;\n*** WE ROLL BACK TRANSACTION (2)\n","rollback_trx_id":"(2)"}}],"total":1}},"schema":{"$ref":"#/definitions/FullDeadLockListResp"}},"400":{"description":"BadRequest","schema":{"$ref":"#/definitions/ErrorResp"}},"500":{"description":"InternelServeError","schema":{"$ref":"#/definitions/ErrorResp"}}},"summary":"获取全量死锁信息","tags":["云DBA"],"x-api-type":"open-api","x-is-registered":"Y","x-request-examples-url-1":"GET https://das.cn-north-1.myhuaweicloud.com/v3/63be57f43e114de790a9735d1c5bc95d/instances/5c59fa7d6f09456b947f32922f9aeda1in01/show-fulldeadlock-list?start_at=1751684519000&end_at=1751943603999&page_num=1&page_size=10","x-support-sdk":"Y"}}},"product_short":"DAS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"获取全量死锁信息","tags":"云DBA","uri":null,"version":"2.0"}