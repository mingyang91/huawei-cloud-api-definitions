{"base_path":"/","components":null,"consumes":"","definitions":{"ErrorResp":{"description":"失败时返回的错误对象","properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":8,"type":"string"},"error_msg":{"description":"错误描述","maxLength":512,"minLength":2,"type":"string"}},"required":["error_code","error_msg"]},"HealthReportAnalysisResult":{"properties":{"reasons":{"description":"可能原因列表。","items":{"$ref":"#/definitions/HealthReportRiskReason"},"type":"array"},"risk_code":{"description":"风险点编码。","type":"string"},"risk_content":{"description":"风险点内容。","type":"string"},"risk_level":{"description":"风险点级别。","type":"string"}},"required":["risk_code","risk_level","risk_content","reasons"],"type":"object"},"HealthReportDiskStat":{"properties":{"peak_stats":{"description":"峰值统计信息列表。","items":{"$ref":"#/definitions/HealthReportSingleValueStat"},"type":"array"},"ratio_stats":{"description":"比率值数据列表。","items":{"$ref":"#/definitions/HealthReportRatioStat"},"type":"array"}},"required":["peak_stats","ratio_stats"],"type":"object"},"HealthReportFullSqlStat":{"properties":{"analyze_success":{"description":"统计分析是否成功。","type":"boolean"},"avg_cost_top_templates":{"description":"全量SQL Top平均执行耗时列表。","items":{"$ref":"#/definitions/HealthReportSqlTemplate"},"type":"array"},"collect_full_sql":{"description":"是否收集全量SQL。","type":"boolean"},"error_message":{"description":"错误信息。","type":"string"},"execute_top_templates":{"description":"全量SQL Top总执行次数列表。","items":{"$ref":"#/definitions/HealthReportSqlTemplate"},"type":"array"},"sum_rows_examined_top_templates":{"description":"全量SQL Top总扫描行数列表。","items":{"$ref":"#/definitions/HealthReportSqlTemplate"},"type":"array"}},"required":["collect_full_sql","execute_top_templates","sum_rows_examined_top_templates","execute_over_examined_top_templates","rows_over_examined_top_templates","avg_cost_top_templates","analyze_success","error_message"],"type":"object"},"HealthReportInspectionScore":{"properties":{"connection_rate":{"description":"连接使用率。","format":"double","type":"number"},"cpu_usage":{"description":"CPU使用率。","format":"double","type":"number"},"critical":{"description":"严重事件。","format":"int32","type":"integer"},"iops_usage":{"description":"IOPS使用率。","format":"double","type":"number"},"light":{"description":"优化事件。","format":"int32","type":"integer"},"lost_points_detail_list":{"description":"扣分详情。","items":{"$ref":"#/definitions/HealthReportLostPointsDetail"},"type":"array"},"medium":{"description":"警告事件。","format":"int32","type":"integer"},"mem_usage":{"description":"内存使用率。","format":"double","type":"number"},"score":{"description":"得分。","format":"double","type":"number"},"slow_sql_total":{"description":"慢SQL数量。","format":"int64","type":"integer"},"space_usage":{"description":"空间使用率。","format":"double","type":"number"},"thread_running":{"description":"活跃会话。","format":"double","type":"number"}},"required":["score","critical","medium","light","cpu_usage","mem_usage","space_usage","connection_rate","iops_usage","thread_running","slow_sql_total","lost_points_detail_list"],"type":"object"},"HealthReportInspectionStat":{"properties":{"analyze_success":{"description":"统计分析是否成功。","type":"boolean"},"error_message":{"description":"错误信息。","type":"string"},"inspection_score":{"description":"巡检评分。","items":{"$ref":"#/definitions/HealthReportInspectionScore"},"type":"array"}},"required":["inspection_score","analyze_success","error_message"],"type":"object"},"HealthReportInstanceInfo":{"properties":{"cpu":{"description":"实例cpu核数。","format":"int32","type":"integer"},"disk_size":{"description":"磁盘大小。","format":"int32","type":"integer"},"disk_type":{"description":"磁盘类型。","type":"string"},"engine":{"description":"实例引擎类型。","type":"string"},"engine_version":{"description":"引擎内核版本。","type":"string"},"instance_id":{"description":"实例ID。","type":"string"},"instance_name":{"description":"实例名称。","type":"string"},"master_node_id":{"description":"主节点ID。","type":"string"},"mem":{"description":"实例内存大小。","format":"int32","type":"integer"},"project_id":{"description":"项目ID。","type":"string"},"tenant_id":{"description":"账号ID。","type":"string"}},"required":["tenant_id","project_id","instance_id","master_node_id","instance_name","cpu","mem","disk_size","disk_type","engine","engine_version"],"type":"object"},"HealthReportLostPointsDetail":{"properties":{"lost_points":{"description":"所扣分数。","format":"double","type":"number"},"metric":{"description":"扣分项。","type":"string"},"risk_level":{"description":"事件等级。","type":"string"}},"required":["metric","lost_points","risk_level"],"type":"object"},"HealthReportPerformanceStat":{"properties":{"peak_stats":{"description":"峰值统计信息列表。","items":{"$ref":"#/definitions/HealthReportSingleValueStat"},"type":"array"},"ratio_stats":{"description":"比率值数据列表。","items":{"$ref":"#/definitions/HealthReportRatioStat"},"type":"array"}},"required":["peak_stats","ratio_stats","last_values","analyze_success","error_message"],"type":"object"},"HealthReportRatioStat":{"properties":{"critical_ratio":{"description":"高水位占比。","format":"double","type":"number"},"light_ratio":{"description":"低水位占比。","format":"double","type":"number"},"max_value":{"description":"最大值。","format":"double","type":"number"},"medium_ratio":{"description":"中水位占比。","format":"double","type":"number"},"metric":{"description":"指标名。","type":"string"}},"required":["metric","max_value","critical_ratio","medium_ratio","light_ratio"],"type":"object"},"HealthReportRiskReason":{"properties":{"reason_code":{"description":"可能原因编码。","type":"string"},"reason_content":{"description":"可能原因内容。","type":"string"},"suggestions":{"description":"建议优化措施列表。","items":{"$ref":"#/definitions/HealthReportRiskSuggestion"},"type":"array"}},"required":["reason_code","reason_content","suggestions"],"type":"object"},"HealthReportRiskSuggestion":{"properties":{"suggestion_code":{"description":"建议优化措施编码。","type":"string"},"suggestion_content":{"description":"建议优化措施。","type":"string"}},"required":["suggestion_code","suggestion_content"],"type":"object"},"HealthReportSingleValueStat":{"properties":{"max_value":{"description":"最大值。","format":"double","type":"number"},"metric":{"description":"指标名。","type":"string"},"normalized":{"description":"归一化值。","format":"double","type":"number"},"stage":{"description":"当前状态。","type":"string"},"timestamp":{"description":"指标采集时间。","format":"int64","type":"integer"},"value":{"description":"数值。","format":"double","type":"number"}},"required":["metric","value","max_value","normalized","stage","timestamp"],"type":"object"},"HealthReportSlowLogStat":{"properties":{"analyze_success":{"description":"统计分析是否成功。","type":"boolean"},"collect_slow_log":{"description":"是否收集慢SQL。","type":"boolean"},"error_message":{"description":"错误信息。","type":"string"},"rows_examined_exceeding":{"description":"慢SQL Top扫描返回比列表。","items":{"$ref":"#/definitions/HealthReportSqlTemplate"},"type":"array"},"top_avg_query_time_slow_logs":{"description":"慢SQL Top平均执行时间列表。","items":{"$ref":"#/definitions/HealthReportSqlTemplate"},"type":"array"},"top_execute_slow_logs":{"description":"慢SQL Top执行次数列表。","items":{"$ref":"#/definitions/HealthReportSqlTemplate"},"type":"array"},"top_max_query_time_slow_logs":{"description":"慢SQL Top最大执行时间列表。","items":{"$ref":"#/definitions/HealthReportSqlTemplate"},"type":"array"}},"required":["collect_slow_log","top_execute_slow_logs","top_avg_query_time_slow_logs","top_max_query_time_slow_logs","rows_examined_exceeding","analyze_success","error_message"],"type":"object"},"HealthReportSqlTemplate":{"properties":{"avg_query_time":{"description":"平均执行时间。","format":"double","type":"number"},"avg_rows_examined":{"description":"平均扫描行数。","format":"double","type":"number"},"avg_rows_sent":{"description":"平均返回行数。","format":"double","type":"number"},"databases":{"description":"数据库列表。","items":{"type":"string"},"type":"array"},"max_query_time":{"description":"最大执行时间。","format":"double","type":"number"},"max_rows_examined":{"description":"最大扫描行数。","format":"double","type":"number"},"max_rows_sent":{"description":"最大返回行数。","format":"double","type":"number"},"sum_rows_examined":{"description":"总扫描行数。","format":"double","type":"number"},"template":{"description":"模版内容。","type":"string"},"template_id":{"description":"模版ID。","type":"string"},"times":{"description":"执行次数。","format":"int64","type":"integer"}},"required":["template_id","template","databases","times","avg_query_time","max_query_time","avg_rows_examined","max_rows_examined","sum_rows_examined","avg_rows_sent","max_rows_sent"],"type":"object"},"HealthReportSummaryInfo":{"properties":{"analysis_results":{"description":"分析结果列表","items":{"$ref":"#/definitions/HealthReportAnalysisResult"},"type":"array"}},"required":["health_rank","analysis_results"],"type":"object"},"HealthReportTableSpaceIncrInfo":{"properties":{"analyze_success":{"description":"统计分析是否成功。","type":"boolean"},"database":{"description":"数据库名。","type":"string"},"error_message":{"description":"错误信息。","type":"string"},"increment":{"description":"增长量。","format":"int64","type":"integer"},"table":{"description":"表名。","type":"string"}},"required":["database","table","increment","analyze_success","error_message"],"type":"object"},"HealthReportTableSpaceInfo":{"properties":{"data_size":{"description":"数据大小。","format":"int64","type":"integer"},"database":{"description":"数据库名。","type":"string"},"db_engine":{"description":"数据库引擎。","type":"string"},"index_size":{"description":"索引大小。","format":"int64","type":"integer"},"rows":{"description":"行数量。","format":"int64","type":"integer"},"table":{"description":"表名。","type":"string"},"table_size":{"description":"表大小。","format":"int64","type":"integer"}},"required":["database","table","db_engine","table_size","data_size","index_size","rows"],"type":"object"},"HealthReportTableSpaceStat":{"properties":{"analyze_success":{"description":"统计分析是否成功。","type":"boolean"},"error_message":{"description":"错误信息。","type":"string"},"rows_incr_top":{"description":"表行数量增长Top列表。","items":{"$ref":"#/definitions/HealthReportTableSpaceIncrInfo"},"type":"array"},"rows_top":{"description":"表行数量Top列表。","items":{"$ref":"#/definitions/HealthReportTableSpaceInfo"},"type":"array"},"size_incr_top":{"description":"表大小增长Top列表。","items":{"$ref":"#/definitions/HealthReportTableSpaceIncrInfo"},"type":"array"},"size_top":{"description":"表大小Top列表。","items":{"$ref":"#/definitions/HealthReportTableSpaceInfo"},"type":"array"}},"required":["size_top","rows_top","size_incr_top","rows_incr_top","analyze_success","error_message"],"type":"object"},"InstanceHealthReportResp":{"properties":{"disk_stat":{"$ref":"#/definitions/HealthReportDiskStat","description":"磁盘统计分析列表。","type":"object"},"end_at":{"description":"日报诊断区间的结束时间(Unix timestamp),单位:毫秒。","format":"int64","type":"integer"},"error_message":{"description":"错误信息。","type":"string"},"full_sql_stat":{"$ref":"#/definitions/HealthReportFullSqlStat","description":"全量SQL统计分析列表。","type":"object"},"inspection_stat":{"$ref":"#/definitions/HealthReportInspectionStat","description":"巡检评分统计分析列表。","type":"object"},"instance_info":{"$ref":"#/definitions/HealthReportInstanceInfo","description":"实例信息列表。","type":"object"},"performance_stat":{"$ref":"#/definitions/HealthReportPerformanceStat","description":"性能统计分析列表。","type":"object"},"slow_log_stat":{"$ref":"#/definitions/HealthReportSlowLogStat","description":"慢SQL统计分析列表。","type":"object"},"start_at":{"description":"日报诊断区间的起始时间(Unix timestamp),单位:毫秒。","format":"int64","type":"integer"},"success":{"description":"日报诊断是否成功。","type":"boolean"},"summary_info":{"$ref":"#/definitions/HealthReportSummaryInfo","description":"日报内容摘要信息","type":"object"},"table_space_stat":{"$ref":"#/definitions/HealthReportTableSpaceStat","description":"表空间统计分析列表。","type":"object"},"task_id":{"description":"报告ID。","type":"string"}},"required":["success","start_at","end_at","task_id","summary_info","instance_info","performance_stat","disk_stat","table_space_stat","slow_log_stat","full_sql_stat","inspection_stat"],"type":"object"}},"description":null,"group_id":"7f831fc0dd494cfe86eff0b79e4f207d","host":"das.cn-north-4.myhuaweicloud.com","id":"a97f8a13de5c4df798717d76b7f8e674","info_version":"v3","method":"get","name":"ShowInstanceHealthReport","parameters":{},"paths":{"/v3/{project_id}/instances/{instance_id}/get-instance-health-report":{"get":{"description":"获取实例健康诊断报告内容。","operationId":"ShowInstanceHealthReport","parameters":[{"description":"项目ID。","in":"path","maxLength":1024,"minLength":1,"name":"project_id","required":true,"type":"string"},{"description":"实例ID。","in":"path","maxLength":1024,"minLength":1,"name":"instance_id","required":true,"type":"string"},{"description":"任务ID。","in":"query","maxLength":1024,"minLength":1,"name":"task_id","required":true,"type":"string"},{"description":"用户Token。","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"description":"请求语言类型。","enum":["en-us","zh-cn"],"in":"header","name":"X-Language","required":false,"type":"string"}],"responses":{"200":{"description":"Success.","examples":{"application/json":{"disk_stat":{"analyze_success":true,"peak_stats":[{"max_value":4500,"metric":"iops","normalized":0.020422222222222224,"stage":"LIGHT","timestamp":1728750600,"value":91.9}],"ratio_stats":[{"criticalThreshold":4500,"critical_ratio":0,"lightThreshold":1350,"light_ratio":1,"max_value":4500,"mediumThreshold":3150,"medium_ratio":0,"metric":"iops"}]},"full_sql_Stat":{"analyze_success":true,"collect_full_sql":true,"execute_top_templates":[{"avg_query_time":5,"avg_rows_examined":0,"databases":["test_db"],"sum_rows_examined":0,"template":"CREATE TABLE IF NOT EXISTS table_001 (id int)","template_id":"B38F825636B24B7","times":1}]},"inspection_Stat":{"analyze_success":true,"inspection_score":[{"connection_rate":0.54,"cpu_usage":3.93,"critical":0,"iops_usage":0.28,"light":0,"lost_points_detail_list":[{"lost_points":0,"metric":"memUsage","risk_level":"NORMAL"},{"lost_points":0,"metric":"cpuUsage","risk_level":"NORMAL"},{"lost_points":0,"metric":"spaceUsage","risk_level":"NORMAL"},{"lost_points":0,"metric":"iopsUsage","risk_level":"NORMAL"},{"lost_points":0,"metric":"connectionRate","risk_level":"NORMAL"},{"lost_points":0,"metric":"threadRunning","risk_level":"NORMAL"},{"lost_points":0,"metric":"slowSqlTotal","risk_level":"NORMAL"}],"medium":0,"mem_usage":22.91,"score":100,"slow_sql_total":0,"space_usage":8.66,"thread_running":4}]},"instance_info":{"cpu":2,"disk_size":60,"disk_type":"CLOUDSSD","engine":"mysql","engine_version":"5.7","instance_id":"bcfa975193f1402fa11a6d4fd6baf5fbin01","instance_name":"rds-sql-勿删1","mem":8,"project_id":"052041494800d57c2f02c00275b4c247","tenant_id":"05204146e600d48f0f02c002850ec340"},"performance_stat":{"analyze_success":true,"peak_stats":[{"max_value":11178,"metric":"qps","normalized":0.005804258364644837,"stage":"LIGHT","timestamp":1728756000,"value":64.88}],"ratio_stats":[{"criticalThreshold":11178,"critical_ratio":0,"lightThreshold":3353.4,"light_ratio":1,"max_value":11178,"mediumThreshold":7824.599999999999,"medium_ratio":0,"metric":"qps"}]},"slow_log_stat":{"analyze_success":true,"collect_slow_log":true,"rows_examined_exceeding":[],"top_execute_slow_logs":[{"avg_query_time":0.9021538595657752,"avg_rows_examined":0,"avg_rows_sent":0,"databases":["test_db"],"max_query_time":45.08398997783661,"sum_rows_examined":0,"template":"INSERT INTO test123 VALUES (?);","template_id":"5B20B6BF446F926F","times":83}]},"success":true,"summary_info":{"analysis_results":[{"reasons":[{"reason_code":"SLOW_LOG_EXIST","reason_content":"存在慢SQL","suggestions":[{"suggestion_code":"ANALYZE_SLOW_LOG","suggestion_content":"分析慢SQL查找问题根源"}]}],"risk_code":"SLOW_LOG_ISSUE","risk_content":"慢SQL问题","risk_level":"WARNING"}]},"table_space_stat":{"analyze_success":true}}},"schema":{"$ref":"#/definitions/InstanceHealthReportResp"}},"400":{"description":"Client error.","schema":{"$ref":"#/definitions/ErrorResp"}},"500":{"description":"Server error.","schema":{"$ref":"#/definitions/ErrorResp"}}},"summary":"获取实例健康诊断报告内容","tags":["云DBA"],"x-das-is-publish":"#ShowInstanceHealthReport_Placeholder#","x-is-registered":"Y","x-request-examples-description-1":"获取实例健康诊断报告内容","x-request-examples-url-1":"GET https://das.cn-north-7.myhuaweicloud.com/v3/052041494800d57c2f02c00275b4c247/instances/bcfa975193f1402fa11a6d4fd6baf5fbin01/get-instance-health-report?task_id=bb252ed0-3d06-489a-a662-6609e054e91c","x-support-sdk":"Y"}}},"product_short":"DAS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"获取实例健康诊断报告内容","tags":"云DBA","uri":null,"version":"2.0"}