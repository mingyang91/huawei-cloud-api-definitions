{"base_path":"/","components":null,"consumes":"","definitions":{"CreateSqlLimitRuleOption":{"properties":{"max_concurrency":{"description":"最大并发数","format":"int32","type":"integer"},"max_waiting":{"description":"最大等待时间","format":"int32","type":"integer"},"pattern":{"description":"SQL限流规则。限流规则以~分隔关键字,例如select~a。规则举例详细说明:例如关键字是\"select~a\", 含义为:select以及a为该并发控制所包含的两个关键字,~为关键字间隔符,即若执行SQL命令包含select与a两个关键字视为命中此条并发控制规则。","type":"string"},"sql_type":{"description":"SQL类型","enum":["SELECT","UPDATE","DELETE","QUERY_ID","QUERY_STR"],"type":"string"}},"required":["sql_type","max_concurrency","pattern"],"type":"object"},"CreateSqlLimitRulesBody":{"description":"创建SQL限流规则请求提","properties":{"database_name":{"description":"数据库名(PostgreSQL必填)","type":"string"},"datastore_type":{"description":"数据库类型","enum":["MySQL","PostgreSQL"],"type":"string"},"sql_limit_rules":{"description":"需要创建的SQL限流规则列表,一次最多创建5个","items":{"$ref":"#/definitions/CreateSqlLimitRuleOption"},"type":"array"}},"required":["datastore_type","sql_limit_rules"],"type":"object"},"ErrorResp":{"description":"失败时返回的错误对象","properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":8,"type":"string"},"error_msg":{"description":"错误描述","maxLength":512,"minLength":2,"type":"string"}},"required":["error_code","error_msg"]}},"description":null,"group_id":"7f831fc0dd494cfe86eff0b79e4f207d","host":"das.cn-north-4.myhuaweicloud.com","id":"2f07c26c0c5e4448b39f433b6b152456","info_version":"v3","method":"post","name":"CreateSqlLimitRules","parameters":{},"paths":{"/v3/{project_id}/instances/{instance_id}/sql-limit/rules":{"post":{"description":"添加SQL限流规则。目前仅支持MySQL和PostgreSQL数据库。\nMySQL使用限制如下:\n1.规则举例详细说明:例如关键字是\"select~a\", 含义为:select以及a为该并发控制所包含的两个关键字,~为关键字间隔符,即若执行SQL命令包含select与a两个关键字视为命中此条并发控制规则。\n2.当SQL语句匹配多条限流规则时,优先生效最新添加的规则,之前的规则不再生效。\n3.限流规则关键字有顺序要求,只会按顺序匹配。如:a~and~b 只会匹配 xxx a>1 and b>2,而不会匹配 xxx b>2 and a>1。\n4.关键字可能大小写敏感,请执行 \"show variables like 'rds_sqlfilter_case_sensitive'或者到实例参数设置页面进行确认。\n5.部分版本只读实例不允许设置限流规则,如果要设置限流规则,请到主实例上进行添加。\n6.系统表不限制、不涉及数据查询的不限制、root账号在特定版本下不限制。\nPostgreSQL使用限制如下:\n1.无法添加相同QUERY_ID或SQL语句的规则。\n2.使用SQL语句添加规则时,需要确保存在数据库表,如:select * from test,需要确保数据库中有test表。","operationId":"CreateSqlLimitRules","parameters":[{"description":"项目ID","in":"path","name":"project_id","required":true,"type":"string"},{"description":"实例ID","in":"path","name":"instance_id","required":true,"type":"string"},{"description":"用户token","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"description":"语言","enum":["zh-cn","en-us"],"in":"header","name":"X-Language","required":false,"type":"string"},{"description":"SQL限流规则","in":"body","name":"CreateSqlLimitRulesBody","required":true,"schema":{"$ref":"#/definitions/CreateSqlLimitRulesBody"}}],"responses":{"200":{"description":"Success."},"400":{"description":"Client error.","schema":{"$ref":"#/definitions/ErrorResp"}},"500":{"description":"Client error.","schema":{"$ref":"#/definitions/ErrorResp"}}},"summary":"创建SQL限流规则","tags":["云DBA"],"x-das-is-publish":"#CreateSqlLimitRules_Placeholder#","x-is-registered":"Y","x-order":21,"x-request-examples-1":{"datastore_type":"MySQL","sql_limit_rules":[{"max_concurrency":100,"pattern":"select~t2~var","sql_type":"SELECT"},{"max_concurrency":1,"pattern":"delete~t1~name","sql_type":"DELETE"}]},"x-request-examples-description-1":"创建SQL限流规则","x-request-examples-text-1":{"datastore_type":"MySQL","sql_limit_rules":[{"max_concurrency":100,"pattern":"select~t2~var","sql_type":"SELECT"},{"max_concurrency":1,"pattern":"delete~t1~name","sql_type":"DELETE"}]},"x-request-examples-url-1":"POST https://das.cn-north-1.myhuaweicloud.com/v3/054c630ff780d4cc2f40c00d7f6fb21d/instances/d871e13ee1044e21a473330cd67047cbin01/sql-limit/rules","x-support-sdk":"Y"}}},"product_short":"DAS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"创建SQL限流规则","tags":"云DBA","uri":null,"version":"2.0"}