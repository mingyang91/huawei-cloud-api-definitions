{"base_path":"/","components":null,"consumes":"","definitions":{"AppNameRule":{"description":"服务命名部分,数组中有多个对象时表示将每个对象抽取到的字符串拼接作为服务的名称。\nnameType取值cmdLine时args格式为[\"start\",\"end\"],表示抽取命令行中start、end之间的字符。\nnameType取值cmdLine时args格式为[\"aa\"],表示抽取环境变量名为aa对应的环境变量值。\nnameType取值str时,args格式为[\"fix\"],表示服务名称最后拼接固定文字fix。\nnameType取值cmdLineHash时,args格式为[\"0001\"],value格式为[\"ser\"],表示当启动命令是0001时,服务名称为ser。","properties":{"args":{"description":"输入值。","example":["/opt/********* -DNFW=icagent"],"items":{"type":"string"},"type":"array"},"nameType":{"description":"取值类型。从cmdLineHash、cmdLine、env、str里面选取。","example":"cmdLineHash","type":"string"},"value":{"description":"服务名(仅nameType为cmdLineHash时填写)。","example":"aicagentserver","items":{"type":"string"},"type":"array"}},"required":["nameType","args"],"type":"object"},"AppRules":{"description":"服务参数。","properties":{"createTime":{"default":"1599098476654","description":"规则创建时间(创建时不传,修改时传查询返回的createTime)。","type":"string"},"desc":{"description":"自定义描述信息","type":"string"},"enable":{"description":"true、false 规则是否启用。","example":"true","type":"boolean"},"eventName":{"description":"aom_inventory_rules_event规则事件名称,对于服务发现固定为\"aom_inventory_rules_event\"。","example":"aom_inventory_rules_event","type":"string"},"hostid":{"description":"主机ID(暂不使用,传空即可)。","example":"[]","items":{"type":"string"},"type":"array"},"id":{"description":"创建时填空,修改时填规则ID。","example":"302367e04c0b","type":"string"},"name":{"description":"规则名称。\n字符长度为4到63位,以小写字母a-z开头,只能包含0-9/a-z/-,不能以-结尾。","example":"icagent","type":"string"},"projectid":{"description":"租户从IAM申请到的projectid,一般为32位字符串。","example":"be891bffc1cf","type":"string"},"spec":{"$ref":"#/definitions/AppRulesSpec"}},"required":["enable","eventName","id","name","projectid","spec"],"type":"object"},"AppRulesBody":{"properties":{"appRules":{"description":"服务参数。","items":{"$ref":"#/definitions/AppRules"},"type":"array"}},"type":"object"},"AppRulesSpec":{"description":"规则详情。","properties":{"aom_metric_relabel_configs":{"description":"指标配置","type":"object"},"appType":{"description":"服务类型,用于标记服务的分类,仅用于规则分类和界面展示。可以填写任意字段,如按技术栈分类可填写Java,Python。按作用分类可填写collector(采集),database(数据库)等。","example":"\"\"","type":"string"},"attrList":{"description":"属性列表(暂不使用,可不传)。\ncmdLine、env","example":["cmdLine"],"items":{"type":"string"},"type":"array"},"dataSource":{"description":"数据源","type":"string"},"detectLog":{"description":"是否开启日志采集。\ntrue、false","example":"true","type":"string"},"discoveryRule":{"description":"规则发现部分,数组中有多个对象时表示需要同时满足所有条件的进程才会被匹配到。\ncheckType为cmdLine时checkMode填contain,checkContent格式为[\"xxx\"]表示进程命令行参数中需要包含xxx。checkType为env时checkMode填contain,checkContent格式为 [\"k1\",\"v1\"]表示进程环境变量中需要包含名为k1值为v1的环境变量。checkType为scope时checkMode填equals,checkContent格式为节点ID数组[\"hostId1\",\"hostId2\"],表示规则仅会在这些节点上生效(如果不指定节点范围,规则将下发到该项目所有的节点)。","items":{"$ref":"#/definitions/DiscoveryRule"},"type":"array"},"editable":{"description":"是否支持编辑 true、false","example":"true","type":"string"},"isDefaultRule":{"description":"是否为默认规则。\ntrue、false","example":"true","type":"string"},"isDetect":{"description":"是否为规则预探测场景(预探测场景不会保存规则,仅用于规则下发之前验证该规则能否有效发现节点上的进程)。true、false","example":true,"type":"string"},"logFileFix":{"description":"日志文件的后缀。\nlog、trace、out","example":["log","trace","out"],"items":{"type":"string"},"type":"array"},"logPathRule":{"description":"日志路径配置规则。\n当cmdLineHash为固定字符串时,指定日志路径或者日志文件。否则只采集进程当前打开的以.log和.trace结尾的文件。nameType取值cmdLineHash时,args格式为[\"00001\"],value格式为[\"/xxx/xx.log\"],表示当启动命令是00001时,日志路径为/xxx/xx.log。","items":{"$ref":"#/definitions/LogPathRule"},"type":"array"},"nameRule":{"$ref":"#/definitions/NameRule","description":"发现上来的服务、应用的命名规则。"},"priority":{"description":"规则优先级。1~9999的整数字符串,默认取值为9999","example":9999,"format":"int32","type":"integer"}},"required":["appType","detectLog","discoveryRule","isDefaultRule","isDetect","logFileFix","nameRule","priority"],"type":"object"},"ApplicationNameRule":{"description":"应用命名部分。\nnameType取值cmdLine时args格式为[\"start\",\"end\"],表示抽取命令行中start、end之间的字符。\nnameType取值cmdLine时args格式为 [\"aa\"],表示抽取环境变量名为aa对应的环境变量值。\nnameType取值str时,args格式为[\"fix\"],表示服务名称最后拼接固定文字fix。\nnameType取值cmdLineHash时,args格式为[\"0001\"],value格式为[\"ser\"],表示当启动命令是0001时,应用名称为ser。","properties":{"args":{"description":"输入值。","example":"/opt/*********** -DNFW=icagent","items":{"type":"string"},"type":"array"},"nameType":{"description":"取值类型。\n从cmdLineHash、cmdLine、env、str里面选取。","example":"cmdLineHash","type":"string"},"value":{"description":"服务名(仅nameType为cmdLineHash时填写)。","example":"aicagent","items":{"type":"string"},"type":"array"}},"required":["nameType","args"]},"DiscoveryRule":{"description":"规则发现部分,数组中有多个对象时表示需要同时满足所有条件的进程才会被匹配到。\ncheckType为cmdLine时checkMode填contain,checkContent格式为[“xxx”]表示进程命令行参数中需要包含xxx。checkType为env时checkMode填contain,checkContent格式为 [\"k1\",\"v1\"]表示进程环境变量中需要包含名为k1值为v1的环境变量。checkType为scope时checkMode填equals,checkContent格式为节点ID数组[\"hostId1”,”hostId2”],表示规则仅会在这些节点上生效(如果不指定节点范围,规则将下发到该项目所有的节点)。","properties":{"checkContent":{"description":"匹配值。","example":"-DNFW=icagent","items":{"type":"string"},"type":"array"},"checkMode":{"description":"匹配条件。contain、equals","example":"contain","type":"string"},"checkType":{"description":"匹配类型。cmdLine、env、scope","example":"cmdLine","type":"string"}},"required":["checkContent","checkMode","checkType"],"type":"object"},"LogPathRule":{"description":"日志路径配置规则。\n当cmdLineHash为固定字符串时,指定日志路径或者日志文件。否则只采集进程当前打开的以.log和.trace结尾的文件。nameType取值cmdLineHash时,args格式为[\"00001\"],value格式为[\"/xxx/xx.log\"],表示当启动命令是00001时,日志路径为/xxx/xx.log。","properties":{"args":{"description":"命令行。","example":"[]","items":{"type":"string"},"type":"array"},"nameType":{"description":"取值类型。\ncmdLineHash","example":"\"\"","type":"string"},"value":{"description":"日志路径。","example":"[]","items":{"type":"string"},"type":"array"}},"required":["args","nameType","value"]},"NameRule":{"description":"服务发现规则命名部分。","properties":{"appNameRule":{"description":"服务命名部分,数组中有多个对象时表示将每个对象抽取到的字符串拼接作为服务的名称。\nnameType取值cmdLine时args格式为[\"start\",\"end\"],表示抽取命令行中start、end之间的字符。\nnameType取值cmdLine时args格式为[\"aa\"],表示抽取环境变量名为aa对应的环境变量值。\nnameType取值str时,args格式为[\"fix\"],表示服务名称最后拼接固定文字fix。\nnameType取值cmdLineHash时,args格式为[\"0001\"],value格式为[\"ser\"],表示当启动命令是0001时,服务名称为ser。","items":{"$ref":"#/definitions/AppNameRule"},"type":"array"},"applicationNameRule":{"description":"应用命名部分。\nnameType取值cmdLine时args格式为[\"start\",\"end\"],表示抽取命令行中start、end之间的字符。\nnameType取值cmdLine时args格式为 [\"aa\"],表示抽取环境变量名为aa对应的环境变量值。\nnameType取值str时,args格式为[\"fix\"],表示服务名称最后拼接固定文字fix。\nnameType取值cmdLineHash时,args格式为[\"0001\"],value格式为[\"ser\"],表示当启动命令是0001时,应用名称为ser。","items":{"$ref":"#/definitions/ApplicationNameRule"},"type":"array"}},"required":["appNameRule","applicationNameRule"],"type":"object"},"ServicesDiscoveryResultInfo":{"properties":{"errorCode":{"description":"响应码。","example":"SVCSTG.INV.2000000","type":"string"},"errorMessage":{"description":"响应信息描述。","example":"null","type":"string"},"id":{"description":"服务发现规则id列表,多AZ配置同步时使用。","items":{"type":"string"},"type":"array"},"responseStatus":{"description":"响应状态码(不再使用)。","format":"int32","type":"integer"},"results":{"description":"服务发现规则详细信息列表。","items":{"additionalProperties":{"type":"string"},"type":"object"},"type":"array"}}}},"description":null,"group_id":"ac32153cf89a435d96dd423fdce82920","host":"aom.cn-north-4.myhuaweicloud.com","id":"f53271cea4174c7298bc8768196ca434","info_version":"v2","method":"put","name":"AddOrUpdateServiceDiscoveryRules","parameters":{},"paths":{"/v1/{project_id}/inv/servicediscoveryrules":{"put":{"description":"该接口用于添加或修改一条或多条服务发现规则。同一projectid下可添加的规则上限为100条。(当前接口未上线墨西哥城二、圣地亚哥、圣保罗一)","operationId":"AddOrUpdateServiceDiscoveryRules","parameters":[{"description":"租户从IAM申请到的projectid,一般为32位字符串。","in":"path","name":"project_id","required":true,"type":"string"},{"description":"服务参数。","in":"body","name":"appRules","required":false,"schema":{"$ref":"#/definitions/AppRulesBody"}},{"description":"从IAM服务获取的用户Token。","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"description":"指定类型为application/json。","enum":["application/json"],"in":"header","name":"Content-Type","required":true,"type":"string"}],"produces":["application/json"],"responses":{"200":{"description":"OK 请求响应成功。","examples":{"application/json":{"errorCode":"SVCSTG.INV.2000000","errorMessage":null,"id":[],"results":[{"id":"b53a5152-****-****-****-302367e04c0b","name":"aom_inventory_rules_event"}]}},"schema":{"$ref":"#/definitions/ServicesDiscoveryResultInfo"}},"400":{"description":"BadRequest 非法请求。建议直接修改该请求,不要重试该请求。","examples":{"application/json":{"errorCode":"SVCSTG.INV.4000115","errorMessage":"Request param is invalid","id":[],"results":[]}},"schema":{"type":"string"}},"401":{"description":"Unauthorized  在客户端提供认证信息后,返回该状态码,表明服务端指出客户端所提供的认证信息不正确或非法。","schema":{"type":"string"}},"403":{"description":"Forbidden 请求被拒绝访问。返回该状态码,表明请求能够到达服务端,且服务端能够理解用户请求,但是拒绝做更多的事情,因为该请求被设置为拒绝访问,建议直接修改该请求,不要重试该请求。","schema":{"type":"string"}},"500":{"description":"InternalServerError 表明服务端能被请求访问到,但是不能理解用户的请求。","schema":{"type":"string"}},"503":{"description":"ServiceUnavailable\n被请求的服务无效。建议直接修改该请求,不要重试该请求。","schema":{"type":"string"}}},"summary":"添加或修改服务发现规则","tags":["监控"],"x-api-type":"open-api","x-is-registered":"Y","x-request-examples-1":{"appRules":[{"createTime":"1694705766730","desc":"自定义描述/User-defined description","enable":true,"eventName":"aom_inventory_rules_event","hostid":[],"id":"b53a5152-****-****-****-302367e04c0b","name":"ica**nt","projectid":"684fc87a79d7xxxx22e62a7da95b","spec":{"aom_metric_relabel_configs":null,"appType":"","attrList":["cmdLine"],"dataSource":null,"detectLog":"true","discoveryRule":[{"checkContent":["-DNFW=ica**nt"],"checkMode":"contain","checkType":"cmdLine"}],"editable":null,"isDefaultRule":null,"isDetect":"false","logFileFix":["log","trace","out"],"logPathRule":[],"nameRule":{"appNameRule":[{"args":["/opt/********* -DNFW=ica**nt"],"nameType":"cmdLineHash","value":["aicagentserver"]}],"applicationNameRule":[{"args":["/opt/*********** -DNFW=ica**nt"],"nameType":"cmdLineHash","value":["aica**nt"]}]},"priority":9999}}]},"x-request-examples-description-1":"添加名称为“aom_inventory_rules_event”且用户project_id为“684fc87a79d7xxxx22e62a7da95b”的应用发现规则。","x-request-examples-text-1":{"appRules":[{"createTime":"1694705766730","desc":"自定义描述/User-defined description","enable":true,"eventName":"aom_inventory_rules_event","hostid":[],"id":"b53a5152-****-****-****-302367e04c0b","name":"ica**nt","projectid":"684fc87a79d7xxxx22e62a7da95b","spec":{"aom_metric_relabel_configs":null,"appType":"","attrList":["cmdLine"],"dataSource":null,"detectLog":"true","discoveryRule":[{"checkContent":["-DNFW=ica**nt"],"checkMode":"contain","checkType":"cmdLine"}],"editable":null,"isDefaultRule":null,"isDetect":"false","logFileFix":["log","trace","out"],"logPathRule":[],"nameRule":{"appNameRule":[{"args":["/opt/********* -DNFW=ica**nt"],"nameType":"cmdLineHash","value":["aicagentserver"]}],"applicationNameRule":[{"args":["/opt/*********** -DNFW=ica**nt"],"nameType":"cmdLineHash","value":["aica**nt"]}]},"priority":9999}}]},"x-request-examples-url-1":"https://{endpoint}/v1/{project_id}/inv/servicediscoveryrules","x-support-sdk":"Y"}}},"product_short":"AOM","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"添加或修改服务发现规则","tags":"监控","uri":null,"version":"2.0"}