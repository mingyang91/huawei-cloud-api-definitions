{"base_path":"/","components":null,"consumes":"[\"application/json;charset=UTF-8\"]","definitions":{"CreateLimitTaskNodeOption":{"properties":{"node_id":{"description":"节点id。","type":"string"},"sql_id":{"description":"该节点执行的sql语句id。如果类型为SQL_ID,必须与limit_type_value值一致。","type":"string"}},"required":["node_id","sql_id"]},"CreateLimitTaskNodeResult":{"properties":{"node_id":{"description":"节点id。","type":"string"},"sql_id":{"description":"该节点执行的sql语句id。","type":"string"}}},"CreateLimitTaskRequestBody":{"properties":{"cpu_utilization":{"description":"cpu利用率阈值,正整数,取值范围[0,100),如果类型为SESSION_ACTIVE_MAX_COUNT,必传,不支持和内存利用率阈值同时为0,如果选择只限制CPU、内存中的其中一个,则另一个必须传值0。","type":"integer"},"databases":{"description":"CN节点数据库组,每个数据库字符串以逗号形式隔,如果类型为SQL_TYPE,则为必传。","type":"string"},"end_time":{"description":"任务结束时间,取值范围:非空且大于任务开始时间,格式必须为yyyy-mm-ddThh:mm:ssZ,当前时间指UTC时间,SQL范围必传。","type":"string"},"key_words":{"description":"关键词,当且仅当类型为SQL_TYPE,必传,多个关键词以逗号隔开,数量范围为[2,100]个,每个关键词长度范围[2,64]位,关键词不允许包含 \" 或 \\ 或 {} 或 null值 以及非首尾的空格符。","type":"string"},"limit_type":{"description":"限流类型:当限流范围为SQL级别时,可选SQL_ID、SQL_TYPE类型,当限流范围为SESSION级别时,可选SESSION_ACTIVE_MAX_COUNT类型。","type":"string"},"limit_type_value":{"description":"限流类型,当限流类型为SQL_ID类型时,该值为选中模板的sqlId,当限流类型为SQL_TYPE类型时,值为SQL类型,目前支持select,update,insert,delete,meger五种值,当限流类型为SESSION_ACTIVE_MAX_COUNT类型时,只支持CPU_OR_MEMORY一种值。","type":"string"},"memory_utilization":{"description":"内存利用率阈值,正整数,取值范围[0,100),如果类型为SESSION_ACTIVE_MAX_COUNT,必传,不支持和cpu利用率阈值同时为0,如果选择只限制CPU、内存中的其中一个,则另一个必须传值0。","type":"integer"},"node_infos":{"description":"CN节点信息列表,如果类型为SQL_ID,则为必传","items":{"$ref":"#/definitions/CreateLimitTaskNodeOption"},"type":"array"},"parallel_size":{"description":"并发数,大于等于零的正整数,取值范围[0, 2147483647]。","type":"integer"},"sql_model":{"description":"CN节点执行过的SQL模板,如果类型为SQLID,则为必传。","type":"string"},"start_time":{"description":"任务开始时间,取值范围:非空且大于等于当前时间的前俩分钟,格式必须为yyyy-mm-ddThh:mm:ssZ,当前时间指UTC时间,SQL范围必传。","type":"string"},"task_name":{"description":"限流任务名,必传,只能为英文字母大小写,下划线,数字和$符,最大长度为100个字符。","type":"string"},"task_scope":{"description":"限流任务范围,目前支持SQL,SESSION级别范围。","type":"string"}},"required":["task_scope","limit_type","limit_type_value","parallel_size","task_name"]},"CreateLimitTaskResponseBody":{"properties":{"cpu_utilization":{"description":"cpu利用率阈值,仅当任务类型为SESSION_ACTIVE_MAX_COUNT时,返回该值且只保留正整数。","type":"integer"},"created":{"description":"创建时间为本地时间,格式为yyyy-mm-ddThh:mm:ssZ。","type":"string"},"creator":{"description":"创建者。","type":"string"},"databases":{"description":"CN节点数据库组,每个数据库字符串以逗号形式隔开。","type":"string"},"end_time":{"description":"限流任务结束时间,与请求参数相同,格式为yyyy-mm-ddThh:mm:ssZ,当前时间指UTC时间。","type":"string"},"instance_id":{"description":"实例id。","type":"string"},"jobId":{"description":"工作流ID。","type":"string"},"key_words":{"description":"关键词,仅当任务类型为SQL_TYPE时,返回该值且与请求参数相同。","items":{"type":"string"},"type":"array"},"limit_type":{"description":"任务限流类型,与请求参数相同。","type":"string"},"limit_type_value":{"description":"任务限流类型值,与请求参数相同。","type":"string"},"memory_utilization":{"description":"内存利用率阈值,仅当任务类型为SESSION_ACTIVE_MAX_COUNT时,返回该值且只保留正整数。","type":"integer"},"modifier":{"description":"更新者。","type":"string"},"node_infos":{"description":"CN节点信息列表,如果类型为SQLID,必返。","items":{"$ref":"#/definitions/CreateLimitTaskNodeResult"},"type":"array"},"parallel_size":{"description":"并发数,与请求参数相同。","type":"integer"},"rule_name":{"description":"规则名。","type":"string"},"sql_model":{"description":"SQL模板,仅当任务类型为SQL_ID时,返回该值且与请求参数相同。","type":"string"},"start_time":{"description":"限流任务开始时间,与请求参数相同,格式为yyyy-mm-ddThh:mm:ssZ,当前时间指UTC时间。","type":"string"},"status":{"description":"限流任务状态,当前支持:CREATING,UPDATEING,DELETING,WAIT_EXCUTE,EXCUTING,TIME_OVER,DELETED,CREATE_FAILED,UPDATE_FAILED,DELETE_FAILED,EXCEPTION,NODE_SHUT_DOWN。","type":"string"},"task_id":{"description":"限流任务ID。","type":"string"},"task_name":{"description":"限流任务名。","type":"string"},"task_scope":{"description":"任务限流范围,与请求参数相同。","type":"string"},"updated":{"description":"更新时间为本地时间,格式为yyyy-mm-ddThh:mm:ssZ。","type":"string"}}},"ErrorResponse":{"properties":{"error_code":{"description":"错误码。","example":"DBS.2xxxxx","type":"string"},"error_msg":{"description":"错误消息。","example":"Cannot do operation with the limit sql id.","type":"string"}},"required":["error_code","error_msg"]}},"description":null,"group_id":"cb81c3e0ae314c27a40e8fc90fd34a80","host":"gaussdb-opengauss.cn-north-4.myhuaweicloud.com","id":"5c80ccf32e9d434c9cdab3277e8ff8dc","info_version":"v3","method":"post","name":"CreateLimitTask","parameters":{},"paths":{"/v3/{project_id}/instances/{instance_id}/limit-task":{"post":{"description":"根据具体范围和类型,进行限流任务的创建","operationId":"CreateLimitTask","parameters":[{"description":"用户Token。","in":"header","name":"X-Auth-Token","required":true,"type":"string","x-example":"******"},{"description":"租户在某一region下的project ID。","in":"path","name":"project_id","required":true,"type":"string","x-example":"4f07d3f50ce2466a9a7c014337b36409"},{"description":"实例ID。","in":"path","name":"instance_id","required":true,"type":"string","x-example":"7912cd1077b2413fbd6f39a044777537in14"},{"description":"请求体。","in":"body","name":"CreateLimitTaskRequestBody","required":true,"schema":{"$ref":"#/definitions/CreateLimitTaskRequestBody"}}],"responses":{"200":{"description":"Success.","examples":{"application/json":{"created":"2023-06-06T01:47:20+0800","creator":"dbs_01","databases":"test1","end_time":"2023-06-07T01:47:20+0800","key_words":"test","limit_type":"SQL_TYPE","limit_type_value":"select","parallel_size":100,"rule_name":"dsa48119d86512e0000bin066a1a27","start_time":"2023-06-06T01:47:20+0800","status":"creating","task_id":"59b6a1a278844ac48119d86512e0000","task_name":"test1","updated":"2023-06-06T01:47:20+0800"}},"schema":{"$ref":"#/definitions/CreateLimitTaskResponseBody"}},"default":{"description":"Client or server error.","schema":{"$ref":"#/definitions/ErrorResponse"}}},"summary":"创建限流任务","tags":["SQL限流"],"x-apigateway-ratelimit":"opengauss_default_policy","x-file":"limit_task","x-is-registered":"Y","x-request-examples-1":{"databases":"test1","end_time":"2023-06-07T01:47:20+0800","limit_type":"SQL_ID","limit_type_value":"39b6a1a","node_infos":[{"node_id":"e603348513654c209e4b955d98324655no14","sql_id":"39b6a1a"}],"parallel_size":100,"sql_model":"select * from a where b = ?","start_time":"2023-06-06T01:47:20+0800","task_name":"test1","task_scope":"SQL"},"x-request-examples-2":{"databases":"test1","end_time":"2023-06-07T01:47:20+0000","key_words":"table1,id","limit_type":"SQL_TYPE","limit_type_value":"select","parallel_size":100,"start_time":"2023-06-06T01:47:20+0000","task_name":"test1","task_scope":"SQL"},"x-request-examples-3":{"cpu_utilization":80,"end_time":"2023-06-07T01:47:20+0800","limit_type":"SESSION_ACTIVE_MAX_COUNT","limit_type_value":"CPU_OR_MEMORY","memory_utilization":80,"parallel_size":100,"start_time":"2023-06-06T01:47:20+0800","task_scope":"SESSION"},"x-request-examples-description-1":"创建限流任务","x-request-examples-url-1":"POST https://{endpoint}/rds/gaussdb/v3/4f07d3f50ce2466a9a7c014337b36409/instances/7912cd1077b2413fbd6f39a044777537in14/limit-task","x-request-examples-url-2":"POST https://{endpoint}/rds/gaussdb/v3/4f07d3f50ce2466a9a7c014337b36409/instances/7912cd1077b2413fbd6f39a044777537in14/limit-task","x-request-examples-url-3":"POST https://{endpoint}/rds/gaussdb/v3/4f07d3f50ce2466a9a7c014337b36409/instances/7912cd1077b2413fbd6f39a044777537in14/limit-task","x-support-sdk":"Y"}}},"product_short":"GaussDBforopenGauss","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"创建限流任务","tags":"SQL限流","uri":null,"version":"2.0"}