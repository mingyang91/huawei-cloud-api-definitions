{"base_path":null,"components":null,"consumes":"","definitions":{"AgenciesPrimitiveTypeHolder":{"example":{"agencies":[{"agency_name":"my_agency","provider_name":"huaweicloud"}]},"properties":{"agencies":{"description":"委托授权的信息。\n\nRFS仅在创建资源栈(触发部署)、创建执行计划、部署资源栈、删除资源栈等涉及资源操作的请求中使用委托,且该委托仅作用于与之绑定的Provider对资源的操作中。若委托中提供的权限不足,有可能导致相关资源操作失败。\n\n[创建委托及授权方式](https://support.huaweicloud.com/usermanual-iam/iam_06_0002.html)","items":{"$ref":"#/definitions/Agency"},"maxItems":10,"minItems":0,"type":"array","x-omitempty":true}},"type":"object"},"Agency":{"description":"委托授权的信息","properties":{"agency_name":{"description":"对应provider所使用的IAM委托名称,资源编排服务会使用此委托的权限去访问、创建对应provider的资源。agency_name和agency_urn必须有且只有一个存在","maxLength":64,"minLength":1,"type":"string","x-isnullable":true,"x-omitempty":true},"agency_urn":{"description":"委托URN\n\n当用户定义Agency时,agency_name和agency_urn 必须有且只有一个存在。\n\n推荐用户在使用v5委托时给与agency_urn,agency_name只支持接收普通委托名称,若给与了v5委托名称,则会在部署模板时失败。","pattern":"^(iam:\\*?:[A-Za-z0-9-]{1,64}:agency:.{1,64})?$","type":"string","x-isnullable":true,"x-omitempty":true},"provider_name":{"description":"用户使用的provider的名字。如果用户给与的provider_name含有重复的值,则返回400","maxLength":128,"minLength":1,"type":"string"}},"required":["provider_name"],"type":"object"},"CommonErrorResponse":{"description":"通用错误响应体","properties":{"encoded_authorization_message":{"description":"包含有关未经授权请求的信息。","type":"string","x-omitempty":true},"error_code":{"description":"响应码","maxLength":11,"minLength":11,"type":"string"},"error_msg":{"description":"响应消息","type":"string"}},"type":"object"},"CreateStackRequestBody":{"allOf":[{"$ref":"#/definitions/StackNamePrimitiveTypeHolder"},{"$ref":"#/definitions/AgenciesPrimitiveTypeHolder"},{"$ref":"#/definitions/StackDescriptionPrimitiveTypeHolder"},{"$ref":"#/definitions/EnableDeletionProtectionPrimitiveTypeHolder"},{"$ref":"#/definitions/EnableAutoRollbackPrimitiveTypeHolder"},{"$ref":"#/definitions/TemplateBodyPrimitiveTypeHolder"},{"$ref":"#/definitions/TemplateURIPrimitiveTypeHolder"},{"$ref":"#/definitions/VarsBodyPrimitiveTypeHolder"},{"$ref":"#/definitions/VarsStructurePrimitiveTypeHolder"},{"$ref":"#/definitions/VarsURIPrimitiveTypeHolder"}]},"CreateStackResponseBody":{"allOf":[{"$ref":"#/definitions/StackIdPrimitiveTypeHolder"},{"example":{"deployment_id":"d102dda3-10af-48db-75bb-16c2661c79d6"},"properties":{"deployment_id":{"description":"部署ID","type":"string","x-omitempty":true}},"type":"object"}]},"EnableAutoRollbackPrimitiveTypeHolder":{"example":{"enable_auto_rollback":false},"properties":{"enable_auto_rollback":{"description":"自动回滚的标识位,如果不传默认为false,即默认不开启资源栈自动回滚(自动回滚开启后,如果部署失败,则会自动回滚,并返回上一个稳定状态)\n\n*在UpdateStack API中,若该参数未在RequestBody中给予,则不会对资源栈的自动回滚属性进行更新*\n*该属性与使用模板导入资源功能互斥,如果堆栈的自动回滚设置为true,则不允许部署包含导入资源的模板*","type":"boolean","x-isnullable":true,"x-omitempty":false}},"type":"object"},"EnableDeletionProtectionPrimitiveTypeHolder":{"example":{"enable_deletion_protection":false},"properties":{"enable_deletion_protection":{"description":"删除保护的标识位,如果不传默认为false,即默认不开启资源栈删除保护(删除保护开启后资源栈不允许被删除)\n\n*在UpdateStack API中,若该参数未在RequestBody中给予,则不会对资源栈的删除保护属性进行更新*","type":"boolean","x-isnullable":true,"x-omitempty":false}},"type":"object"},"EncryptionStructure":{"description":"如果用户传递的var_value是已经加密过的,可以通过声名此项以要求资源编排服务在使用前进行解密,目前暂时只支持KMS加解密","properties":{"kms":{"$ref":"#/definitions/KmsStructure"}},"required":["kms"],"type":"object"},"KmsStructure":{"description":"如果用户给与的var_value是经过KMS加密的,可以通过传递相关加密信息,资源编排服务在使用的时候会帮助用户进行KMS解密\n\n更多关于KMS加密以及KMS加密的样例代码请见:[KMS加密使用场景介绍](https://support.huaweicloud.com/productdesc-dew/dew_01_0006.html)\n\n\n**注意:**\n  * 请确保用户给予资源编排服务的委托中包含对指定秘钥ID的操作权限\n  * KMS每个月有免费试用的额度,如果超过,则KMS需要收费,此费用不是资源编排服务收取,具体标准见:[https://www.huaweicloud.com/pricing.html?tab=detail#/dew](https://www.huaweicloud.com/pricing.html?tab=detail#/dew)\n  * KMS加密只代表资源编排服务在存储和传输的时候传递的是密文,但是在stack-events中依然是明文,如果希望在log中以密文形式对待,请在模板中声明sensitive,更多关于sensitive的介绍见:[https://learn.hashicorp.com/tutorials/terraform/sensitive-variables](https://learn.hashicorp.com/tutorials/terraform/sensitive-variables)","properties":{"cipher_text":{"description":"数据加密秘钥所对应的密文","maxLength":2048,"minLength":2,"type":"string"},"id":{"description":"解密时,资源编排服务应该使用的KMS秘钥的ID,通常是加密时所使用的秘钥ID","maxLength":36,"minLength":36,"pattern":"^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$","type":"string"}},"required":["cipher_text","id"],"type":"object"},"StackDescriptionPrimitiveTypeHolder":{"example":{"description":"My First Hello World Stack"},"properties":{"description":{"description":"资源栈的描述。可用于客户识别自己的资源栈。","maxLength":1024,"minLength":0,"type":"string","x-omitempty":true}},"type":"object"},"StackIdPrimitiveTypeHolder":{"example":{"stack_id":"1b15e005-bdbb-4bd7-8f9a-a09b6774b4b3"},"properties":{"stack_id":{"description":"资源栈(stack)的唯一ID。\n\n此ID由资源编排服务在生成资源栈的时候生成,为UUID。\n\n由于资源栈名仅仅在同一时间下唯一,即用户允许先生成一个叫HelloWorld的资源栈,删除,再重新创建一个同名资源栈。\n\n对于团队并行开发,用户可能希望确保,当前我操作的资源栈就是我认为的那个,而不是其他队友删除后创建的同名资源栈。因此,使用ID就可以做到强匹配。\n\n资源编排服务保证每次创建的资源栈所对应的ID都不相同,更新不会影响ID。如果给与的stack_id和当前资源栈的ID不一致,则返回400","type":"string"}},"type":"object"},"StackNamePrimitiveTypeHolder":{"example":{"stack_name":"MyHelloWorldStackName"},"properties":{"stack_name":{"description":"资源栈的名称。此名字在domain_id+区域+project_id下应唯一,可以使用中文、大小写英文、数字、下划线、中划线。首字符需为中文或者英文,区分大小写。","maxLength":128,"minLength":1,"pattern":"^[一-龥A-Za-z]+[一-龥A-Za-z0-9_-]*$","type":"string"}},"required":["stack_name"],"type":"object"},"TemplateBodyPrimitiveTypeHolder":{"example":{"template_body":""},"properties":{"template_body":{"description":"HCL模板,描述了资源的目标状态。资源编排服务将比较此模板与当前远程资源的状态之间的区别。\n\ntemplate_body和template_uri 必须有且只有一个存在\n\n**注意:**\n  * 资源栈集不支持敏感数据加密,资源编排服务会直接明文使用、log、展示、存储对应的template_body","maxLength":51200,"minLength":0,"type":"string"}},"type":"object"},"TemplateURIPrimitiveTypeHolder":{"example":{"template_uri":"https://your-bucket.cn-north-7.myhuaweicloud.com/my-hello-world-template.tf"},"properties":{"template_uri":{"description":"HCL模板的OBS地址,该模板描述了资源的目标状态。资源编排服务将比较此模板与当前远程资源的状态之间的区别\n\nOBS地址支持同类型Region之间进行互相访问(Region分为通用Region和专属Region,通用Region指面向公共租户提供通用云服务的Region;专属Region指只承载同一类业务或只面向特定租户提供业务服务的专用Region)\n\n对应的文件应该是纯tf文件或zip压缩包\n\n纯tf文件需要以“.tf”或者“.tf.json”结尾,并遵守HCL语法,且文件的编码格式须为UTF-8\n\n压缩包目前只支持zip格式,文件需要以\".zip\"结尾。解压后的文件不得包含\".tfvars\"文件。解压前最大支持1MB,解压后最大支持1MB。zip压缩包文件数量不能超过100个\n\ntemplate_body和template_uri 必须有且只有一个存在\n\n**注意:**\n  * 资源栈集不支持敏感数据加密,资源编排服务会直接明文使用、log、展示、存储template_uri对应的模板文件内容。\n  * template_uri对应的模板文件若为zip类型,则内部的文件或文件夹名称长度不得超过255个字节,最深路径长度不得超过2048字节,zip包大小不得超过1MB","maxLength":2048,"minLength":0,"pattern":"^(http|https)://[\\S]*(\\.tf|\\.tf.json|\\.zip){1}(\\?[\\S]+)?$","type":"string"}},"type":"object"},"VarsBodyPrimitiveTypeHolder":{"example":{"vars_body":""},"properties":{"vars_body":{"description":"HCL参数文件的内容。HCL模板支持参数传入,即,同一个模板可以给予不同的参数而达到不同的效果。\n\n* vars_body使用HCL的tfvars格式,用户可以将“.tfvars”中的内容提交到vars_body中\n\n* 资源编排服务支持vars_body和vars_uri,如果他们中声名了同一个变量,将报错400\n\n* 如果vars_body过大,可以使用vars_uri\n\n* 资源栈集不支持敏感数据加密,资源编排服务会直接明文使用、log、展示、存储对应的vars_body。","maxLength":51200,"minLength":0,"type":"string"}},"type":"object"},"VarsStructure":{"description":"HCL支持参数,即,同一个模板可以给予不同的参数而达到不同的效果。\n\nvar_structure可以允许客户提交最简单的字符串类型的参数\n\n资源编排服务支持vars_structure,vars_body和vars_uri,如果他们中声名了同一个变量,将报错400\n\nvars_structure中的值只支持简单的字符串类型,如果需要使用其他类型,需要用户自己在HCL引用时转换,\n或者用户可以使用vars_uri、vars_body,vars_uri和vars_body中支持HCL支持的各种类型以及复杂结构\n\n如果vars_structure过大,可以使用vars_uri\n\n注意:vars中不应该传递任何敏感信息,资源编排服务会直接明文使用、log、展示、存储对应的vars","properties":{"encryption":{"$ref":"#/definitions/EncryptionStructure"},"var_key":{"description":"参数的名字","maxLength":32,"minLength":1,"pattern":"^[a-zA-Z]+[a-zA-Z0-9-_]*$","type":"string"},"var_value":{"description":"参数的值。\n\n注意,参数需要以字符串形式存在,如果是数字,也需要以字符串形式存在,如'10'。\n\n如果需要支持不同类型,或者复杂结构,请使用vars_uri或vars_body","maxLength":2048,"minLength":0,"type":"string"}},"required":["var_key","var_value"],"type":"object"},"VarsStructurePrimitiveTypeHolder":{"example":{"vars_structure":[{"encryption":{"kms":{"cipher_text":"jslkjreiqpeorikshshlld","id":"344d38b3-267e-435c-a1e1-f50356162173"}},"var_key":"region","var_value":"cn-north-7"}]},"properties":{"vars_structure":{"description":"HCL参数结构。HCL模板支持参数传入,即,同一个模板可以给予不同的参数而达到不同的效果。\n\n* var_structure可以允许客户提交最简单的字符串类型的参数\n\n* 资源编排服务支持vars_structure,vars_body和vars_uri,如果他们中声名了同一个变量,将报错400\n\n* vars_structure中的值只支持简单的字符串类型,如果需要使用其他类型,需要用户自己在HCL引用时转换,\n或者用户可以使用vars_uri、vars_body,vars_uri和vars_body中支持HCL支持的各种类型以及复杂结构\n\n* 如果vars_structure过大,可以使用vars_uri\n\n* 注意:vars_structure中默认不应该含有任何敏感信息,资源编排服务会直接明文使用、log、展示、存储对应的vars。如为敏感信息,建议设置encryption字段开启加密","items":{"$ref":"#/definitions/VarsStructure"},"maxItems":100,"minItems":0,"type":"array","x-omitempty":true}},"type":"object"},"VarsURIPrimitiveTypeHolder":{"example":{"vars_uri":"https://your-bucket.cn-north-7.myhuaweicloud.com/my-hello-world-vars.tfvars"},"properties":{"vars_uri":{"description":"HCL参数文件的OBS地址。HCL模板支持参数传入,即,同一个模板可以给予不同的参数而达到不同的效果。\n\nOBS地址支持同类型Region之间进行互相访问(Region分为通用Region和专属Region,通用Region指面向公共租户提供通用云服务的Region;专属Region指只承载同一类业务或只面向特定租户提供业务服务的专用Region)\n\n* vars_uri需要指向一个OBS的pre-signed URL地址,其他地址暂不支持\n\n* 资源编排服务支持vars_body和vars_uri,如果他们中声名了同一个变量,将报错400\n\n* vars_uri中的内容使用HCL的tfvars格式,用户可以将“.tfvars”中的内容保存到文件并上传到OBS中,并将OBS pre-signed URL传递给vars_uri\n\n* 资源栈集不支持敏感数据加密,资源编排服务会直接明文使用、log、展示、存储vars_uri对应的参数文件内容","maxLength":2048,"minLength":0,"pattern":"^(http|https)://[\\S]*(\\.tfvars){1}(\\?[\\S]+)?$","type":"string"}},"type":"object"}},"description":null,"group_id":"ffbc0f3a195c4338b5218addf5d56a6c","host":"aos.cn-north-4.myhuaweicloud.com","id":"cce480ade10844abb2c703478396cdb6","info_version":"v1","method":"post","name":"CreateStack","parameters":{},"paths":{"/v1/{project_id}/stacks":{"post":{"description":"CreateStack用于生成一个资源栈\n\n* 当请求中不含有模板(template)、参数(vars)等信息,将生成一个无任何资源的空资源栈,返回资源栈ID(stack_id)\n* 当请求中携带了模板(template)、参数(vars)等信息,则会同时创建并部署资源栈,返回资源栈ID(stack_id)和部署ID(deployment_id)","operationId":"CreateStack","parameters":[{"description":"用户指定的,对于此请求的唯一ID,用于定位某个请求,推荐使用UUID","in":"header","maxLength":128,"minLength":36,"name":"Client-Request-Id","pattern":"^[A-Za-z0-9]+[A-Za-z0-9-]*$","required":true,"type":"string"},{"description":"项目ID,可以从调用API处获取,也可以从控制台获取。\n\n[项目ID获取方式](https://support.huaweicloud.com/api-ticket/ticket_api_20002.html)","in":"path","maxLength":64,"minLength":3,"name":"project_id","pattern":"^[A-Za-z0-9-]+$","required":true,"type":"string"},{"description":"CreateStack API的请求Body体","in":"body","name":"CreateStackRequestBody","required":true,"schema":{"$ref":"#/definitions/CreateStackRequestBody"}}],"produces":["application/json"],"responses":{"201":{"description":"创建成功","examples":{"x-response-examples-1":{"stack_id":"ea6a4f0e-ee8a-494e-b12a-8be4a1e65af2"}},"schema":{"$ref":"#/definitions/CreateStackResponseBody"}},"400":{"description":"用户请求非法","schema":{"$ref":"#/definitions/CommonErrorResponse"}},"401":{"description":"用户身份认证失败","schema":{"$ref":"#/definitions/CommonErrorResponse"}},"403":{"description":"1. 用户无权限调用此API\n2. 资源栈数量达到上限","schema":{"$ref":"#/definitions/CommonErrorResponse"}},"409":{"description":"创建冲突,同名的资源栈已经存在","schema":{"$ref":"#/definitions/CommonErrorResponse"}},"429":{"description":"请求数量过多","schema":{"$ref":"#/definitions/CommonErrorResponse"}},"500":{"description":"服务器内部错误","schema":{"$ref":"#/definitions/CommonErrorResponse"}}},"summary":"创建资源栈","tags":["Stack"],"x-api-type":"open-api","x-is-registered":"Y","x-request-examples-1":{"description":"my first stack","stack_name":"my_first_stack"},"x-request-examples-2":{"agencies":[{"agency_name":"my_agency","provider_name":"huaweicloud"}],"description":"my second stack","stack_name":"my_second_stack"},"x-request-examples-3":{"description":"my third stack","stack_name":"my_third_stack","template_uri":"https://my_hello_world_bucket.{region}.myhuaweicloud.com/my-hello-world-template.tf"},"x-request-examples-4":{"description":"my fourth stack","stack_name":"my_fourth_stack","template_body":"terraform {\n    required_providers {\n      huaweicloud = {\n        source = \"huawei.com/provider/huaweicloud\"\n        version = \"1.41.0\"\n        }\n    }\n}\nprovider \"huaweicloud\"{\n    insecure = true\n    cloud = \"{cloud_name}\"\n    region = \"{region}\"\n    endpoints = {\n        iam = \"{iam_endpoint}\",\n    }\n}\n\nresource \"huaweicloud_vpc\" \"vpc\" {\n  cidr = \"172.16.0.0/16\"\n  name = \"my_vpc\"\n}"},"x-request-examples-description-1":"创建资源栈","x-request-examples-description-2":"使用委托创建资源栈","x-request-examples-description-3":"使用模板的uri创建并部署资源栈","x-request-examples-description-4":"使用模板内容创建并部署资源栈","x-request-examples-url-1":"POST https://{endpoint}/v1/ba2b9930c977f71edaeaa3a5e96a8ff1/stacks","x-request-examples-url-2":"POST https://{endpoint}/v1/ba2b9930c977f71edaeaa3a5e96a8ff1/stacks","x-request-examples-url-3":"POST https://{endpoint}/v1/ba2b9930c977f71edaeaa3a5e96a8ff1/stacks","x-support-sdk":"Y"}}},"product_short":"AOS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":{"apig-auth-app":{"in":"header","name":"Authorization","type":"apiKey","x-apigateway-auth-type":"AppSigv1"},"apig-auth-app-optional":{"in":"header","name":"Authorization","type":"apiKey","x-apigateway-auth-opt":{"access-auth-type":"optional"},"x-apigateway-auth-type":"AppSigv1"},"apig-auth-iam":{"in":"header","name":"unused","type":"apiKey","x-apigateway-auth-type":"IAM"},"apig-auth-iam-none":{"in":"header","name":"unused","type":"apiKey","x-apigateway-auth-type":"IAM_NONE"},"token":{"in":"header","name":"X-Auth-Token","type":"apiKey"}},"summary":"创建资源栈","tags":"资源编排-资源栈","uri":null,"version":"2.0"}