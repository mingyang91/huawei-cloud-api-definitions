{"base_path":"/","components":null,"consumes":"[\"application/xml;charset=UTF-8\"]","definitions":{"Error":{"description":"错误响应消息体\n","properties":{"Code":{"description":"错误响应消息体XML中错误响应对应的HTTP消息返回码,具体的错误码请参见[错误码-表2](https://support.huaweicloud.com/api-obs/obs_04_0115.html#obs_04_0115__d0e843)。\n","type":"string"},"HostId":{"description":"返回该消息的服务端ID。\n","type":"string"},"Message":{"description":"错误响应消息体XML中具体错误更全面、详细的英文解释,具体的错误消息请参见[错误码-表2](https://support.huaweicloud.com/api-obs/obs_04_0115.html#obs_04_0115__d0e843)。\n","type":"string"},"RequestId":{"description":"本次错误请求的请求ID,用于错误定位。\n","type":"string"},"Resource":{"description":"该错误相关的桶或对象资源。\n","type":"string"}}},"SetBucketMirrorBackToSourceRequestBody":{"properties":{"rules":{"description":"策略规则数组。\n说明:\n  同一个桶下的不同策略前缀不能重复和起始包含,委托建议使用同一个。\n","items":{"properties":{"condition":{"$ref":"#/definitions/condition"},"id":{"description":"规则ID。当前桶上配置的镜像回源规则的唯一标识。\n取值范围:[1, 256],满足“^[a-zA-Z0-9_-]{1, 256}$”\n","example":"abc123","type":"string"},"redirect":{"$ref":"#/definitions/redirect"}},"required":["id","condition","redirect"]},"type":"array"}},"required":["rules"],"type":"object","xml":{"name":"MirrorBackToSourceRules"}},"condition":{"description":"触发回源功能的条件。\n","properties":{"httpErrorCodeReturnedEquals":{"description":"触发回源功能的错误码。当下载请求返回此错误码时,会触发回源功能。\n","enum":["404"],"type":"string"},"objectKeyPrefixEquals":{"description":"触发回源功能的对象名前缀。当触发回源的请求里对象名满足此前缀,才会继续执行回源功能。当前缀配置为空时,默认所有对象都匹配。同一个桶上多条规则的前缀之间不允许重复和起始包含。\n有效值:长度[0, 1023],值允许为任意字符\n","example":"video/","maxLength":1023,"minLength":0,"type":"string"}},"required":["httpErrorCodeReturnedEquals"]},"mirrorHttpHeader":{"description":"HTTP header传递规则。\n","properties":{"pass":{"description":"指定透传的HTTP header列表。\n\n取值范围:最大10个,每个长度[1, 63],key只支持字母(大小写)、数字、中划线、下划线\n","example":["content-encoding"],"items":{"maxLength":63,"minLength":1,"type":"string"},"maxItems":10,"minItems":0,"type":"array"},"passAll":{"description":"是否透传全部HTTP header到源端。\n\n以下HTTP header类型不支持透传:\n1.以下前缀开头的header:\nx-obs-\nx-amz-\n\n2.所有标准HTTP header,例如:\nContent-Length\nAuthorization\nDate\npassAll与pass互斥。\n","enum":[true,false],"type":"boolean"},"remove":{"description":"不允许透传的HTTP header列表。\nremove优先级高于pass和passAll。\n\n取值范围:最大10个,每个长度[1, 63],key只支持字母(大小写)、数字、中划线、下划线\n","example":["content-type"],"items":{"maxLength":63,"minLength":1,"type":"string"},"maxItems":10,"type":"array"},"set":{"description":"设置透传的HTTP header值列表。\nset优先级高于remove,pass和passAll。\n如果自定义头域中包含了Referer头域,必须将redirectWithoutReferer设置为true,不然会被覆盖\n\n取值范围:最大10个\n","items":{"properties":{"key":{"description":"设置需要透传HTTP header的关键字。\n\n多条key之间不允许重复。\n取值范围:长度[1, 63],只支持字母(大小写)、数字、中划线、下划线\n","example":"helloworld","maxLength":63,"minLength":1,"type":"string"},"value":{"description":"设置需要透传HTTP header的值。\n\n取值范围:长度[0, 2048]\n","example":2222,"maxLength":2048,"minLength":0,"type":"string"}}},"maxItems":10,"type":"array"}}},"redirect":{"description":"回源功能主要参数。\n","properties":{"agency":{"description":"委托名。客户通过委托赋予OBS服务查询用户桶内指定对象是否存在以及向用户桶内上传对象的权限。\n","example":"agency","type":"string"},"mirrorAllowHttpMethod":{"description":"需要透传的http请求的类型,如HEAD,目前只支持HEAD\n","example":["HEAD"],"items":{"type":"string"},"type":"array"},"mirrorFollowRedirect":{"description":"是否跟随源站3xx重定向请求获取到资源。如果是true,跟随源站3xx重定向请求获取到资源。否则,OBS会透传3XX响应,不获取资源。该值默认值是false,如果设置为false则会忽略。\n","enum":[true,false],"type":"boolean"},"mirrorHttpHeader":{"$ref":"#/definitions/mirrorHttpHeader"},"passQueryString":{"description":"是否携带请求字符串。如果是true,会将OBS请求中的queryString传递到源站。否则,则不会将queryString传递到源站。\n该值默认值是false,如果设置为false则会忽略。\n\n说明:\n如果是true,但query里有签名信息,则将签名信息去掉,剩余参数再传递。\n","enum":[true,false],"type":"boolean"},"publicSource":{"description":"公共可访问源端配置。当源端为公共可访问的资源时,必选。\n","properties":{"sourceEndpoint":{"$ref":"#/definitions/sourceEndpoint"}}},"redirectWithoutReferer":{"description":"是否将原host作为referer头域携带到重定向的目的地址去。false为需要携带, true为不携带。\n","enum":[true,false],"type":"boolean"},"replaceKeyPrefixWith":{"description":"替换前缀objectKeyPrefixEquals的字符串。如果去源端下载对象时,需要替换当前的对象名前缀,则修改此项配置。\n\n如果replaceKeyWith和ReplaceKeyPrefixWith同时为空,则ReplaceKeyPrefixWith生效。同时非空为非法请求。\n\n类型:字符串\n\n取值范围:长度[0, 1023]\n","example":"picture/","maxLength":1023,"minLength":0,"type":"string"},"replaceKeyWith":{"description":"添加前后缀。去源端下载对象的时候,如果需要添加前缀或后缀,则修改此项配置为prefix${key}suffix。如果不需要增加前后缀,则配置为${key}。\n\n取值范围:prefix${key}suffix。\n\n${key}为关键字,prefix为要添加的前缀,suffix为要添加的后缀。同时prefix和suffix的总长度[0, 1023]\n","example":"prefix${key}suffix","maxLength":1023,"minLength":0,"type":"string"},"retryConditions":{"description":"回源地址切换的条件。\n\n类型:数组\n\n取值范围:4XX,5XX以及400~499,500~599等具体错误码\n\n说明:\n4XX和4开头的具体错误码不能同时配置,5XX和5开头的错误码不能同时配置。\n\n最大支持同时配置20个错误码\n","example":["4XX","5XX"],"items":{"type":"string"},"type":"array"},"vpcEndpointURN":{"description":"终端节点服务的URN。\n取值范围:长度[0, 127]\n","example":1,"maxLength":127,"minLength":0,"type":"string"}},"required":["agency","passQueryString","mirrorFollowRedirect"]},"sourceEndpoint":{"description":"公共可访问的源端地址。\n","properties":{"master":{"description":"主源端地址。如果源端为HTTP公共可访问的桶,则此地址为桶域名地址。如果源端为其他云厂商的私有桶,则此地址为区域域名地址。\n\n有效取值:单个源站地址格式为https|http://xxx.yyy.zzz,长度为[10, 255]\n\n说明:\n回源时会优先使用主源站地址,如果同时配置多个主地址,会轮询访问所有主地址。如果配置2个及以上主地址,第一次请求主地址失败,并且满足重试条件时,会选用另一个主地址重试一次。\n至少配置一个主地址。\n最多同时配置5个主地址。\n","example":["http://bucket1.xxx.yyy.com","https://bucket2.xxx.yyy.com"],"items":{"type":"string"},"type":"array"},"slave":{"description":"备源端地址。如果源端为HTTP公共可访问的桶,则此地址为桶域名地址。如果源端为其他云厂商的私有桶,则此地址为区域域名地址。\n\n有效取值:单个源站地址格式为https|http://xxx.yyy.zzz,长度为[10, 255]\n\n说明:\n主地址回源失败时,会选用一个备地址进行重试。\n最多同时配置5个备地址。\n","example":["http://bucket3.xxx.yyy.com","https://bucket4.xxx.yyy.com"],"items":{"type":"string"},"type":"array"}}}},"description":null,"group_id":"7d10a01d10854bd59cf6189eebfb9c7d","host":"obs.cn-north-4.myhuaweicloud.com","id":"8d23ee61cf984273a06695b7934ee87d","info_version":"v1","method":"put","name":"SetBucketMirrorBackToSource","parameters":{},"paths":{"/":{"put":{"consumes":["application/json"],"description":"本接口用于为指定桶配置镜像回源策略。接口是幂等的,若桶上已存在相同策略内容,则返回成功,status code返回值为200;否则status code返回值为201。\n","operationId":"SetBucketMirrorBackToSource","parameters":[{"description":"请求消息中可带的签名信息。\n","in":"header","name":"Authorization","required":true,"type":"string"},{"description":"请求发起端的日期和时间,例如:Wed, 27 Jun 2018 13:39:15 +0000。\n默认值:无。\n条件:如果消息头中带了x-obs-date字段,则可以不带该字段,其他情况下必选。\n","in":"header","name":"Date","required":false,"type":"string","x-apiexplorer-format":"date-gmt"},{"description":"策略规则数组。\n","in":"body","name":"SetBucketMirrorBackToSourceRequestBody","required":true,"schema":{"$ref":"#/definitions/SetBucketMirrorBackToSourceRequestBody"}},{"description":"请求的桶名称。\n","in":"query","maxLength":63,"minLength":3,"name":"bucket_name","required":true,"type":"string","x-location-cname":true},{"allowEmptyValue":true,"description":"mirrorBackToSource表示请求桶的镜像回源规则API。\n","in":"query","maxLength":0,"minLength":0,"name":"mirrorBackToSource","required":true,"type":"string"}],"produces":["application/json"],"responses":{"200":{"description":"请求成功响应消息。\n","headers":{"Connection":{"description":"指明与服务器的连接是长连接还是短连接。\n","type":"string"},"Content-Length":{"description":"响应消息体的字节长度。\n","type":"string"},"Date":{"description":"OBS系统响应的时间。\n","type":"string"},"ETag":{"description":"对象的base64编码的128位MD5摘要。ETag是对象内容的唯一标识,可以通过该值识别对象内容是否有变化。比如上传对象时ETag为A,下载对象时ETag为B,则说明对象内容发生了变化。实际的ETag是对象的哈希值。ETag只反映变化的内容,而不是其元数据。上传的对象或拷贝操作创建的对象,通过MD5加密后都有唯一的ETag。如果通过多段上传对象,则无论加密方法如何,MD5会拆分ETag,此类情况ETag就不是MD5的摘要。\n","type":"string"},"x-obs-id-2":{"description":"帮助定位问题的特殊符号。\n","type":"string"},"x-obs-request-id":{"description":"由OBS创建来唯一确定本次请求的值,可以通过该值来定位问题。\n","type":"string"}}},"400":{"description":"请求失败响应消息。\n","schema":{"$ref":"#/definitions/Error"}}},"summary":"设置桶的镜像回源规则","tags":["桶的高级配置"],"x-is-registered":"Y","x-request-examples-1":"PUT /?mirrorBackToSource HTTP/1.1\nHost: bucketname.obs.cn-north-4.myhuaweicloud.com \nAuthorization: OBS H4IPJX0TQTHTHEBQQCEC:sc2PM13Wlfcoc/YZLK0MwsI2Zpo=\nContent-Type: application/json\nContent-Length: 1049\nDate: Tue, 21 Jul 2020 15:38:30 GMT\n\n{\n    \"rules\": [{\n        \"id\": \"abc123\",\n        \"condition\": {\n            \"httpErrorCodeReturnedEquals\": \"404\",\n            \"objectKeyPrefixEquals\": \"video/\"\n        },\n        \"redirect\": {\n            \"agency\": \"agency\",\n            \"publicSource\": {\n                \"sourceEndpoint\": {\n                    \"master\":[\"http://bucket1.xxx.yyy.com\", \"https://bucket2.xxx.yyy.com\"],\n                    \"slave\": [\"http://bucket3.xxx.yyy.com\", \"https://bucket4.xxx.yyy.com\"]\n                }\n            },\n            \"retryConditions\": [\"4XX\", \"5XX\"],\n            \"passQueryString\": true,\n            \"mirrorFollowRedirect\": true,\n            \"redirectWithoutReferer\": true,\n            \"mirrorAllowHttpMethod\":[\"HEAD\"],\n            \"mirrorHttpHeader\": {\n                \"passAll\": false,\n                \"pass\": [\"content-encoding\"],\n                \"remove\": [\"content-type\"],\n                \"set\": [{\n                    \"key\": \"helloworld\",\n                    \"value\": \"2222\"\n                }]\n            },\n            \"replaceKeyWith\": \"prefix${key}suffix\",\n            \"replaceKeyPrefixWith\": \"picture/\",\n            \"vpcEndpointURN\": \"001\"\n        }\n    }]\n}\n","x-request-examples-url-1":"/?mirrorBackToSource","x-support-sdk":"N"}}},"product_short":"OBS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"设置桶的镜像回源规则","tags":"桶的高级配置","uri":null,"version":"2.0"}