{"base_path":"/","components":null,"consumes":"","definitions":{"PolicyTemplateInfo":{"properties":{"constraint_template":{"description":"策略模板内容","example":{"apiVersion":"templates.gatekeeper.sh/v1","kind":"ConstraintTemplate","metadata":{"annotations":{"description":"Controls the allowed `procMount` types for the container. Corresponds to the `allowedProcMountTypes` field in a PodSecurityPolicy. For more information, see https://kubernetes.io/docs/concepts/policy/pod-security-policy/#allowedprocmounttypes","description-chinese":"限制Pod允许挂载的Proc类型","level":"3","metadata.gatekeeper.sh/title":"Proc Mount","metadata.gatekeeper.sh/version":"1.0.0","name-chinese":"K8sPSPProcMount","tag":"Container/ApplicationSecurityPolicies","tag-chinese":"容器/应用安全策略","targetKind":"Pod","type":"security"},"creationTimestamp":null,"name":"k8spspprocmount"},"spec":{"crd":{"spec":{"names":{"kind":"K8sPSPProcMount"},"validation":{"openAPIV3Schema":{"description":"Controls the allowed `procMount` types for the container. Corresponds to the `allowedProcMountTypes` field in a PodSecurityPolicy. For more information, see https://kubernetes.io/docs/concepts/policy/pod-security-policy/#allowedprocmounttypes","properties":{"exemptImages":{"description":"Any container that uses an image that matches an entry in this list will be excluded from enforcement. Prefix-matching can be signified with `*`. For example: `my-image-*`.\nIt is recommended that users use the fully-qualified Docker image name (e.g. start with a domain name) in order to avoid unexpectedly exempting images from an untrusted repository.","items":{"type":"string"},"type":"array"},"procMount":{"description":"Defines the strategy for the security exposure of certain paths in `/proc` by the container runtime. Setting to `Default` uses the runtime defaults, where `Unmasked` bypasses the default behavior.","enum":["Default","Unmasked"],"type":"string"}},"type":"object"}}}},"targets":[{"libs":["package lib.exempt_container\nis_exempt(container) {\n    exempt_images := object.get(object.get(input, \"parameters\", {}), \"exemptImages\", [])\n    img := container.image\n    exemption := exempt_images[_]\n    _matches_exemption(img, exemption)\n}\n_matches_exemption(img, exemption) {\n    not endswith(exemption, \"*\")\n    exemption == img\n}\n_matches_exemption(img, exemption) {\n    endswith(exemption, \"*\")\n    prefix := trim_suffix(exemption, \"*\")\n    startswith(img, prefix)\n}\n"],"rego":"package k8spspprocmount\nimport data.lib.exempt_container.is_exempt\nviolation[{\"msg\": msg, \"details\": {}}] {\n    c := input_containers[_]\n    not is_exempt(c)\n    allowedProcMount := get_allowed_proc_mount(input)\n    not input_proc_mount_type_allowed(allowedProcMount, c)\n    msg := sprintf(\"ProcMount type is not allowed, container: %v. Allowed procMount types: %v\", [c.name, allowedProcMount])\n}\ninput_proc_mount_type_allowed(allowedProcMount, c) {\n    allowedProcMount == \"default\"\n    lower(c.securityContext.procMount) == \"default\"\n}\ninput_proc_mount_type_allowed(allowedProcMount, c) {\n    allowedProcMount == \"unmasked\"\n}\ninput_containers[c] {\n    c := input.review.object.spec.containers[_]\n    c.securityContext.procMount\n}\ninput_containers[c] {\n    c := input.review.object.spec.initContainers[_]\n    c.securityContext.procMount\n}\ninput_containers[c] {\n    c := input.review.object.spec.ephemeralContainers[_]\n    c.securityContext.procMount\n}\nget_allowed_proc_mount(arg) = out {\n    not arg.parameters\n    out = \"default\"\n}\nget_allowed_proc_mount(arg) = out {\n    not arg.parameters.procMount\n    out = \"default\"\n}\nget_allowed_proc_mount(arg) = out {\n    not valid_proc_mount(arg.parameters.procMount)\n    out = \"default\"\n}\nget_allowed_proc_mount(arg) = out {\n    out = lower(arg.parameters.procMount)\n}\nvalid_proc_mount(str) {\n    lower(str) == \"default\"\n}\nvalid_proc_mount(str) {\n    lower(str) == \"unmasked\"\n}\n","target":"admission.k8s.gatekeeper.sh"}]},"status":{}},"maxLength":65535,"minLength":1,"type":"string"},"description":{"description":"描述","maxLength":2048,"minLength":0,"type":"string"},"id":{"description":"模板ID","maxLength":128,"minLength":0,"type":"string"},"level":{"description":"推荐级别","maxLength":5,"minLength":1,"type":"string"},"tag":{"description":"标签","maxLength":2048,"minLength":0,"type":"string"},"target_kind":{"description":"策略模板应用资源类型,多个资源类型通过分号份隔连接","example":"Deployment;ReplicaSet;CornJob","maxLength":255,"minLength":1,"pattern":"[1-9]*","type":"string"},"template_name":{"description":"模板名称","maxLength":255,"minLength":1,"type":"string"},"template_type":{"description":"模板类型","maxLength":16,"minLength":1,"type":"string"}},"required":["id","template_name","template_type","target_kind","constraint_template"],"type":"object"},"PolicyTemplateListResponseInfo":{"properties":{"data_list":{"description":"策略模板列表","items":{"$ref":"#/definitions/PolicyTemplateInfo"},"maxItems":2147483647,"minItems":0,"type":"array"},"total_num":{"description":"策略模板总数","format":"int64","maximum":9223372036854775807,"minimum":0,"type":"integer"}},"type":"object"}},"description":null,"group_id":"3f29a7c68cc24a39a794ff9ddec0ba77","host":"hss.cn-north-4.myhuaweicloud.com","id":"c7b1c617bb2943a3abc0775eea75fce3","info_version":"v5","method":"get","name":"ListClusterProtectPolicyTemplates","parameters":{"ProjectId":{"description":"**参数解释**:\n项目ID,可通过我的凭证,项目id获取\n**约束限制**:\n不涉及\n**取值范围**:\n字符长度1-256位\n**默认取值**:\n不涉及","in":"path","maxLength":256,"minLength":1,"name":"project_id","pattern":"^.*$","required":true,"type":"string","x-example":"9d4f774865034d119917acc61b1b806e"},"XAuthToken":{"description":"用户Token。\n通过调用IAM服务获取用户Token接口获取(响应消息头中X-Subject-Token的值)","in":"header","maxLength":32768,"minLength":1,"name":"X-Auth-Token","pattern":"^.*$","required":true,"type":"string","x-example":"$${X-Auth-Token}"}},"paths":{"/v5/{project_id}/container/clusters/protection-policy-templates":{"get":{"consumes":["application/json"],"description":"查询集群防护策略模板列表","operationId":"ListClusterProtectPolicyTemplates","parameters":[{"$ref":"#/parameters/ProjectId"},{"default":0,"description":"主机所属的企业项目ID。\n开通企业项目功能后才需要配置企业项目。\n企业项目ID默认取值为“0”,表示默认企业项目。如果需要查询所有企业项目下的主机,请传参“all_granted_eps”。如果您只有某个企业项目的权限,则需要传递该企业项目ID,查询该企业项目下的主机,否则会因权限不足而报错。","in":"query","maxLength":256,"minLength":1,"name":"enterprise_project_id","pattern":"^.*$","required":false,"type":"string"},{"$ref":"#/parameters/XAuthToken"},{"default":10,"description":"每页显示数量","format":"int32","in":"query","maximum":200,"minimum":10,"name":"limit","required":true,"type":"integer"},{"default":0,"description":"偏移量:指定返回记录的开始位置","format":"int32","in":"query","maximum":2000000,"minimum":0,"name":"offset","required":true,"type":"integer"},{"description":"模板名称","in":"query","maxLength":64,"minLength":1,"name":"template_name","pattern":"^.*$","required":false,"type":"string"},{"description":"模板类型","in":"query","maxLength":16,"minLength":1,"name":"template_type","pattern":"^.*$","required":false,"type":"string"},{"description":"策略模板应用资源类型,多个资源类型通过分号份隔连接","in":"query","maxLength":255,"minLength":1,"name":"target_kind","pattern":"^.*$","required":false,"type":"string"},{"description":"标签","in":"query","maxLength":2048,"minLength":1,"name":"tag","pattern":"^.*$","required":false,"type":"string"},{"description":"推荐等级","in":"query","maxLength":5,"minLength":1,"name":"level","pattern":"^.*$","required":false,"type":"string"}],"produces":["application/json"],"responses":{"200":{"description":"请求已成功","examples":{"application/json":{"data_list":[{"constraint_template":{"apiVersion":"templates.gatekeeper.sh/v1","kind":"ConstraintTemplate","metadata":{"annotations":{"description":"Controls the allowed `procMount` types for the container. Corresponds to the `allowedProcMountTypes` field in a PodSecurityPolicy. For more information, see https://kubernetes.io/docs/concepts/policy/pod-security-policy/#allowedprocmounttypes","description-chinese":"限制Pod允许挂载的Proc类型","level":"3","metadata.gatekeeper.sh/title":"Proc Mount","metadata.gatekeeper.sh/version":"1.0.0","name-chinese":"K8sPSPProcMount","tag":"Container/ApplicationSecurityPolicies","tag-chinese":"容器/应用安全策略","targetKind":"Pod","type":"security"},"creationTimestamp":null,"name":"k8spspprocmount"},"spec":{"crd":{"spec":{"names":{"kind":"K8sPSPProcMount"},"validation":{"openAPIV3Schema":{"description":"Controls the allowed `procMount` types for the container. Corresponds to the `allowedProcMountTypes` field in a PodSecurityPolicy. For more information, see https://kubernetes.io/docs/concepts/policy/pod-security-policy/#allowedprocmounttypes","properties":{"exemptImages":{"description":"Any container that uses an image that matches an entry in this list will be excluded from enforcement. Prefix-matching can be signified with `*`. For example: `my-image-*`.\nIt is recommended that users use the fully-qualified Docker image name (e.g. start with a domain name) in order to avoid unexpectedly exempting images from an untrusted repository.","items":{"type":"string"},"type":"array"},"procMount":{"description":"Defines the strategy for the security exposure of certain paths in `/proc` by the container runtime. Setting to `Default` uses the runtime defaults, where `Unmasked` bypasses the default behavior.","enum":["Default","Unmasked"],"type":"string"}},"type":"object"}}}},"targets":[{"libs":["package lib.exempt_container\nis_exempt(container) {\n    exempt_images := object.get(object.get(input, \"parameters\", {}), \"exemptImages\", [])\n    img := container.image\n    exemption := exempt_images[_]\n    _matches_exemption(img, exemption)\n}\n_matches_exemption(img, exemption) {\n    not endswith(exemption, \"*\")\n    exemption == img\n}\n_matches_exemption(img, exemption) {\n    endswith(exemption, \"*\")\n    prefix := trim_suffix(exemption, \"*\")\n    startswith(img, prefix)\n}\n"],"rego":"package k8spspprocmount\nimport data.lib.exempt_container.is_exempt\nviolation[{\"msg\": msg, \"details\": {}}] {\n    c := input_containers[_]\n    not is_exempt(c)\n    allowedProcMount := get_allowed_proc_mount(input)\n    not input_proc_mount_type_allowed(allowedProcMount, c)\n    msg := sprintf(\"ProcMount type is not allowed, container: %v. Allowed procMount types: %v\", [c.name, allowedProcMount])\n}\ninput_proc_mount_type_allowed(allowedProcMount, c) {\n    allowedProcMount == \"default\"\n    lower(c.securityContext.procMount) == \"default\"\n}\ninput_proc_mount_type_allowed(allowedProcMount, c) {\n    allowedProcMount == \"unmasked\"\n}\ninput_containers[c] {\n    c := input.review.object.spec.containers[_]\n    c.securityContext.procMount\n}\ninput_containers[c] {\n    c := input.review.object.spec.initContainers[_]\n    c.securityContext.procMount\n}\ninput_containers[c] {\n    c := input.review.object.spec.ephemeralContainers[_]\n    c.securityContext.procMount\n}\nget_allowed_proc_mount(arg) = out {\n    not arg.parameters\n    out = \"default\"\n}\nget_allowed_proc_mount(arg) = out {\n    not arg.parameters.procMount\n    out = \"default\"\n}\nget_allowed_proc_mount(arg) = out {\n    not valid_proc_mount(arg.parameters.procMount)\n    out = \"default\"\n}\nget_allowed_proc_mount(arg) = out {\n    out = lower(arg.parameters.procMount)\n}\nvalid_proc_mount(str) {\n    lower(str) == \"default\"\n}\nvalid_proc_mount(str) {\n    lower(str) == \"unmasked\"\n}\n","target":"admission.k8s.gatekeeper.sh"}]},"status":{}},"description":"string","id":"string","level":"strin","tag":"string","target_kind":"Deployment;ReplicaSet;CornJob","template_name":"string","template_type":"string"}],"total_num":10}},"schema":{"$ref":"#/definitions/PolicyTemplateListResponseInfo"}}},"summary":"查询集群组件防护策略模板列表","tags":["集群管理"],"x-api-type":"open-api","x-apigateway-request-type":"public","x-iam-auth-meta-anno":{"abacAction":"hss:clusterProtect:listPolicyTemplates","abacActionAlias":"hss:clusterProtect:list","authLevel":"PROJECT","rbac":["op_service","te_admin","hss_adm","te_admin+op_restricted","te_admin+op_suspended","hss_adm+op_restricted","hss_adm+op_suspended","readonly"]},"x-is-registered":"Y","x-method-annotations":["@CtsInfo(userOperationType = \"listClusterProtectPolicyTemplates\", operationId = \"ListClusterProtectPolicyTemplates\")"],"x-support-sdk":"N","x-surpport-apiexplorer":true}}},"product_short":"HSS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"查询集群组件防护策略模板列表","tags":"集群管理","uri":null,"version":"2.0"}