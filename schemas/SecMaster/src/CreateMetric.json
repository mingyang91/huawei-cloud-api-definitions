{"base_path":null,"components":null,"consumes":"","definitions":{"CreateMetricRequestBody":{"allOf":[{"$ref":"#/definitions/MetricMetaData"}],"description":"创建指标请求体"},"LayoutErrorRsp":{"description":"请求失败错误响应体","properties":{"code":{"description":"**参数解释**:\n错误码\n**取值范围**:\n不涉及","example":"SecMaster.20040001","maxLength":64,"minLength":0,"type":"string"},"message":{"description":"**参数解释**:\n错误描述\n**取值范围**:\n不涉及","example":"Parameter error.","maxLength":1024,"minLength":0,"type":"string"}},"type":"object"},"LayoutMetricFormat":{"properties":{"data":{"description":"数据格式","maxLength":128,"minLength":1,"type":"string"},"data_param":{"additionalProperties":{"maxLength":128,"minLength":0,"type":"string"},"description":"数据参数","type":"object"},"display":{"description":"显示格式","maxLength":128,"minLength":1,"type":"string"},"display_param":{"additionalProperties":{"maxLength":128,"minLength":0,"type":"string"},"description":"显示参数","type":"object"}},"type":"object"},"MetricDimensionExpandParam":{"description":"指标维度扩充参数","properties":{"functions":{"description":"维度扩充方法,填写指标数据面内置方法, 参数index从1开始","example":["getLevel($1)","getSuggestion($1)"],"items":{"maxLength":128,"minLength":1,"type":"string"},"maxItems":10,"minItems":1,"type":"array"},"labels":{"description":"维度扩充标签","example":["等级","建议"],"items":{"maxLength":128,"minLength":1,"type":"string"},"maxItems":10,"minItems":1,"type":"array"}},"required":["functions","labels"],"type":"object"},"MetricMetaData":{"description":"指标元数据","properties":{"cache_ttl":{"description":"缓存生命周期,单位s","example":10,"format":"int64","maximum":86400,"minimum":0,"type":"integer"},"compound_expression":{"description":"metric_type为DERIVED时填写, 复合指标的表达式","example":"($1+$3)/$2","maxLength":65535,"minLength":1,"type":"string"},"data_type":{"description":"数据类型, 当前仅支持创建统计指标","example":"STATISTICS","maxLength":64,"minLength":1,"type":"string"},"derived_metrics":{"description":"衍生指标列表,非复合指标时只有一个元素,复合指标时,为各衍生指标的定义","items":{"properties":{"date_end":{"description":"指标查询范围相对截止时间 datemath表达式","example":"now-5d","pattern":"^((now)|(20))[+-][0-9]+[yMwdhHms](\\/[yMwdhHms]){0,1}$","type":"string"},"date_format":{"description":"时间格式,epoch_millis;epoch_second;yyyy-MM-dd'T'HH:mm:ss.SSSZ","example":"yyyy-MM-dd'T'HH:mm:ss.SSSZ","maxLength":128,"minLength":4,"type":"string"},"date_start":{"description":"指标查询范围相对起始时间 datemath表达式","example":"now-7d","pattern":"^((now)|(20))[+-][0-9]+[yMwdhHms](\\/[yMwdhHms]){0,1}$","type":"string"},"max_query_range":{"description":"指标支持的最大检索范围,单位:天;","example":5,"format":"int32","maximum":864000,"minimum":0,"type":"integer"},"metric_dimension":{"description":"衍生指标结果维度,0维:单个数字,2维:图表或表格,3+维:多标签图表","example":0,"format":"int32","maximum":5,"minimum":0,"type":"integer"},"query_function":{"description":"获取指标结果的方法,转义成字符串, 共四种query方式:CBSL、API、DSL、SQL\n- query_type为`CBSL`时,function传入dataspace_id,pipe_id,query,sort, from, to\n\n\t样例:\n    ```\n    {\\\"dataspace_id\\\":\\\"3939573a-12a0-436f-b0e5-ab2872a1fde9\\\",\\\"pipe_id\\\":\\\"9db9d8a6-d9e6-4b32-990e-40f0afe4655d\\\",\\\"query\\\":\\\"* | select ack_pps, device_type as type\\\",\\\"sort\\\":\\\"desc\\\",\\\"from\\\":${date_from},\\\"to\\\":${date_to}}\n    ```\n\n    转义前:\n    ```json\n    {\n        \"dataspace_id\":\"3939573a-12a0-436f-b0e5-ab2872a1fde9\",\n        \"pipe_id\":\"9db9d8a6-d9e6-4b32-990e-40f0afe4655d\",\n        \"query\":\"* | select ack_pps, device_type as type\",\n        \"sort\":\"desc\",\n        \"from\": ${date_from},\n        \"to\": ${date_to}\n    }\n    ```\n- query_type为`API`时,function传入api method、url、path_params、headers、response_parser(解析API返回值所需,定义label和json_path将返回值解析为二维表格,label为表头,json_path为字段提取路径)\n\n\t样例:\n    ```\n    {\\\"method\\\":\\\"POST\\\",\\\"uri\\\":\\\"/v1/${project_id}/只填写uri/不带域名/xxx\\\",\\\"headers\\\":{\\\"X-Auth-Token\\\":\\\"${project_token}\\\"},\\\"response_parser\\\":{\\\"labels\\\":[\\\"攻击类型\\\",\\\"攻击源\\\",\\\"时间\\\"],\\\"json_path\\\":[\\\"$.data[:].type\\\",\\\"$.data[:].source\\\",\\\"$.data[:].time\\\"]}}\n    ```\n\n    转义前:\n    ```json\n    {\n        \"method\":\"POST\",\n        \"uri\":\"/v1/${project_id}/只填写uri/不带域名/xxx\",\n        \"headers\":{\n            \"X-Auth-Token\": \"${project_token}\"\n        },\n        \"response_parser\":{\n            \"labels\":[\n                \"攻击类型\",\n                \"攻击源\",\n                \"时间\"\n            ],\n            \"json_path\":[\n                \"$.data[:].type\",\n                \"$.data[:].source\",\n                \"$.data[:].time\"\n            ]\n        }\n    }\n    ```\n- query_type为`DSL`时,指定index, dsl(转义成字符串), response_parser\n\n\t样例:\n    ```\n    {\\\"index\\\":\\\"index_xxx_*\\\",\\\"dsl\\\":\\\"{\\\\\\\"query\\\\\\\":{\\\\\\\"match_all\\\\\\\":{}}}\\\",\\\"response_parser\\\":{\\\"labels\\\":[\\\"攻击类型\\\",\\\"攻击源\\\",\\\"时间\\\"],\\\"json_path\\\":[\\\"$.data[:].type\\\",\\\"$.data[:].source\\\",\\\"$.data[:].time\\\"]}}\n    ```\n\n    转义前:\n\n    ```json\n    {\n        \"index\":\"index_xxx_*\",\n        \"dsl\":\"{\\\"query\\\":{\\\"match_all\\\":{}}}\",\n        \"response_parser\":{\n            \"labels\":[\n                \"攻击类型\",\n                \"攻击源\",\n                \"时间\"\n            ],\n            \"json_path\":[\n                \"$.data[:].type\",\n                \"$.data[:].source\",\n                \"$.data[:].time\"\n            ]\n        }\n    }\n    ```\n- query_type为`sql`时,指定opendistro sql插件查询json(转义成字符串)\n\n\t样例:\n    ```\n   {\\\"query\\\":\\\"SELECT count(1) as count , msg.DstPort FROM isap_log_nip_ttl* where oct >= TIMESTAMP(\\\\\\\"${date_from}\\\\\\\") and oct <= TIMESTAMP(\\\\\\\"${date_to}\\\\\\\") group by msg.DstPort order by count desc limit 5\\\"}\n    ```\n\n    \n    转义前:\n\n    ```json\n    {\n        \"query\":\"SELECT count(1) as count , msg.DstPort FROM isap_log_nip_ttl* where oct >= TIMESTAMP(\\\"${date_from}\\\") and oct <= TIMESTAMP(\\\"${date_to}\\\") group by msg.DstPort order by count desc limit 5\"\n    }\n    ```","example":"{\\\"dataspace_id\\\":\\\"3939573a-12a0-436f-b0e5-ab2872a1fde9\\\",\\\"pipe_id\\\":\\\"9db9d8a6-d9e6-4b32-990e-40f0afe4655d\\\",\\\"query\\\":\\\"* | select ack_pps, device_type as type\\\",\\\"sort\\\":\\\"desc\\\",\\\"from\\\":1663203171317,\\\"to\\\":1663204071317}","maxLength":65535,"minLength":1,"type":"string"},"query_type":{"description":"获取指标结果方式,cbsl, api, dsl, sql","enum":["cbsl"," api"," dsl"," sql"],"example":"cbsl","type":"string"}},"required":["metric_dimension","query_function","query_type"],"type":"object"},"maxItems":16,"minItems":1,"type":"array"},"effective_column":{"description":"生效的列, 当有该参数时,使用指定列作为指标数据结果","example":"0:2","pattern":"\\d+:\\d+","type":"string"},"id":{"description":"指标Id","example":"aaba0b018234425a80001db96b82568a","maxLength":64,"minLength":1,"type":"string"},"is_built_in":{"description":"是否为系统指标","example":true,"type":"boolean"},"max_query_range":{"description":"指标支持的最大检索范围,单位:天;复合指标时,数值为derived_metrics列表元素中最小值","example":5,"format":"int32","maximum":864000,"minimum":0,"type":"integer"},"metric_dimension":{"description":"指标结果维度,0维:单个数字,2维:图表或表格,3+维:多标签图表, metric_type为DERIVED必填,其他类型选填(COMPOUND时必为0)","example":0,"format":"int32","maximum":5,"minimum":0,"type":"integer"},"metric_expand_dim":{"$ref":"#/definitions/MetricDimensionExpandParam"},"metric_format":{"description":"指标格式","items":{"$ref":"#/definitions/LayoutMetricFormat"},"maxItems":64,"minItems":1,"type":"array"},"metric_type":{"description":"指标类型, 当前仅支持创建日志类型指标","example":"LOGGING","maxLength":64,"minLength":1,"type":"string"},"name":{"description":"指标名称","example":"漏洞TOP5","maxLength":512,"minLength":1,"type":"string"},"report_period":{"description":"上报周期,埋点指标时必填,单位s","example":0,"format":"int64","maximum":864000,"minimum":0,"type":"integer"},"version":{"description":"安全云脑版本","example":"23.9.0","maxLength":64,"minLength":32,"type":"string"}},"required":["cache_ttl","data_type","metric_type","name"],"type":"object"}},"description":null,"group_id":"705709df764d40488141daec53da8672","host":"secmaster.cn-north-4.myhuaweicloud.com","id":"15e4ad0d492a4d4f904b9ef35cdea893","info_version":"v1","method":"post","name":"CreateMetric","parameters":{},"paths":{"/v1/{project_id}/workspaces/{workspace_id}/soc/metrics":{"post":{"description":"创建指标","operationId":"CreateMetric","parameters":[{"description":"**参数解释:**\n用户Token,通过调用IAM服务获取用户Token接口获取(响应消息头中X-Subject-Token的值)。[获取用户Token](secmaster_03_0010.xml)\n**约束限制:**\n不涉及\n**取值范围:**\n不涉及\n**默认取值:**\n不涉及","in":"header","maxLength":2097152,"minLength":0,"name":"X-Auth-Token","required":true,"type":"string","x-example":"MIIDkgYJKoZIhvcNAQcCoIIDgzCCXXXXX..."},{"default":"application/json;charset=UTF-8","description":"**参数解释:**\n内容类型\n- application/json;charset=UTF-8    普通API请求的类型\n\n**约束限制:**\n不涉及\n**取值范围:**\n- application/json;charset=UTF-8\n\n**默认取值:**\n不涉及","in":"header","maxLength":64,"minLength":0,"name":"content-type","required":true,"type":"string"},{"description":"**参数解释:**\n项目ID,用于明确项目归属,配置后可通过该ID查询项目下资产,可以通过调用API获取,也可以从控制台获取。[获取项目ID](secmaster_03_0014.xml)\n**约束限制:**\n不涉及\n**取值范围:**\n不涉及\n**默认取值:**\n不涉及","in":"path","maxLength":36,"minLength":32,"name":"project_id","required":true,"type":"string"},{"description":"**参数解释:**\n工作空间id。\n**约束限制:**\n不涉及\n**取值范围:**\n不涉及\n**默认取值:**\n不涉及","in":"path","maxLength":36,"minLength":32,"name":"workspace_id","required":true,"type":"string"},{"description":"创建指标请求体","in":"body","name":"CreateMetricRequestBody","required":false,"schema":{"$ref":"#/definitions/CreateMetricRequestBody"}}],"responses":{"200":{"description":"创建成功","examples":{"application/json":{"cache_ttl":10,"data_type":"STATISTICS","derived_metrics":[],"id":"b1f1e000-59d0-4030-bfb7-c4bff9c5ddb4","is_built_in":false,"max_query_range":5,"metric_dimension":0,"metric_format":[],"metric_type":"LOGGING","name":"name","report_period":0}},"headers":{"X-request-id":{"description":"请求ID,格式为:request_uuid-timestamp-hostname","type":"string"}},"schema":{"$ref":"#/definitions/MetricMetaData"}},"400":{"description":"错误响应","headers":{"X-request-id":{"description":"请求ID,格式为:request_uuid-timestamp-hostname","type":"string"}},"schema":{"$ref":"#/definitions/LayoutErrorRsp"}}},"summary":"创建指标","tags":["指标定义"],"x-api-type":"open-api","x-is-registered":"Y","x-request-examples-1":{"cache_ttl":10,"data_type":"statistics","is_built_in":false,"max_query_range":5,"metric_dimension":0,"metric_type":"LOGGING","name":"name","report_period":0,"version":"23.9.0"},"x-request-examples-description-1":"创建指标请求体","x-support-sdk":"Y","x-surpport-apiexplorer":true,"x-surpport-hcs":"Y"}}},"product_short":"SecMaster","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"创建指标","tags":"指标定义","uri":null,"version":"2.0"}