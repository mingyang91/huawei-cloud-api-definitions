{"base_path":"/","components":null,"consumes":"[\"application/json\"]","definitions":{"ErrorResp":{"description":"请求失败时返回的错误对象响应体。","properties":{"error_code":{"description":"错误码。","example":"DRS.00000000","maxLength":12,"minLength":12,"type":"string"},"error_msg":{"description":"错误描述。","example":"Success","maxLength":512,"minLength":1,"type":"string"}},"required":["error_code","error_msg"],"type":"object"},"ReplayErrorSqlResp":{"description":"回放异常SQL数据项","properties":{"abnormal_info":{"description":"异常原因描述","example":"","type":"string"},"abnormal_sql":{"description":"SQL语句","example":"","type":"string"},"object_type":{"description":"SQL类型","example":"DDL","type":"string"}},"type":"object"},"ReplayErrorSqlTemplateResp":{"description":"回放异常SQL数据项","properties":{"count":{"description":"归类的SQL数量","example":1,"format":"int64","type":"integer"},"query_type":{"description":"SQL类型","example":"DDL","type":"string"},"schema_name":{"description":"schema名称","example":"","type":"string"},"sql_template":{"description":"SQL模板","example":"set global sql_tracer=ON","type":"string"},"target_name":{"description":"目标库昵称","example":null,"type":"string"},"target_type":{"description":"目标库类型","example":"taurus","type":"string"}},"type":"object"},"ReplayResultResp":{"description":"回放结果查询响应体,包含了提供的慢SQL详情、异常SQL详情、慢SQL统计信息、异常SQL统计信息、回放时间片信息、回放基于时间统计详细信息,针对不同的结果类型提供提供不同的数据响应","properties":{"error_sql_templates":{"description":"异常SQL统计信息列表,在type为error_sql_template时返回","example":[{"count":1,"query_type":"SELECT","schema_name":"incr_ddl_rename_db1","sql_template":"SELECT ?","target_name":"null","target_type":"taurus"}],"items":{"$ref":"#/definitions/ReplayErrorSqlTemplateResp"},"type":"array"},"error_sqls":{"description":"异常SQL信息列表,在type为error_sql时返回","example":[{"abnormal_info":"java.sql.SQLSyntaxErrorException[(conn=434780) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'l]","abnormal_sql":"login success!","object_type":"DDL"}],"items":{"$ref":"#/definitions/ReplayErrorSqlResp"},"type":"array"},"replaying_sqls":{"description":"正在回放SQL信息列表,在type为replaying_sql时返回","example":[{"client":"192.168.0.33","connection_id":1278414,"execute_latency":12,"latency":10,"replay_start_time":"2024-03-14T16:23:39Z","schema_name":"testdb","sql_statement":"select * from table1","status":"running"}],"items":{"$ref":"#/definitions/ReplayingSqlResp"},"type":"array"},"shard_statics":{"description":"回放基于时间统计详细信息列表,在type为shard_statistics时返回","example":[{"abnormal":0,"finish":1,"slow":0,"time":"2023-11-20T03:25:43Z","total":1}],"items":{"$ref":"#/definitions/ReplayShardStaticsResp"},"type":"array"},"slow_sql_templates":{"description":"慢SQL统计信息列表,在type为slow_sql_template时返回","example":[{"avg_latency":3,"count":5,"max_latency":5,"min_latency":2,"query_type":"DDL","schema_name":"autotest_polardb_test","sql_template":"logout!","target_name":"null","target_type":"taurus","total_latency":16}],"items":{"$ref":"#/definitions/ReplaySlowSqlTemplateResp"},"type":"array"},"slow_sqls":{"description":"慢SQL信息列表,在type为slow_sql时返回","example":[{"object_type":"DDL","old_time":"1","replay_time":"4","slow_sql":"logout!"}],"items":{"$ref":"#/definitions/ReplaySlowSqlResp"},"type":"array"},"total_count":{"description":"数据总量","format":"int64","type":"integer"}},"required":["total_count"],"type":"object"},"ReplayShardStaticsResp":{"description":"回放概览信息基于进间点的统计结果","properties":{"abnormal":{"description":"SQL异常量","example":0,"format":"int64","type":"integer"},"finish":{"description":"SQL执行量","example":0,"format":"int64","type":"integer"},"slow":{"description":"慢SQL数量","example":0,"format":"int64","type":"integer"},"time":{"description":"回放时间点","example":"2023-11-20T03:25:43Z","type":"string"},"total":{"description":"SQL总量","example":0,"format":"int64","type":"integer"}},"required":["time","total","finish","abnormal","slow"],"type":"object"},"ReplaySlowSqlResp":{"description":"回放慢SQL数据结果对象","properties":{"object_type":{"description":"SQL语句类型","example":"DDL","type":"string"},"old_time":{"description":"源库执行耗时","example":0,"type":"string"},"replay_time":{"description":"目标库回放执行耗时","example":0,"type":"string"},"slow_sql":{"description":"SQL语句","example":"","type":"string"}},"type":"object"},"ReplaySlowSqlTemplateResp":{"description":"慢SQL统计信息数据项","properties":{"avg_latency":{"description":"SQL执行平均耗时","example":0,"format":"int64","type":"integer"},"count":{"description":"SQL数量","example":0,"format":"int64","type":"integer"},"max_latency":{"description":"SQL执行最大耗时","example":0,"format":"int64","type":"integer"},"min_latency":{"description":"SQL执行最小耗时","example":0,"format":"int64","type":"integer"},"query_type":{"description":"SQL类型","example":"INSERT","type":"string"},"schema_name":{"description":"schema名称","example":"","type":"string"},"sql_template":{"description":"SQL语句模板","example":"set global sql_tracer=ON","type":"string"},"target_name":{"description":"目标库别名","example":"","type":"string"},"target_type":{"description":"目标库类型","example":"","type":"string"},"total_latency":{"description":"SQL执行总的耗时","example":0,"format":"int64","type":"integer"}},"required":["sql_template","avg_latency","count"],"type":"object"},"ReplayingSqlResp":{"description":"正在回放的SQL信息","properties":{"client":{"description":"客户端IP","type":"string"},"connection_id":{"description":"连接ID","type":"string"},"execute_latency":{"description":"回放执行耗时","example":0,"format":"int32","type":"integer"},"latency":{"description":"原始执行耗时","example":0,"format":"int32","type":"integer"},"replay_start_time":{"description":"回放开始时间","type":"string"},"schema_name":{"description":"库名或shema名称","example":"","type":"string"},"sql_statement":{"description":"SQL语句","example":"","type":"string"},"status":{"description":"执行状态","example":"","type":"string"}},"type":"object"}},"description":null,"group_id":"506538835790436b8e209e5a6684d485","host":"drs.cn-north-4.myhuaweicloud.com","id":"fec521da03a442f996b599cf58c66203","info_version":"v5","method":"get","name":"ShowReplayResults","parameters":{},"paths":{"/v5/{project_id}/jobs/{job_id}/replay-results":{"get":{"description":"获取录制回放结果数据,包括:回放基于时间维度统计信息,异常SQL及统计结果、慢SQL及统计结果","operationId":"ShowReplayResults","parameters":[{"description":"租户在某一Region下的Project ID。 获取方法请参见[获取项目ID。](https://support.huaweicloud.com/api-drs/drs_api_0106.html)","in":"path","name":"project_id","required":true,"type":"string"},{"description":"任务ID。","in":"path","name":"job_id","required":true,"type":"string"},{"default":"application/json","description":"发送的实体的MIME类型。推荐用户默认使用application/json,如果API是对象、镜像上传等接口,媒体类型可按照流类型的不同进行确定。","in":"header","name":"Content-Type","required":true,"type":"string"},{"description":"从IAM服务获取的用户Token。用户Token也就是调用IAM获取用户Token接口的响应值,请求响应成功后在响应消息头中包含的“X-Subject-Token”的值即为Token值。","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"default":"en-us","description":"请求语言类型。","enum":["en-us","zh-cn"],"in":"header","name":"X-Language","required":false,"type":"string"},{"description":"结果类型。取值:\n- shard_statistics:回放概览基于时间维度统计信息。\n- slow_sql:慢SQL详情。\n- error_sql: 回放异常SQL详情。\n- slow_sql_template:慢SQL统计信息。 \n- error_sql_template:异常SQL统计信息。\n- replaying_sql:正在回放SQL详情。","enum":["shard_statistics","slow_sql","error_sql","slow_sql_template","error_sql_template","replaying_sql"],"in":"query","name":"type","required":true,"type":"string"},{"description":"查询数据的起始时间,在type为shard_statistics、slow_sql、error_sql时必填","in":"query","name":"start_time","required":false,"type":"string"},{"description":"查询数据的结束时间,在type为shard_statistics、slow_sql、error_sql时必填","in":"query","name":"end_time","required":false,"type":"string"},{"description":"分页查询数据表当前超始偏移量, 在type为slow_sql、error_sql、slow_sql_template、error_sql_template必填","format":"int64","in":"query","name":"offset","required":false,"type":"integer"},{"description":"分页查询数据表当前页数据总量,在type为slow_sql、error_sql、slow_sql_template、error_sql_template必填","format":"int64","in":"query","name":"limit","required":false,"type":"integer"},{"description":"返回结果按该关键字排序(slow_sql_template支持count,maxLatency、avgLatency关键字,error_sql_template支持count关键字)","in":"query","name":"sort_key","required":false,"type":"string"},{"default":"desc","description":"排序规则,取值如下:\n- asc:升序\n- desc:降序","enum":["asc","desc"],"in":"query","name":"sort_dir","required":false,"type":"string"},{"description":"回放数据库名称,用于在一致性回放策略场景,过滤目标库与源库镜像库回放结果。参数非必须,不提供则默认查询所有数据,其取值如下:\n- target:查询目标库回放结果\n- target_mirror:查询源库镜像库回放结果","enum":["target","target_mirror"],"in":"query","name":"target_name","required":false,"type":"string"}],"responses":{"200":{"description":"OK","examples":{"application/json":{"data":[{"error_info":"java.sql.SQLSyntaxErrorException[(conn=61226) You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 're]","query_type":"DDL","sql_statement":"register_credit_time_detail_kc_series"}],"total":1}},"schema":{"$ref":"#/definitions/ReplayResultResp"}},"400":{"description":"Bad Request","examples":{"application/json":{"error_code":"DRS.10020000","error_msg":"Parameter error: type"}},"schema":{"$ref":"#/definitions/ErrorResp"}}},"summary":"查询录制回放结果","tags":["录制回放"],"x-is-registered":"Y","x-order":1,"x-request-examples-description-1":"查询指定时间范围内回放详情基于时间序统计信息","x-request-examples-description-2":"分页查询指定时间范围内回放的慢SQL详情","x-request-examples-description-3":"分页查询回放中慢SQL统计信息","x-request-examples-description-4":"分页查询指定时间范围内异常SQL详情","x-request-examples-description-5":"分页查询回放过程中异常SQL统计信息","x-request-examples-description-6":"查询正在回放的SQL信息","x-request-examples-url-1":"https://{endpoint}/v5/5237e10fe9aa4ad5b16b6a5245248314/jobs/7b35723d-1525-410e-90c3-70f9ed3jb601/replay-results?type=shard_statistics&start_time=1700421943000&end_time=1700439961000","x-request-examples-url-2":"https://{endpoint}/v5/5237e10fe9aa4ad5b16b6a5245248314/jobs/7b35723d-1525-410e-90c3-70f9ed3jb601/replay-results?type=slow_sql&start_time=1700421943&end_time=1700439961&offset=1&limit=10","x-request-examples-url-3":"https://{endpoint}/v5/5237e10fe9aa4ad5b16b6a5245248314/jobs/7b35723d-1525-410e-90c3-70f9ed3jb601/replay-results?type=slow_sql_template&offset=1&limit=10","x-request-examples-url-4":"https://{endpoint}/v5/5237e10fe9aa4ad5b16b6a5245248314/jobs/7b35723d-1525-410e-90c3-70f9ed3jb601/replay-results?type=error_sql&start_time=1700421943&end_time=1700439961&offset=1&limit=10","x-request-examples-url-5":"https://{endpoint}/v5/5237e10fe9aa4ad5b16b6a5245248314/jobs/7b35723d-1525-410e-90c3-70f9ed3jb601/replay-results?type=error_sql_template&offset=1&limit=10","x-request-examples-url-6":"https://{endpoint}/v5/5237e10fe9aa4ad5b16b6a5245248314/jobs/7b35723d-1525-410e-90c3-70f9ed3jb601/replay-results?type=replaying_sql","x-support-sdk":"Y"}}},"product_short":"DRS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"查询录制回放结果","tags":"录制回放","uri":null,"version":"2.0"}