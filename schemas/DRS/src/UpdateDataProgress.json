{"base_path":"/","components":null,"consumes":"[\"application/json\"]","definitions":{"AddColumnInfo":{"properties":{"column_name":{"description":"列名称","type":"string"},"column_type":{"description":"列类型","type":"string"},"column_value":{"description":"列填充值","type":"string"},"data_type":{"description":"填充列的数据类型","type":"string"}},"type":"object"},"ColumnObject":{"description":"数据库列信息。","properties":{"additional":{"description":"该列是否为附加列,当该列为附加列时:name必须与表级对象中列名一致,并且不能与列过滤filtered同时使用。","type":"boolean"},"filtered":{"description":"该列是否进列过滤,不能与附加列additional同时使用。取值:\n- true:表示同步该列。\n- false:表示过滤该列不同步。","type":"boolean"},"index_for_data_filtering":{"description":"优化查询所需的索引,将会为缓存数据增加索引,不会影响源表,当该列作为数据过滤高级设置的关联索引时,需要填写,否则不填。","type":"string"},"name":{"description":"该列在目标库的名称(列名映射),当该列为“附加列”时须与数据库表级对象中列名保持一致。","type":"string"},"operation_type":{"description":"操作类型,以特定的操作类型填充新加的列。取值:\n- 以默认值方式:\"operation_type\":\"ADDITIONALCOLUMN,default_value\"\n- 以create_time为列:\"operation_type\":\"ADDITIONALCOLUMN,create_time\"\n- 以update_time为列:\"operation_type\":\"ADDITIONALCOLUMN,update_time\"\n- 以表达式为列:\"operation_type\":\"ADDITIONALCOLUMN,expression\"\n- 以serverName@database@table为列:\"operation_type\":\"ADDITIONALCOLUMN,server_database_table\"","type":"string"},"primary_key_for_column_filtering":{"description":"该列是否在列映射场景下为主键,如果是主建则填PRI,否则填空。","type":"string"},"primary_key_for_data_filtering":{"description":"该列是否在数据过滤高级设置场景下为主键,如果是主建则填该列列名,否则不填。","type":"string"},"sync_type":{"description":"该列在实时同步场景下的类型。取值:\n- config:当该列作为数据过滤高级设置的关联列时,需要填写,同时如果该列是主建或优化查询所需的索引,则需要填写primary_key_for_data_filtering或index_for_data_filtering。(注意:是否同步该列到目标库由“filtered”属性控制,与库级、模式级、表级控制方式不同。)","type":"string"},"type":{"description":"该列字段的数据类型。\n列过滤:填写源列字段的数据类型。\n附加列:新填充的列指定字段的数据类型,根据不同操作类型来决定取值范围与约束。取值:\n- 以默认值方式,支持:int,long,varchar(256),datetime,timestamp。\n- 以create_time为列,支持:long,datetime,timestamp。\n- 以update_time为列,支持:long,datetime,timestamp。\n- 以表达式为列,支持:varchar(256),且列值仅为:concat(__current_database, '@',\n__current_table)\n- 以serverName@database@table为列,支持:varchar(256)。","type":"string"},"value":{"description":"附加列的值。约束:\n- 当操作类型仅“以默认值方式”,“以serverName@database@table为列”时,才支持输入对应字段类型的值。\n- 当操作类型为“以表达式为列”时,该字段为固定值\"concat(__current_database, '@',\n__current_table)\",不需要填写。","type":"string"}},"type":"object"},"DataFilteringCondition":{"description":"数据过滤数条件信息体","properties":{"filtering_type":{"description":"过滤条件类型\n\ncontentConditionalFilter: 简单条件过滤\nconfigConditionalFilter: 关联表过滤","enum":["contentConditionalFilter"," configConditionalFilter"],"type":"string"},"value":{"description":"过滤条件\n当filtering_type是configConditionalFilter时, value默认填写config\n当filtering_type是contentConditionalFilter时, value默认填写过滤条件\n\n注意:\n每张表仅支持添加一个校验规则。\n数据过滤每次最多支持500张表。\n过滤表达式不支持使用某种数据库引擎特有的package、函数、变量、常量等写法,须使用通用SQL标准。请直接输入SQL语句中WHERE之后的部分(不包含WHERE和分号,例如:sid > 3 and sname like \"G %\"),最多支持输入512个字符。\n过滤条件填写的SQL语句中,关键字需要用反引号,datatime类型(包含日期和时间)需要用单引号,例如:update > '2022-07-13 00:00:00' and age >10。\n不支持对LOB字段设置过滤条件,如CLOB、BLOB、BYTEA等大字段类型。\n不支持库名、表名带有换行符的对象设置过滤规则。\n建议不要对非精确类型字段设置过滤条件,如FLOAT、DECIMAL、DOUBLE等。\n建议不要对带有特殊字符的字段设置过滤条件。\n不建议使用非幂等表达式或函数作为数据加工条件,如SYSTIMESTAMP,SYSDATE等,因其每次调用返回的结果可能会有差异,导致达不到预期。","type":"string"}},"type":"object"},"DataProcessInfo":{"properties":{"add_columns":{"description":"附加列\n当选择附加列时必须填写\n约束:使用多对一操作时,需要使用数据加工的附加列操作来避免数据冲突。","items":{"$ref":"#/definitions/AddColumnInfo"},"type":"array"},"db_object":{"$ref":"#/definitions/DbObject","description":"数据加工对象信息 当做过映射、进行数据过滤条件校验时,必须填写"},"db_object_column_info":{"$ref":"#/definitions/DbObjectColumnInfo","description":"列映射、过滤信息 当进行列映射、过滤信息时必须填写"},"db_or_table_rename_rule":{"$ref":"#/definitions/DbOrTableRenameRule","description":"库表映射规则"},"ddl_operation":{"additionalProperties":{"type":"string"},"description":"支持DDL的语法\n选择增量迁移或同步的DDL操作。取值及意思如下:\n\"table\": \"CREATE TABLE, ALTER TABLE,DROP TABLE,RENAME TABLE\"\n如该值为空,不迁移或同步DDL操作","type":"object"},"dml_operation":{"description":"支持DML的语法\n选择DML操作时,取值如下:\ni:INSERT。\nu:UPDATE。\nd:DELETE。\n如该值为空,不增量迁移或同步DML操作。","type":"string"},"filter_conditions":{"description":"指定任务数据加工规则请求体","items":{"$ref":"#/definitions/DataFilteringCondition"},"type":"array"},"is_batch_process":{"description":"库级、批量表级处理为true,单表操作为false","type":"boolean"},"is_synchronized":{"description":"表示该规则是否已同步至目标库","type":"boolean"}},"type":"object"},"DataProcessReq":{"description":"指定任务数据加工规则请求体","properties":{"data_process_info":{"description":"指定任务数据加工规则请求体","items":{"$ref":"#/definitions/DataProcessInfo"},"type":"array"}},"type":"object"},"DatabaseObject":{"description":"数据库库级对象。","properties":{"all":{"description":"是否整库迁移或同步。注意:\n1.当该库下的模式、表、列需要做数据过滤、列过滤、列映射时,填false,否则填true;\n2.当该库下的表需要做附加列时,需要填true,并且在表级对象的columns里填写附加列信息;\n3.当该库下的表所包含的列作为数据过滤高级设置的关联列时,需要填true,并且在columns里填写关联列信息,在config_conditions填写数据过滤高级设置的配置条件;","type":"boolean"},"is_synchronized":{"description":"是否已同步","type":"boolean"},"name":{"description":"该数据库在目标库的名称(库名映射)。","type":"string"},"schemas":{"additionalProperties":{"$ref":"#/definitions/SchemaObject"},"description":"需要迁移或同步的模式,当整库迁移或同步为false时需要填写。","type":"object"},"sync_type":{"description":"该数据库在实时同步场景下的类型。取值:\n- config:仅当该库作为数据过滤高级设置的关联库时,需要填写,此时该库以及该库下的schemas、tables“不会”被同步到目标库,name、all属性不生效,schemas、tables需要填写被关联的相关对象。(注意:如果需要同步该库级对象,则在下级对象中填写sync_type值为config。)","enum":["config"],"type":"string"},"tables":{"additionalProperties":{"$ref":"#/definitions/TableObject"},"description":"需要迁移或同步的表,当整库迁移或同步为false时需要填写。","type":"object"},"total_table_num":{"description":"库下的表的数量,表的数量超过阈值就不显示。","format":"int32","type":"integer"}},"type":"object"},"DbObject":{"description":"数据库对象信息体。实时迁移、实时同步需要迁移或同步的库或者表,支持实时同步场景对数据库对象进行加工,即可以为数据库对象添加过滤规则、高级设置、列加工、附加列等。\n数据加工相关具体约束参考:https://support.huaweicloud.com/realtimesyn-drs/drs_03_0035.html","properties":{"object_info":{"additionalProperties":{"$ref":"#/definitions/DatabaseObject"},"description":"数据库对象迁移或同步信息,object_scope为all时不填,为库级或表级时必填。","type":"object"},"object_scope":{"description":"数据库对象迁移或同步范围。取值:\n- all:全部迁移。\n- database:库级迁移或同步。\n- table:表级迁移或同步。","enum":["all","database","table"],"type":"string"},"target_root_db":{"$ref":"#/definitions/TargetRootDb","description":"数据库对象迁移或同步目标库,两层到三层数据库同步需要填写。"}},"required":["object_scope"],"type":"object"},"DbObjectColumnInfo":{"description":"列加工对象\n约束:\n列加工提供列级的查询、映射和过滤能力。\n编辑列名后,目标数据库的列名为修改后的名称。\n列映射名不能和原列名或已存在的映射名相同。\n不支持库名、表名带有换行符的列进行映射。\n任务再编辑时,已经同步的表不支持修改列信息。\n只有勾选的列才会被同步。\nMySQL->MySQL、MySQL->GaussDB(for MySQL)不支持分区表的分区字段进行列映射。\nGaussDB分区键不可以被过滤。","properties":{"column_infos":{"description":"数据库列信息。","items":{"$ref":"#/definitions/QueryColumnInfo"},"type":"array"},"db_name":{"description":"数据库库名称。","type":"string"},"schema_name":{"description":"数据库schema名称。","type":"string"},"table_name":{"description":"数据库表名称。","type":"string"},"total_count":{"description":"数据库列信息总数,与分页无关,仅作为返回体参数","format":"int32","type":"integer"}},"type":"object"},"DbOrTableRenameRule":{"description":"库表更名规则\n\n可以在名称添加前后缀, 填写前缀名,会给库表名称前面添加对前缀名,填写后缀名,会给库表名称后面添加对后缀名;\n当前缀名和后缀名都写时,会给库表名称前后面添加对字符;","properties":{"prefix_name":{"description":"前缀名称\n当type为prefixAndSuffix, 填写prefix_name,库表名称仅增加前缀,若同时也填写suffix_name, 库表名称增加前后缀","type":"string"},"suffix_name":{"description":"后缀名称\n当type为prefixAndSuffix, 填写suffix_name,库表名称仅增加后缀,若同时也填写prefix_name, 库表名称同时增加前后缀","type":"string"},"type":{"description":"库表映射类型\nprefixAndSuffix:前缀、后缀或者前后缀","enum":["prefixAndSuffix","manyToOne"],"type":"string"}},"type":"object"},"ErrorResp":{"description":"请求失败时返回的错误对象响应体。","properties":{"error_code":{"description":"错误码。","example":"DRS.00000000","maxLength":12,"minLength":12,"type":"string"},"error_msg":{"description":"错误描述。","example":"Success","maxLength":512,"minLength":1,"type":"string"}},"required":["error_code","error_msg"],"type":"object"},"QueryColumnInfo":{"description":"数据库列信息","properties":{"column_mapped_name":{"description":"列映射后的名称","type":"string"},"column_name":{"description":"列名","type":"string"},"column_type":{"description":"列类型","type":"string"},"is_filtered":{"description":"该列是否过滤","type":"boolean"},"is_partition_key":{"description":"该列是否partitionKey","type":"boolean"},"primary_key_or_unique_index":{"description":"主键或者唯一索引","type":"string"}},"type":"object"},"SchemaObject":{"description":"数据库模式对象。","properties":{"all":{"description":"是否整模式迁移或同步。注意:\n1.当该模式下的表、列需要做数据过滤、列过滤、列映射时,填false,否则填true;\n2.当该模式下的表需要做附加列时,需要填true,并且在表级对象的columns里填写附加列信息;\n3.当该模式下的表所包含的列作为数据过滤高级设置的关联列时,需要填true,并且在columns里填写关联列信息、config_conditions填写数据过滤高级设置的配置条件;","type":"boolean"},"name":{"description":"该模式在目标库的名称(模式名映射)。","type":"string"},"sync_type":{"description":"该模式在实时同步场景下的类型。取值:\n- config:仅当该模式作为数据过滤高级设置的关联模式时,需要填写,此时该模式以及该模式下的tables“不会”被同步到目标库,name、all属性不生效,tables需要填写被关联的相关对象。(注意:如果需要同步该模式对象,则在下级对象中填写sync_type值为config。)","type":"string"},"tables":{"additionalProperties":{"$ref":"#/definitions/TableObject"},"description":"需要迁移或同步的表,当整模式迁移或同步为false时需要填写。","type":"object"}},"type":"object"},"TableObject":{"description":"数据库表级对象。","properties":{"all":{"description":"是否整表迁移或同步。注意:\n1.当该表不需要做列过滤、列映射时,填true,如果需要做列过滤、列映射则填false;\n2.当该表需要做附加列时,需要填true,并且在columns里填写附加列信息;\n3.当该表所包含的列作为数据过滤高级设置的关联列时,需要填true,并且在columns里填写关联列信息、config_conditions填写数据过滤高级设置的配置条件;","type":"boolean"},"columns":{"additionalProperties":{"$ref":"#/definitions/ColumnObject"},"description":"需要同步/映射/过滤/新增的列,当需要列过滤、列映射、附加列功能时填写,仅在实时同步任务中生效,当整表同步为false时需要填写。","type":"object"},"config_conditions":{"description":"该表数据过滤高级设置的配置条件,当该表作为联表查询时填写,生成加工规则值为SQL条件语句,长度限制512。","items":{"maxLength":512,"minLength":0,"type":"string"},"type":"array"},"db_alias_name":{"description":"一对多情况下,表级上对库名的映射。","type":"string"},"filter_conditions":{"description":"该表数据的过滤条件,生成加工规则值为SQL条件语句,长度限制512。","items":{"maxLength":512,"minLength":0,"type":"string"},"type":"array"},"filtered":{"description":"该表是否进行数据过滤。","type":"boolean"},"is_synchronized":{"description":"是否已经进行同步。","type":"boolean"},"name":{"description":"该表在目标库的名称(表名映射)。","type":"string"},"schema_alias_name":{"description":"一对多情况下,表级上对schema名的映射。","type":"string"},"sync_type":{"description":"该表在实时同步场景下的类型。取值:\n- config:仅当该表作为数据过滤高级设置的关联表时,需要填写,此时该表以及该表下的columns“不会”被同步到目标库,name、all、filtered、filter_conditions属性不生效,columns需要填写被关联的相关对象,config_conditions需要填写数据过滤高级设置的配置条件。(注意:如果需要同步该表级对象,则在下级对象中填写sync_type值为config。)","type":"string"},"type":{"description":"对象类型。取值:\n- table:表。\n- view:视图。\n- procedure:存储过程。","enum":["table","view","procedure"],"type":"string"}},"type":"object"},"TargetRootDb":{"description":"数据库对象迁移或同步目标库信息,两层到三层数据库时需要指定。","properties":{"db_encoding":{"description":"默认编码格式是utf8。","example":"utf8","type":"string"},"db_name":{"description":"库名。","example":"ttt","type":"string"}},"type":"object"},"UpdateObjectResp":{"properties":{"id":{"description":"查询结果id","type":"string"},"status":{"description":"查询状态","enum":["pending","failed","success"],"type":"string"}},"type":"object"}},"description":null,"group_id":"506538835790436b8e209e5a6684d485","host":"drs.cn-north-4.myhuaweicloud.com","id":"358dcf027999459594ec2400fa75349f","info_version":"v5","method":"put","name":"UpdateDataProgress","parameters":{},"paths":{"/v5/{project_id}/jobs/{job_id}/data-processing-rules":{"put":{"description":"更新指定任务数据加工规则","operationId":"UpdateDataProgress","parameters":[{"description":"租户在某一Region下的Project ID。 获取方法请参见[获取项目ID。](https://support.huaweicloud.com/api-drs/drs_api_0106.html)","in":"path","name":"project_id","required":true,"type":"string"},{"description":"任务ID。","in":"path","name":"job_id","required":true,"type":"string"},{"description":"指定任务数据加工规则请求体","in":"body","name":"UpdateDataProgressRequestBody","required":true,"schema":{"$ref":"#/definitions/DataProcessReq"}},{"default":"application/json","description":"发送的实体的MIME类型。推荐用户默认使用application/json,如果API是对象、镜像上传等接口,媒体类型可按照流类型的不同进行确定。","in":"header","name":"Content-Type","required":true,"type":"string"},{"description":"从IAM服务获取的用户Token。 用户Token也就是调用获取用户Token接口的响应值,该接口是唯一不需要认证的接口。 请求响应成功后在响应消息头中包含的“X-Subject-Token”的值即为Token值。","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"default":"en-us","description":"请求语言类型。","enum":["en-us","zh-cn"],"in":"header","name":"X-Language","required":false,"type":"string"}],"responses":{"202":{"description":"Accept","examples":{"application/json":{"id":"0eacda0b-9422-4535-8b62-537d1833638b","status":"pending"}},"schema":{"$ref":"#/definitions/UpdateObjectResp"}},"400":{"description":"Bad Request","examples":{"application/json":{"error_code":"DRS.10000010","error_msg":"Job does not exist, please check job ID."}},"schema":{"$ref":"#/definitions/ErrorResp"}}},"summary":"更新指定任务数据加工规则","tags":["数据加工"],"x-is-registered":"Y","x-order":0,"x-request-examples-1":{"data_process_info":[{"add_colums":[{"column_name":"id","column_type":"ADDITIONALCOLUMN,create_time","column_value":"__create_timestamp","data_type":"long"}],"db_object":{"object_info":{"dyh4":{"all":false,"name":"dyh4","tables":{"test1_table1":{"all":true,"name":"test1_table1","type":"table"},"test1_table10":{"all":true,"name":"test1_table10","type":"table"},"test1_table11":{"all":true,"name":"test1_table11","type":"table"}},"type":"database"}},"object_scope":"table"},"db_object_column_info":{"column_infos":[{"column_mapped_name":null,"column_name":"ID","column_type":"NUMBER","is_filtered":false,"is_partition_key":true,"primary_key_or_unique_index":"P"},{"column_mapped_name":"t1","column_name":"C1","column_type":"VARCHAR2","is_filtered":false,"is_partition_key":false,"primary_key_or_unique_index":null},{"column_mapped_name":null,"column_name":"C2","column_type":"VARCHAR2","is_filtered":true,"is_partition_key":false,"primary_key_or_unique_index":null},{"column_mapped_name":null,"column_name":"C1","column_type":"VARCHAR2","is_filtered":false,"is_partition_key":false,"primary_key_or_unique_index":null}],"db_name":"testDb","schema_name":"testSchema","table_name":"testTable"},"db_or_table_rename_rule":{"prefix_name":"test","type":"prefixAndSuffix"},"ddl_operation":{"table":"ct,at"},"dml_operation":"i,u","filter_conditions":[{"filtering_type":"contentConditionalFilter","value":"id>1"}],"is_batch_process":false}]},"x-request-examples-description-1":"更新数据库表的映射信息、列信息、数据过滤信息、附加列信息、DDL以及DML信息","x-request-examples-text-1":{"data_process_info":[{"add_colums":[{"column_name":"id","column_type":"ADDITIONALCOLUMN,create_time","column_value":"__create_timestamp","data_type":"long"}],"db_object":{"object_info":{"dyh4":{"all":false,"name":"dyh4","tables":{"test1_table1":{"all":true,"name":"test1_table1","type":"table"},"test1_table10":{"all":true,"name":"test1_table10","type":"table"},"test1_table11":{"all":true,"name":"test1_table11","type":"table"}},"type":"database"}},"object_scope":"table"},"db_object_column_info":{"column_infos":[{"column_mapped_name":null,"column_name":"ID","column_type":"NUMBER","is_filtered":false,"is_partition_key":true,"primary_key_or_unique_index":"P"},{"column_mapped_name":"t1","column_name":"C1","column_type":"VARCHAR2","is_filtered":false,"is_partition_key":false,"primary_key_or_unique_index":null},{"column_mapped_name":null,"column_name":"C2","column_type":"VARCHAR2","is_filtered":true,"is_partition_key":false,"primary_key_or_unique_index":null},{"column_mapped_name":null,"column_name":"C1","column_type":"VARCHAR2","is_filtered":false,"is_partition_key":false,"primary_key_or_unique_index":null}],"db_name":"testDb","schema_name":"testSchema","table_name":"testTable"},"db_or_table_rename_rule":{"prefix_name":"test","type":"prefixAndSuffix"},"ddl_operation":{"table":"ct,at"},"dml_operation":"i,u","filter_conditions":[{"filtering_type":"contentConditionalFilter","value":"id>1"}],"is_batch_process":false}]},"x-request-examples-url-1":"PUT https://{endPoint}/v5/054ba152d480d55b2f5dc0069e7ddef0/jobs/c7debc9c-8e09-4a5d-8dd6-cc44f78jb20r/data-processing-rules","x-support-sdk":"Y"}}},"product_short":"DRS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"更新指定任务数据加工规则","tags":"数据加工","uri":null,"version":"2.0"}