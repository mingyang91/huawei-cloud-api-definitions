{"base_path":"/","components":null,"consumes":"[\"application/json\"]","definitions":{"BackupFileInfo":{"description":"备份文件信息。","properties":{"name":{"description":"备份文件名称。","maxLength":512,"minLength":0,"type":"string"},"obs_path":{"description":"OBS桶中文件路径。\n\tOBS场景:必选\n\tRDS场景:缺省","maxLength":512,"minLength":0,"type":"string"},"rds_source_instance_id":{"description":"bak文件所属实例。\n\tOBS场景:缺省\n\tRDS场景:必选","maxLength":512,"minLength":0,"type":"string"},"rds_version":{"description":"bak文件数据库版本。\n\tOBS场景:缺省\n\tRDS场景:必选","maxLength":512,"minLength":0,"type":"string"}},"required":["name"],"type":"object"},"BackupInfo":{"description":"备份文件信息。","properties":{"bucket_name":{"description":"OBS桶名称,使用OBS桶备份文件恢复时必填。\n约束:长度范围为3~63个字符,仅支持小写字母、数字、中划线(-)、点(.),且只能以字母或数字开头和结尾,禁止使用IP地址。\n如果选择从OBS桶获取备份文件必填,参考登录[客户端登录](https://support.huaweicloud.com/clientogw-obs/zh-cn_topic_0045829058.html)OBS Browser客户端,首页为OBS桶列表,可以获取到备份文件所在桶的名称。","maxLength":64,"minLength":1,"type":"string"},"file_source":{"description":"备份文件来源:(全部大写)\n-\tOBS:存放在OBS中的备份文件。\n-\tRDS:RDS实例的备份文件。","enum":["OBS","RDS"],"maxLength":128,"minLength":1,"type":"string"},"files":{"description":"备份文件信息列表。","items":{"$ref":"#/definitions/BackupFileInfo"},"maxItems":256,"minItems":0,"type":"array"}},"required":["file_source","files"],"type":"object"},"BackupJobBaseInfo":{"description":"创建备份迁移任务基本信息体。","properties":{"description":{"description":"任务描述。","maxLength":1024,"minLength":0,"type":"string"},"engine_type":{"description":"数据库引擎。\n\t- sqlserver:RDS for SQL Server引擎","enum":["sqlserver"],"maxLength":128,"minLength":1,"type":"string"},"enterprise_project_id":{"description":"企业项目ID。","maxLength":128,"minLength":0,"type":"string"},"name":{"description":"任务名称。 约束:任务名称在4位到50位之间,不区分大小写,可以包含字母、数字、中划线或下划线,不能包括其他特殊字符。 \n\t- 最小长度:4\n    - 最大长度:50","example":"DRS-0001","maxLength":128,"minLength":4,"type":"string"},"tags":{"description":"标签信息。\n标签的值可以包含任意语种字母、数字、空格和_ . : / = + - @。","items":{"$ref":"#/definitions/ResourceTag"},"maxItems":20,"minItems":0,"type":"array"}},"required":["name","engine_type"],"type":"object"},"BackupJobEndpointInfo":{"description":"备份迁移任务恢复目标RDS for SQL Server实例信息。","properties":{"file_id":{"description":"RDS for SQL Server备份文件的文件ID,通过RDS全量恢复时必填。可通过云数据库RDS备份管理页面获取。","maxLength":128,"minLength":0,"type":"string"},"ms_file_stream_status":{"description":"目标实例是否开启FileStream模式。可通过RDS for SQL Server详情接口获取。","maxLength":128,"minLength":0,"type":"string"},"target_instance_id":{"description":"备份迁移任务恢复目标RDS for SQL Server实例ID。","maxLength":128,"minLength":0,"type":"string"}},"required":["target_instance_id"],"type":"object"},"BackupRestoreOptionInfo":{"description":"备份迁移参数。","properties":{"db_names":{"description":"数据库名称。","items":{"maxLength":128,"minLength":0,"type":"string"},"maxItems":512,"minItems":0,"type":"array"},"is_cover":{"description":"是否覆盖目标数据库,不填默认为false。\n\t值为“true”表示覆盖。\n\t值为“false”表示不覆盖。","enum":[true,false],"type":"boolean"},"is_default_restore":{"description":"是否默认恢复,默认恢复所有数据库。\n\t“true”是代表默认恢复还原备份文件中的全部数据库。\n\t“false”代表需要在db_names这个字段中指定需要恢复的数据库名。","enum":[true,false],"type":"boolean"},"is_delete_backup_file":{"description":"该参数控制使用OBS桶中备份文件恢复时,当任务结束时是否删除下载到RDS for SQL server磁盘中的OBS备份文件,默认删除。\n- true 删除\n- false 不删除","type":"boolean"},"is_last_backup":{"description":"一次典型的增量恢复过程,会涉及多次恢复增量备份。每个增量备份恢复均会使目标数据库保持还原中状态,此时数据库不可读写,直至最后一个增量备份恢复完成后,数据库才能变成可用状态。此后数据库将无法继续进行增量恢复,所以确定为最后一个备份的场景有:\n\t一次性全量迁移,后续将不再进行增量恢复时,设置该字段值为“true”。\n\t增量恢复流程中,确定为最后割接阶段的最后一个增量备份时,设置该字段值为“false”。","enum":[true,false],"type":"boolean"},"is_precheck":{"description":"是否执行预校验。\ntrue:执行。\nfalse:不执行。","enum":[true,false],"type":"boolean"},"recovery_mode":{"description":"恢复模式:\n\t“full”表示全量迁移。\n\t“incre”表示增量迁移 。","enum":["full","incre"],"maxLength":128,"minLength":0,"type":"string"},"reset_db_name_map":{"additionalProperties":{"maxLength":256,"minLength":0,"type":"string"},"description":"该字段为一个map,目前使用格式key是\"\",value是新数据库名字。\n该功能将忽略备份文件中原有的数据库名,通过DRS将其恢复为指定的新数据库名。\n使用条件:\n- 备份文件中只有一个数据库。\n- 备份文件是全量备份类型(待恢复备份类型选择:全量备份),且是一次性恢复(最后一个备份选择:是)。","type":"object"}},"required":["is_last_backup","is_precheck","recovery_mode"],"type":"object"},"CreateOfflineTaskReq":{"description":"创建备份迁移任务请求。","properties":{"backup_info":{"$ref":"#/definitions/BackupInfo","description":"备份文件信息。"},"base_info":{"$ref":"#/definitions/BackupJobBaseInfo","description":"创建备份迁移任务基本信息体。"},"options":{"$ref":"#/definitions/BackupRestoreOptionInfo","description":"备份迁移相关配置参数。"},"target_db_info":{"$ref":"#/definitions/BackupJobEndpointInfo","description":"备份迁移任务恢复目标RDS for SQL Server实例信息。"}},"required":["base_info","target_db_info","backup_info","options"],"type":"object"},"CreateOfflineTaskResp":{"description":"创建备份迁移返回体。","properties":{"job_id":{"description":"任务ID。","maxLength":128,"minLength":1,"type":"string"}},"required":["job_id"],"type":"object"},"ErrorResp":{"description":"请求失败时返回的错误对象响应体。","properties":{"error_code":{"description":"错误码。","example":"DRS.00000000","maxLength":12,"minLength":12,"type":"string"},"error_msg":{"description":"错误描述。","example":"Success","maxLength":512,"minLength":1,"type":"string"}},"required":["error_code","error_msg"],"type":"object"},"ResourceTag":{"description":"标签信息体。","properties":{"key":{"description":"标签键。\n约束:最大长度36,只能包含字母、数字、下划线、中划线和中文。","maxLength":36,"minLength":1,"type":"string"},"value":{"description":"标签值。标签的值可以包含任意语种字母、数字、空格和_ . : / = + - @。","maxLength":43,"minLength":1,"type":"string"}},"type":"object"}},"description":null,"group_id":"506538835790436b8e209e5a6684d485","host":"drs.cn-north-4.myhuaweicloud.com","id":"f8b15fb851c04f49b301092260e78597","info_version":"v5","method":"post","name":"CreateReplicationJob","parameters":{},"paths":{"/v5/{project_id}/backup-migration-jobs":{"post":{"description":"该接口主要用于三种常见场景下备份迁移任务的配置。\n备份迁移支持如下的常见场景:\n- 通过OBS桶备份文件进行全量数据迁移。\n- 通过OBS桶备份文件进行全量+增量数据迁移。\n- 通过RDS全量备份进行全量数据迁移。","operationId":"CreateReplicationJob","parameters":[{"description":"租户在某一Region下的Project ID。 获取方法请参见[获取项目ID。](https://support.huaweicloud.com/api-drs/drs_api_0106.html)","in":"path","maxLength":128,"minLength":1,"name":"project_id","required":true,"type":"string"},{"default":"application/json","description":"发送的实体的MIME类型。推荐用户默认使用application/json,如果API是对象、镜像上传等接口,媒体类型可按照流类型的不同进行确定。","in":"header","maxLength":128,"minLength":0,"name":"Content-Type","required":true,"type":"string"},{"description":"从IAM服务获取的用户Token。 用户Token也就是调用获取用户Token接口的响应值,该接口是唯一不需要认证的接口。 请求响应成功后在响应消息头中包含的“X-Subject-Token”的值即为Token值。","in":"header","maxLength":50000,"minLength":0,"name":"X-Auth-Token","required":true,"type":"string"},{"description":"请求语言类型。","in":"header","maxLength":128,"minLength":0,"name":"X-Language","required":false,"type":"string"},{"description":"创建备份迁移任务请求体。","in":"body","name":"CreateReplicationJobRequestBody","required":true,"schema":{"$ref":"#/definitions/CreateOfflineTaskReq"}}],"responses":{"200":{"description":"OK","examples":{"application/json":{"job_id":"0667845a-6291-4e2a-95b0-190c0abjb703"}},"schema":{"$ref":"#/definitions/CreateOfflineTaskResp"}},"400":{"description":"Bad Request","examples":{"application/json":{"error_code":"DRS.10000001","error_msg":"Failed."}},"schema":{"$ref":"#/definitions/ErrorResp"}}},"summary":"创建备份迁移任务","tags":["备份迁移"],"x-is-registered":"Y","x-order":0,"x-request-examples-1":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"1706510914000_0_Test_Database.bak","obs_path":"","size":"8.75 MB"}]},"base_info":{"description":"目标RDS实例名称:rds-sqlserver-2022-stand","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7526","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":true,"is_precheck":true,"recovery_mode":"full","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-2":{"backup_info":{"file_source":"RDS","files":[{"file_name":"sqlserver-Auto-Single-Sqlserver2019-tar-sense-20240827181001498","obs_path":"","rds_source_instance_id":"7fb189b57339473a929d41dabb3878a2in04","rds_version":"2019_EE","size":"211.10MB"}]},"base_info":{"description":"miao'shu","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7526","tags":[]},"options":{"db_names":["db_test12","db_hailiang_schema","db_sqls2v5_01"],"is_precheck":true,"reset_db_name_map":{"db_hailiang_schema":"","db_sqls2v5_01":"","db_test12":""}},"target_db_info":{"file_id":"0d87037d934848999fdc10bbabb08e6fbr04","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-3":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"ims.bak","obs_path":"floder/","size":"8.75 MB"}]},"base_info":{"description":"描述","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7527","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":false,"is_precheck":true,"recovery_mode":"full","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-4":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"ims_log1.bak","obs_path":"floder/","size":"1.75 MB"}]},"base_info":{"description":"描述","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7527","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":false,"is_precheck":true,"recovery_mode":"incre","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-5":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"ims_log2.bak","obs_path":"floder/","size":"1.75 MB"}]},"base_info":{"description":"描述","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7527","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":true,"is_precheck":true,"recovery_mode":"incre","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-description-1":"通过OBS备份文件进行全量备份恢复。","x-request-examples-description-2":"RDS备份文件备份恢复。","x-request-examples-description-3":"通过OBS桶备份文件进行全量+增量备份恢复。\n首先进行一次全量迁移,is_last_backup选择“false”。","x-request-examples-description-4":"通过OBS桶备份文件进行全量+增量备份恢复。\n全量迁移完成后,然后进行一次增量迁移。如果不止一个增量备份文件,is_last_backup依然选择“false”。","x-request-examples-description-5":"通过OBS桶备份文件进行全量+增量备份恢复。\n停止数据库业务,进行最后一次增量迁移,is_last_backup选择“true”。","x-request-examples-text-1":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"1706510914000_0_Test_Database.bak","obs_path":"","size":"8.75 MB"}]},"base_info":{"description":"目标RDS实例名称:rds-sqlserver-2022-stand","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7526","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":true,"is_precheck":true,"recovery_mode":"full","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-text-2":{"backup_info":{"file_source":"RDS","files":[{"file_name":"sqlserver-Auto-Single-Sqlserver2019-tar-sense-20240827181001498","obs_path":"","rds_source_instance_id":"7fb189b57339473a929d41dabb3878a2in04","rds_version":"2019_EE","size":"211.10MB"}]},"base_info":{"description":"miao'shu","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7526","tags":[]},"options":{"db_names":["db_test12","db_hailiang_schema","db_sqls2v5_01"],"is_precheck":true,"reset_db_name_map":{"db_hailiang_schema":"","db_sqls2v5_01":"","db_test12":""}},"target_db_info":{"file_id":"0d87037d934848999fdc10bbabb08e6fbr04","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-text-3":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"ims.bak","obs_path":"floder/","size":"8.75 MB"}]},"base_info":{"description":"描述","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7527","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":false,"is_precheck":true,"recovery_mode":"full","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-text-4":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"ims_log1.bak","obs_path":"floder/","size":"1.75 MB"}]},"base_info":{"description":"描述","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7527","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":false,"is_precheck":true,"recovery_mode":"incre","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-text-5":{"backup_info":{"bucket_name":"zyy-obs","file_source":"OBS","files":[{"name":"ims_log2.bak","obs_path":"floder/","size":"1.75 MB"}]},"base_info":{"description":"描述","engine_type":"sqlserver","enterprise_project_id":"0","name":"DRS-7527","tags":[]},"options":{"db_names":[""],"is_cover":true,"is_default_restore":true,"is_delete_backup_file":true,"is_last_backup":true,"is_precheck":true,"recovery_mode":"incre","reset_db_name_map":{}},"target_db_info":{"file_id":"","ms_file_stream_status":"off","target_instance_id":"0a3182607bc549bcb46cc9a8755761a6in04"}},"x-request-examples-url-1":"https://{endpoint}/v5/054ba152d480d55b2f5dc0069e7ddef0/backup-migration-jobs","x-request-examples-url-2":"https://{endpoint}/v5/054ba152d480d55b2f5dc0069e7ddef0/backup-migration-jobs","x-request-examples-url-3":"https://{endpoint}/v5/054ba152d480d55b2f5dc0069e7ddef0/backup-migration-jobs","x-request-examples-url-4":"https://{endpoint}/v5/054ba152d480d55b2f5dc0069e7ddef0/backup-migration-jobs","x-request-examples-url-5":"https://{endpoint}/v5/054ba152d480d55b2f5dc0069e7ddef0/backup-migration-jobs","x-support-sdk":"Y"}}},"product_short":"DRS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"创建备份迁移任务","tags":"备份迁移","uri":null,"version":"2.0"}