{"base_path":"/","components":null,"consumes":"[\"application/json\"]","definitions":{"BatchSetupSyncPolicyReq":{"description":"批量设置同步策略请求体","properties":{"jobs":{"description":"批量设置同步策略请求列表。","items":{"$ref":"#/definitions/SyncPolicyReq"},"type":"array"}},"required":["jobs"],"type":"object"},"BatchSyncPolicyResp":{"description":"批量设置同步策略返回体","properties":{"count":{"description":"总数","format":"int32","type":"integer"},"results":{"description":"批量设置同步策略响应体","items":{"$ref":"#/definitions/SyncPolicyResp"},"type":"array"}}},"SyncPolicyReq":{"description":"设置同步策略请求体","properties":{"conflict_policy":{"description":"冲突策略。\n- ignore:忽略\n- overwrite:覆盖\n- stop:报错","enum":["ignore","overwrite","stop"],"type":"string"},"ddl_trans":{"description":"同步增量是否同步DDL。","type":"boolean"},"export_snapshot":{"description":"PostgreSQL同步全量阶段是否使用快照模式导出,不填默认为false","type":"boolean"},"file_and_position":{"description":"- MySQL为源通过show master status命令获取源库位点,根据提示分别填写File:Position。例如:mysql-bin.000277:805 文件名只能为1-60个字符且不能包含< > & : \" \\' / \\\\\\\\ 特殊字符,文件编号只能为3-20个数字,binlog事件位置只能为1-20个数字,且总长度不能超过100个字符。格式为:文件名.文件编号:事件位点\n- MongoDB为源的任务,任务的源库日志从位点开始获取(含当前启动位点),位点需设置在oplog范围以内。非集群通过db.getReplicationInfo()直接获得oplog范围,集群通过db.watch([], {startAtOperationTime: Timestamp(xx, xx)})命令,将启动位点填在xx处,校验位点是否在oplog范围以内。格式为:timestamp:incre。timestamp和incre均为范围在1~2,147,483,647之间的整数。","type":"string"},"filter_ddl_policy":{"description":"过滤DDL策略。","enum":["drop_database"],"type":"string"},"gtid_set":{"description":"- MySQL为源的任务需要,通过show master status命令获取源库位点,根据提示填写Executed_Gtid_Set(如果源库为MySQL 5.5版本,则不支持使用同步任务)。 \n- 不能包含< > & \" \\' / \\\\\\\\ 特殊字符和中文。且不能超过2048个字符","type":"string"},"index_trans":{"description":"同步增量是否同步索引。","type":"boolean"},"is_fill_materialized_view":{"description":"PostgreSQL同步全量阶段是否填充物化视图,不填默认为false","type":"boolean"},"job_id":{"description":"任务ID。","type":"string"},"kafka_data_format":{"description":"投送到kafka的数据格式,不填默认为json:","enum":["json","avro"],"type":"string"},"partition_policy":{"description":"同步到kafka partition策略,取值:\n- 0:按库名.schema.表名的hash值投递到不同Partition\n- 1:全部投递到Partition 0\n- 2:按主键的hash值投递到不同Partition\n- 3:按库名.schema的hash值投递到不同Partition\n**当topic_policy取0时,可以取0,1,2,3;当topic_policy取1时,可以取1,2;当topic_policy取2时,可以取0,1,3;当topic_policy取3时,可以取0,1;**","enum":["0","1","2","3"],"type":"string"},"partitions_num":{"description":"Partition个数,取值1-2147483647之间,topic_policy为1,2,3,时需要,不填默认为1","type":"string"},"replication_factor":{"description":"副本个数,取值1-32767之间,topic_policy为1,2,3,时需要,不填默认为1","type":"string"},"slot_name":{"description":"复制槽名称,gaussdbv5ha-to-kafka主备任务必填","type":"string"},"topic":{"description":"Topic名称,topic_policy为0时必填,确保topic已存在。","type":"string"},"topic_name_format":{"description":"Topic名字格式,topic_policy为1,2,3,时需要\n- 当topic_policy取1时,Topic名字格式支持database、schema两个变量,其他字符当做常量。分别用$database$代替数据库名,$schema$代替模式名,不填默认为$database$-$schema$\n- 当topic_policy取2时,Topic名字格式支持database一个变量,其他字符都当做常量,不填默认为$database$\n- 当topic_policy取3时,Topic名字格式支持database、schema和tablename三个变量,其他字符当做常量。分别用$database$代替数据库名,$schema$代替模式名,$tablename$代替表名,不填默认为$database$-$schema$-$tablename$","type":"string"},"topic_policy":{"description":"同步Topic策略,目标库为kafka时必填,取值:\n- 0:集中投递到一个Topic\n- 1:按库名-schema-表名自动生成Topic名字\n- 2:按库名自动生成Topic名字\n- 3:按库名-schema自动生成Topic名字","enum":["0","1","2","3"],"type":"string"}},"required":["job_id"],"type":"object"},"SyncPolicyResp":{"properties":{"error_code":{"description":"错误码","type":"string"},"error_msg":{"description":"错误信息","type":"string"},"id":{"description":"任务ID","type":"string"},"status":{"description":"状态\n- success:成功\n- failed:失败","type":"string"}}}},"description":null,"group_id":"506538835790436b8e209e5a6684d485","host":"drs.cn-north-4.myhuaweicloud.com","id":"48f797ab77e54790bfc4e1808646c982","info_version":"v3","method":"post","name":"BatchSetPolicy","parameters":{},"paths":{"/v3/{project_id}/jobs/batch-sync-policy":{"post":{"consumes":["application/json"],"description":"- 批量设置同步策略,包括冲突策略、过滤DROP Datase、对象同步范围。\n- 设置kafka同步策略","operationId":"BatchSetPolicy","parameters":[{"description":"租户在某一Region下的Project ID。","in":"path","name":"project_id","required":true,"type":"string"},{"default":"application/json","description":"指定类型为application/json。","enum":["application/json"],"in":"header","name":"Content-Type","required":true,"type":"string"},{"description":"从IAM服务获取的用户Token。","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"default":"en-us","description":"请求语言类型。","enum":["en-us","zh-cn"],"in":"header","name":"X-Language","required":false,"type":"string"},{"description":"批量设置同步策略请求体。","in":"body","name":"requestBody","required":true,"schema":{"$ref":"#/definitions/BatchSetupSyncPolicyReq"}}],"produces":["application/json"],"responses":{"200":{"description":"批量设置同步策略响应体","examples":{"application/json":{"count":1,"results":[{"id":"19557d51-1ee6-4507-97a6-8f69164jb201","status":"success"}]}},"schema":{"$ref":"#/definitions/BatchSyncPolicyResp"}},"400":{"description":"Bad Request","schema":{"type":"string"}}},"summary":"批量设置同步策略","tags":["实时同步管理"],"x-constraint":"支持同步任务设置策略。","x-is-registered":"Y","x-request-examples-1":{"jobs":[{"conflict_policy":"ignore","ddl_trans":true,"filter_ddl_policy":"drop_database","index_trans":true,"job_id":"19557d51-1ee6-4507-97a6-8f69164jb201"}]},"x-request-examples-2":"{\n  \"jobs\": [\n    {\n      \"conflict_policy\": \"ignore\",\n      \"ddl_trans\": true,\n      \"filter_ddl_policy\": \"drop_database\",\n      \"index_trans\": true,\n      \"job_id\": \"19557d51-1ee6-4507-97a6-8f69164jb201\",\n      \"file_and_position\": \"mysql-bin.000019:197\",\n      \"gtid_set\":\"e4979f26-4bc3-11ee-b279-fa163ef21d64:1-23\"\n    }\n  ]\n}","x-request-examples-description-1":"批量设置同步任务策略示例","x-request-examples-description-2":"批量设置MySQL单增量同步任务策略示例","x-request-examples-text-1":{"jobs":[{"conflict_policy":"ignore","ddl_trans":true,"filter_ddl_policy":"drop_database","index_trans":true,"job_id":"19557d51-1ee6-4507-97a6-8f69164jb201"}]},"x-request-examples-text-2":"{\n  \"jobs\": [\n    {\n      \"conflict_policy\": \"ignore\",\n      \"ddl_trans\": true,\n      \"filter_ddl_policy\": \"drop_database\",\n      \"index_trans\": true,\n      \"job_id\": \"19557d51-1ee6-4507-97a6-8f69164jb201\",\n      \"file_and_position\": \"mysql-bin.000019:197\",\n      \"gtid_set\":\"e4979f26-4bc3-11ee-b279-fa163ef21d64:1-23\"\n    }\n  ]\n}","x-request-examples-url-1":"https://{Endpoint}/v3/054ba152d480d55b2f5dc0069e7ddef0/jobs/batch-sync-policy","x-request-examples-url-2":"https://{Endpoint}/v3/054ba152d480d55b2f5dc0069e7ddef0/jobs/batch-sync-policy","x-support-sdk":"Y"}}},"product_short":"DRS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"批量设置同步策略","tags":"实时同步管理","uri":null,"version":"2.0"}