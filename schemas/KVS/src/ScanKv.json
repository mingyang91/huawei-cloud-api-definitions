{"base_path":"/","components":null,"consumes":"[\"application/bson;charset=UTF-8\"]","definitions":{"ScanKvRequestBody":{"properties":{"end_key":{"description":"终止主键或索引键值。\n- 默认空,表示直到最后,右开。","format":"bson-document","type":"string"},"filter_expression":{"$ref":"#/definitions/condition_expression","description":"过滤表达式,同condition_expression。\n> - 允许键字段作为条件。\n> - 在满足start_key和endkey的范围内,执行filter逻辑。"},"hint_index_name":{"description":"create_table时指定的索引名,默认空表示主索引。\n- 长度:[3, 63]\n- 取值字符限制:[a-z0-9_-]+","type":"string"},"limit":{"description":"数据量不超过1MB时,返回的文档个数,最大100个,默认1MB或者100个文档。","format":"int32","maximum":100,"type":"integer"},"return_count_only":{"description":"返回查询条件对应的KV总数.\n- 当KV总数小于limit条件时,返回KV查询结果和KV总数。\n- 当KV总数多于limit条件时,只返回KV总数。","type":"boolean"},"sample_segments_count":{"description":"对表进行采样,尽最大努力保证返回的段列表均分整张表。举例:sample_segments_count=4,返回的段列表[MinKey, KV1)、[KV1,KV2)、[KV2,KV3)和[KV3,MaxKey)。用户可以使用scan-kv对这四个分区执行并发扫描,提高遍历效率。\n- 范围: [1, 10000]。默认值:不执行采样。\n- sample_segments_count仅能和table_name、start_key和end_key字段配合使用。Range分区模式下支持全表采样和范围采样;Hash分区模式仅支持全表扫描。\n- 仅支持对Primary key进行采样,不支持本地/全局二级索引。\n- 返回的段列表仅包含主键,不包含键值;且段列表是编码后的数据 ,不可修改。","format":"int32","maximum":10000,"minimum":1,"type":"integer"},"start_key":{"description":"起始主键或索引键值。\n- 默认空,表示从头遍历,左闭。\n> 分页返回时,该值使用上次响应返回的cursor_key。","format":"bson-document","type":"string"},"table_name":{"description":"表名,仓内唯一。\n- 长度:[3, 63]\n- 取值字符限制:[a-z0-9_-]+","type":"string"}},"required":["table_name"],"type":"object"},"ScanKvResponseBody":{"properties":{"cursor_key":{"description":"下次请求时的start_key,该值为空时,表示指定范围或者指定filter条件所有kv已经返回。","format":"bson-document","type":"string"},"filtered_count":{"description":"被过滤掉的文档数量。","format":"int32","type":"integer"},"returned_count":{"description":"返回的文档数量,为0不表示结束。\n> 如果filtered_count超过500仍无匹配,则返回0。","format":"int64","type":"integer"},"returned_kv_items":{"description":"返回的kv数据。","items":{"$ref":"#/definitions/returned_kv_item"},"type":"array"},"returned_segment_items":{"description":"采样段区间列表。","items":{"$ref":"#/definitions/returned_segment_item"},"type":"array"}},"required":["returned_count","filtered_count"],"type":"object"},"composed_expression":{"properties":{"expressions":{"description":"多个相同优先级且相同逻辑的单字段或多字段条件。","items":{"$ref":"#/definitions/expression"},"type":"array"},"logic":{"description":"逻辑关系,取值如\"$and\", \"$or\", \"$nor\"。","type":"string"}},"required":["expressions"],"type":"object"},"condition_expression":{"properties":{"composed_expression":{"$ref":"#/definitions/composed_expression","description":"组合条件, 逐层同级的子表达式嵌套。"},"multi_field_expression":{"$ref":"#/definitions/multi_field_expression","description":"多字段条件,多个相同优先级的单字段条件。"},"single_field_expression":{"$ref":"#/definitions/single_field_expression","description":"单字段条件。"},"single_kv_expression":{"$ref":"#/definitions/single_kv_expression","description":"文档表达式。"}},"type":"object"},"expression":{"properties":{"composed_expression":{"$ref":"#/definitions/composed_expression","description":"组合条件, 逐层同级的子表达式嵌套。"},"multi_field_expression":{"$ref":"#/definitions/multi_field_expression","description":"多字段条件,多个相同优先级的单字段条件。"},"single_field_expression":{"$ref":"#/definitions/single_field_expression","description":"单字段条件。"}},"type":"object"},"multi_field_expression":{"properties":{"expressions":{"description":"多个相同逻辑操作的单字段条件。","items":{"$ref":"#/definitions/single_field_expression"},"type":"array"},"logic":{"description":"多字段条件,多个相同优先级的单字段条件。","type":"string"}},"required":["expressions"],"type":"object"},"returned_kv_item":{"description":"kv元素。","properties":{"kv_doc":{"description":"对kv_doc有效。","format":"bson-document","type":"string"}},"type":"object"},"returned_segment_item":{"description":"采样段的起始终止主键对。","properties":{"segment_max_key":{"description":"采样段区间终止值。","format":"bson-document","type":"string"},"segment_min_key":{"description":"采样段区间起始值。","format":"bson-document","type":"string"}},"type":"object"},"single_field_expression":{"properties":{"field":{"description":"条件字段。","type":"string"},"func":{"description":"条件函数,取值如\"$gt\", $lt\",\"$gte\", $lte\" \"$eq\", \"$ne\", \"$prefix\", \"$exists\"。","type":"string"},"value":{"description":"value和value_array二选一。\n- value条件值,适用于除\"$in\", \"$nin\"外的func。\n- 字段名无意义,可以传空,也可以传字段名。\n- $exists值为true/false。\n> $prefix操作只适用于string和binary类型。","format":"bson-document","type":"string"},"value_array":{"description":"\"value\"和\"value_array\"二选一。\n- \"value_array\" 条件值列表, 值用于\"$in\", \"$nin\"。","items":{"format":"bson-document","type":"string"},"type":"array"}},"required":["field","func"],"type":"object"},"single_kv_expression":{"properties":{"func":{"description":"取值:\"is_doc\", \"is_blob\", \"is_exist\", \"not_exist\"。","type":"string"}},"required":["func"],"type":"object"}},"description":null,"group_id":"1d253eb51d8046a894e8b1aa21b72079","host":"kvs.cn-north-4.myhuaweicloud.com","id":"9b2c598d15d04871bebc1c18c814d658","info_version":"v1","method":"post","name":"ScanKv","parameters":{},"paths":{"/v1/scan-kv":{"post":{"consumes":["application/bson"],"description":"指定表,扫描表下所有kv;允许指定过滤条件。","operationId":"ScanKv","parameters":[{"description":"仓名,全域唯一,不同租户的仓名不能相同。 \n- 格式:${prefix}-${region-code}-${account-id},其中prefix为自定义前缀,region-code为kvs集群所在的区域代码,account-id为用户的账户id\n- 取值字符限制:[a-z0-9-]+\n- 长度:[16,52]\n> \"-\"不能出现在名字头部或尾部","in":"query","name":"store_name","type":"string","x-location-cname":true},{"description":"扫描kv的请求体","in":"body","name":"ScanKvRequestBody","required":true,"schema":{"$ref":"#/definitions/ScanKvRequestBody"}}],"produces":["application/bson"],"responses":{"200":{"description":"表示扫描所有kv请求成功","examples":{"application/bson":{"filtered_count":0,"returned_count":1,"returned_kv_items":[{"kv_doc":{"filename":"test_file_2","otherKey":"otherValue","owner":"user_2"}}]}},"schema":{"$ref":"#/definitions/ScanKvResponseBody"},"x-response-examples-description-1":"扫描kv的响应体,返回了满足扫描条件的所有kv","x-response-examples-tags-1":"hws"},"400":{"description":"Bad Request"}},"summary":"扫描所有kv","tags":["KV接口"],"x-request-examples-1":{"filter_expression":{"single_field_expr":{"field":"owner","func":"$eq","value":{"value":"user_2"}}},"table_name":"test_table_1"},"x-request-examples-description-1":"扫描所有kv,扫描条件为分区键的值为user2","x-request-examples-tags-1":"hws","x-request-examples-url-1":"POST https://{endpoint}/v1/scan-kv","x-support-sdk":"Y"}}},"product_short":"KVS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"扫描所有kv","tags":"KV接口","uri":null,"version":"2.0"}