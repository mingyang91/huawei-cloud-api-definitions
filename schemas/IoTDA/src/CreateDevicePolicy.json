{"base_path":null,"components":null,"consumes":"[\"application/json;charset=UTF-8\"]","definitions":{"CreateDevicePolicy":{"description":"添加策略请求体。","properties":{"app_id":{"description":"**参数说明**:资源空间ID。此参数为非必选参数,存在多资源空间的用户需要使用该接口时,建议携带该参数指定创建的设备归属到哪个资源空间下,否则创建的设备将会归属到[默认资源空间](https://support.huaweicloud.com/usermanual-iothub/iot_01_0006.html#section0)下。\n**取值范围**:长度不超过36,只允许字母、数字、下划线(_)、连接符(-)的组合。","example":"jeQDJQZltU8iKgFFoW060F5SGZka","pattern":"^[a-zA-Z0-9_-]{1,36}$","type":"string"},"policy_name":{"description":"**参数说明**:策略名称。\n**取值范围**:长度不超过128,只允许字母、数字、下划线(_)、连接符(-)的组合。","example":"myPolicy","pattern":"^[a-zA-Z0-9_-]{1,128}$","type":"string"},"statement":{"description":"**参数说明**:策略文档。","items":{"$ref":"#/definitions/Statement"},"type":"array","x-maxLength":10,"x-minLength":1}},"required":["policy_name","statement"],"title":"添加策略结构体","type":"object","x-imports":"javax.validation.constraints.Size;javax.validation.constraints.NotNull;javax.validation.constraints.Pattern;javax.validation.Valid;"},"QueryDevicePolicyBase":{"description":"设备策略详情返回结构体。","properties":{"app_id":{"description":"**参数说明**:资源空间ID。","example":"jeQDJQZltU8iKgFFoW060F5SGZka","pattern":"^[a-zA-Z0-9_-]{1,36}$","type":"string"},"create_time":{"description":"在物联网平台创建策略的时间。格式:yyyyMMdd'T'HHmmss'Z',如20151212T121212Z。","example":"20190303T081011Z","type":"string"},"policy_id":{"description":"策略ID。","example":"5c90fa7d3c4e4405e8525079","type":"string"},"policy_name":{"description":"策略名称。","example":"myPolicy","type":"string"},"statement":{"description":"策略文档。","items":{"$ref":"#/definitions/Statement"},"type":"array"},"update_time":{"description":"在物联网平台更新策略的时间。格式:yyyyMMdd'T'HHmmss'Z',如20151212T121212Z。","example":"20190303T081011Z","type":"string"}},"title":"设备策略详情结构体","type":"object"},"Statement":{"description":"策略文档结构。","properties":{"actions":{"description":"用于指定策略允许或拒绝的操作。格式为:服务名:资源:操作。当前支持的操作类型如下:\n- iotda:devices:publish:设备使用MQTT协议发布消息。\n- iotda:devices:subscribe:设备使用MQTT协议订阅消息。","example":["iotda:devices:publish","iotda:devices:subscribe"],"items":{"type":"string"},"type":"array","x-annotations":["@PatternInList(regexp = \"(iotda:devices:publish|iotda:devices:subscribe)\")"],"x-maxLength":2,"x-minLength":1},"effect":{"description":"指定是允许还是拒绝该操作。既有允许(ALLOW)又有拒绝(DENY)的授权语句时,遵循拒绝(DENY)优先的原则。\n- ALLOW:允许。\n- DENY:拒绝。","example":"ALLOW","pattern":"(ALLOW|DENY)","type":"string"},"resources":{"description":"用于指定允许或拒绝对其执行操作的资源。格式为:资源类型:资源名称。如设备订阅的资源为:topic:/v1/${devices.deviceId}/test/hello。\n\n**取值范围**:资源列表长度最小为1,最大为10,列表中的资源取值范围:仅支持字母,数字,以及/{}$=+#?*:._-组合。","example":["topic:/v1/${devices.deviceId}/test/hello"],"items":{"type":"string"},"type":"array","x-annotations":["@PatternInList(regexp = \"^[a-zA-Z0-9/{}$=+#?*:._-]{1,128}$\")"],"x-maxLength":10,"x-minLength":1}},"required":["actions","effect","resources"],"title":"策略文档结构","type":"object","x-imports":"javax.validation.constraints.Size;javax.validation.constraints.NotNull;javax.validation.constraints.Pattern;javax.validation.Valid;com.huawei.m2m.validator.PatternInList;"}},"description":null,"group_id":"bf0cdd341d8b4c6f833486a40289d422","host":"iotda.cn-north-4.myhuaweicloud.com","id":"f5f9e83ea48843579b4d5a1a5144fced","info_version":"v5","method":"post","name":"CreateDevicePolicy","parameters":{},"paths":{"/v5/iot/{project_id}/device-policies":{"post":{"consumes":["application/json"],"description":"应用服务器可调用此接口在物联网平台创建一个策略,该策略需要绑定到设备和产品下才能生效。\n- 一个实例最多能创建50个设备策略。\n- 仅**标准版实例、企业版实例**支持该接口调用,基础版不支持。","operationId":"CreateDevicePolicy","parameters":[{"description":"**参数说明**:项目ID。获取方法请参见 [获取项目ID](https://support.huaweicloud.com/api-iothub/iot_06_v5_1001.html) 。","in":"path","name":"project_id","pattern":"^[a-fA-F0-9]{1,32}$","required":true,"type":"string","x-example":"04ed32dc1b0025b52fe3c01a27c2b0a8"},{"description":"**参数说明**:实例ID。物理多租下各实例的唯一标识,建议携带该参数,在使用专业版时必须携带该参数。您可以在IoTDA管理控制台界面,选择左侧导航栏“总览”页签查看当前实例的ID,具体获取方式请参考[查看实例详情](https://support.huaweicloud.com/usermanual-iothub/iot_01_0079.html#section1) 。","in":"header","name":"Instance-Id","pattern":"[0-9a-f-]{1,36}","required":false,"type":"string","x-example":"1a7ffc5c-d89c-44dd-8265-b1653d951ce0"},{"description":"request","in":"body","name":"CreateDevicePolicyRequestBody","required":true,"schema":{"$ref":"#/definitions/CreateDevicePolicy"}}],"produces":["application/json"],"responses":{"201":{"description":"Created","examples":{"application/json":{"app_id":"jeQDJQZltU8iKgFFoW060F5SGZka","create_time":"20230810T070547Z","policy_id":"5c90fa7d3c4e4405e8525079","policy_name":"testPolicy","statement":[{"actions":["iotda:devices:publish","iotda:devices:subscribe"],"effect":"ALLOW","resources":["topic:/v1/${devices.deviceId}/test/hello","topic:/v1/${devices.productId}/test/hello"]}],"update_time":"20230810T070547Z"}},"schema":{"$ref":"#/definitions/QueryDevicePolicyBase"}},"400":{"description":"Bad Request","x-Error":["IOTDA.015200"]},"401":{"description":"Unauthorized"},"403":{"description":"Forbidden","x-Error":["IOTDA.015201"]},"500":{"description":"Internal Server Error"}},"summary":"创建设备策略","tags":["PolicyManagement"],"x-apig-name":"IoTDA_API","x-imports":"org.springframework.http.ResponseEntity;","x-is-registered":"N","x-request-examples-description-1":"创建设备策略-允许设备订阅与发布指定topic","x-request-examples-description-2":"创建设备策略-不允许设备订阅与发布指定topic","x-request-examples-text-1":{"app_id":"jeQDJQZltU8iKgFFoW060F5SGZka","policy_name":"myPolicyAllow","statement":[{"actions":["iotda:devices:publish iotda:devices:subscribe"],"effect":"ALLOW","resources":["topic:/v1/${devices.deviceId}/test/allow"]}]},"x-request-examples-text-2":{"app_id":"jeQDJQZltU8iKgFFoW060F5SGZka","policy_name":"myPolicyDeny","statement":[{"actions":["iotda:devices:publish iotda:devices:subscribe"],"effect":"DENY","resources":["topic:/v1/${devices.deviceId}/test/deny"]}]},"x-request-examples-url-1":"POST https://{endpoint}/v5/iot/{project_id}/device-policies","x-request-examples-url-2":"POST https://{endpoint}/v5/iot/{project_id}/device-policies","x-returnType":"ResponseEntity<QueryDevicePolicyBase>","x-support-sdk":"Y"}}},"product_short":"IoTDA","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"创建设备策略","tags":"设备策略管理","uri":null,"version":"2.0"}