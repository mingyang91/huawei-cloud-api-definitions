{"base_path":"/","components":null,"consumes":"","definitions":{"CbsShowProjectTags":{"description":"TMS通过标签查询CBH资源详情返回体。","properties":{"resources":{"description":"根据查询模式获取到的资源实例详情。","items":{"$ref":"#/definitions/Resources"},"maxItems":64,"minItems":0,"type":"array"},"total_count":{"description":"总记录数。","maximum":64,"minimum":0,"type":"integer"}},"required":["resources","total_count"]},"ErrorRsp400":{"description":"请求参数错误。","example":{"description":"请求参数错误。","error_code":400},"properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":0,"type":"string"},"error_description":{"description":"请求参数错误。","maxLength":512,"minLength":0,"type":"string"}},"required":["error_code","error_description"]},"ErrorRsp401":{"description":"校验TOKEN失败。","example":{"description":"校验TOKEN失败","error_code":401},"properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":0,"type":"string"},"error_description":{"description":"校验TOKEN失败。","maxLength":512,"minLength":0,"type":"string"}},"required":["error_code","error_description"]},"ErrorRsp403":{"description":"租户无权限操作。","example":{"description":"租户无权限操作","error_code":403},"properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":0,"type":"string"},"error_description":{"description":"租户无权限操作。","maxLength":512,"minLength":0,"type":"string"}},"required":["error_code","error_description"]},"ErrorRsp404":{"description":"没有找到CBH资源。","example":{"description":"没有找到CBH资源","error_code":404},"properties":{"error_code":{"description":"错误码","maxLength":36,"minLength":0,"type":"string"},"error_description":{"description":"没有找到CBH资源。","maxLength":512,"minLength":0,"type":"string"}},"required":["error_code","error_description"]},"InstanceDetail":{"description":"CBH实例详情","properties":{"alter_permit":{"description":"云堡垒机实例是否可以扩容。\n- true:是\n- false:否","type":"boolean"},"az_info":{"description":"可用区信息。","properties":{"availability_zone_display":{"description":"云堡垒机实例所在可用分区中文名称。(实例为主备模式时作为主机实例所在可用分区中文名称)","maxLength":36,"minLength":0,"type":"string"},"region":{"description":"云堡垒机实例所在可用区ID。","maxLength":36,"minLength":0,"type":"string"},"slave_zone":{"description":"云堡垒机备机实例所在可用区。","maxLength":36,"minLength":0,"type":"string"},"slave_zone_display":{"description":"云堡垒机备机实例所在可用区中文名称。","maxLength":36,"minLength":0,"type":"string"},"zone":{"description":"云堡垒机实例所在可用分区ID。(实例为主备模式时作为主机实例所在可用分区)","maxLength":36,"minLength":0,"type":"string"}},"required":["region","zone","availability_zone_display"]},"bastion_version":{"description":"云堡垒机实例当前版本。","maxLength":36,"minLength":0,"type":"string"},"created_time":{"description":"云堡垒机实例创建时间,使用UTC时间表示。","maxLength":12,"minLength":0,"type":"string"},"end_time":{"description":"云堡垒机实例结束时间,使用时间戳格式表示。","maxLength":12,"minLength":0,"type":"string"},"enterprise_project_id":{"description":"项目ID。","maxLength":36,"minLength":0,"type":"string"},"ha_info":{"description":"主备信息。","properties":{"ha_id":{"description":"主备ID。","maxLength":36,"minLength":0,"type":"string"},"instance_type":{"description":"实例类型。\n- master:主\n- slave:备","maxLength":36,"minLength":0,"type":"string"}},"required":["ha_id","instance_type"]},"instance_id":{"description":"云堡垒机实例id。","maxLength":36,"minLength":0,"type":"string"},"name":{"description":"云堡垒机实例名称。","maxLength":65,"minLength":1,"type":"string"},"network":{"description":"网络信息。","properties":{"private_ip":{"description":"云堡垒机实例私有ip。","maxLength":15,"minLength":0,"type":"string"},"public_id":{"description":"云堡垒机实例绑定公网的弹性IP的ID,UUID格式表示。","maxLength":36,"minLength":0,"type":"string"},"public_ip":{"description":"云堡垒机实例弹性公网IP。","maxLength":15,"minLength":0,"type":"string"},"security_group_id":{"description":"云堡垒机实例所属的安全组ID。","maxLength":36,"minLength":0,"type":"string"},"subnet_id":{"description":"云堡垒机实例所在子网ID。","maxLength":36,"minLength":0,"type":"string"},"vip":{"description":"云堡垒机实例浮动ip。(实例为主备模式时返回对应的值)","maxLength":36,"minLength":0,"type":"string"},"vpc_id":{"description":"云堡垒机实例所在虚拟私有云ID。","maxLength":36,"minLength":0,"type":"string"},"web_port":{"description":"云堡垒机实例WEB界面访问的端口号。","maxLength":36,"minLength":0,"type":"string"}},"required":["web_port","public_ip","public_id","private_ip","vpc_id","subnet_id","security_group_id"]},"period_num":{"description":"云堡垒机实例订购周期数。","maxLength":36,"minLength":0,"type":"string"},"resource_info":{"description":"资源信息。","properties":{"data_disk_size":{"description":"云堡垒机实例数据盘大小,单位TB。","maximum":300,"minimum":0,"type":"number"},"disk_resource_id":{"description":"云堡垒机实例数据盘资源ID。","items":{"maxLength":64,"minLength":0,"type":"string"},"maxItems":21,"minItems":0,"type":"array"},"order_id":{"description":"订单id。","maxLength":64,"minLength":0,"type":"string"},"resource_id":{"description":"云堡垒机实例的资源id,UUID格式显示。","maxLength":36,"minLength":0,"type":"string"},"specification":{"description":"云堡垒机实例规格。","maxLength":36,"minLength":0,"type":"string"}},"required":["specification","order_id","resource_id","data_disk_size","disk_resource_id"]},"server_id":{"description":"云堡垒机服务器id。","maxLength":64,"minLength":0,"type":"string"},"start_time":{"description":"云堡垒机实例开始时间,使用时间戳格式表示。","maxLength":12,"minLength":0,"type":"string"},"status_info":{"description":"状态信息。","properties":{"create_instance_status":{"description":"云堡垒机实例在创建实例过程中的状态信息。\n- Waiting for payment:等待支付\n- creating-network:创建网络\n- creating-server:创建服务\n- tranfering-horizontal-network:网络打通\n- adding-policy-route:添加路由策略\n- configing-dns:配置DNS\n- starting-cbs-service:服务运行中\n- setting-init-conf:初始化\n- buying-EIP:购买弹性公网IP","maxLength":36,"minLength":0,"type":"string"},"fail_reason":{"description":"云堡垒机实例创建实例失败原因。","maxLength":36,"minLength":0,"type":"string"},"instance_description":{"description":"云堡垒机实例信息描述。","maxLength":36,"minLength":0,"type":"string"},"instance_status":{"description":"云堡垒机实例状态。\n- building:创建中\n- deleting:删除中\n- deleted:删除了\n- unpaid:未支付\n- upgrading:升级中\n- resizing:扩容中\n- abnormal:异常\n- error:故障\n- ok:正常","maxLength":36,"minLength":0,"type":"string"},"status":{"description":"云堡垒机实例状态。\n- SHUTOFF:已关闭\n- ACTIVE:运行中\n- DELETING:删除中\n- BUILD:创建中\n- DELETED:已删除\n- ERROR:故障\n- HAWAIT:等待备机创建成功\n- FROZEN:已冻结\n- UPGRADING:升级中\n- UNPAID:待支付\n- RESIZE:规格变更中\n- DILATATION:扩容中\n- HA:配置HA中","maxLength":36,"minLength":0,"type":"string"},"task_status":{"description":"云堡垒机实例当前的任务状态。\n- powering-on:开启\n- powering-off:关闭\n- rebooting:重启\n- delete_wait:删除\n- frozen:冻结\n- NO_TASK:运行\n- unfrozen:解冻\n- alter:变更\n- updating:升级中\n- configuring-ha:配置HA\n- data-migrating:数据迁移中\n- rollback:版本回滚中\n- traffic-switchover:流量切换中","maxLength":36,"minLength":1,"type":"string"}},"required":["status","task_status","create_instance_status","instance_status","instance_description","fail_reason"]},"update":{"description":"云堡垒机实例是否可以升级。\n- OLD:当前已是最新版本\n- NEW:可以升级小版本\n- CROSS_OS:可以跨版本升级\n- ROLLBACK:可以回滚","enum":["OLD","NEW","CROSS_OS","ROLLBACK"],"maxLength":36,"minLength":0,"type":"string"},"upgrade_time":{"description":"云堡垒机实例升级定时时间,使用时间戳格式表示。","example":1701916110595,"format":"int64","maximum":9999999999999,"minimum":0,"type":"integer"}},"required":["name","server_id","instance_id","alter_permit","enterprise_project_id","period_num","start_time","end_time","created_time","update","bastion_version","az_info","status_info","resource_info","network"],"type":"object"},"ListCBHByTagsRequestBody":{"description":"TMS查询CBH资源实例列表请求体。","example":{"matches":[{"key":"resource_name","value":"resource1"}],"not_tags":[{"key":"key1","values":["*value1","value2"]}],"not_tags_any":[{"key":"key1","values":["value1","value2"]}],"sys_tags":[{"key":"_sys_enterprise_project_id","values":["5aa119a8-d25b-45a7-8d1b-88e127885635"]}],"tags":[{"key":"key1","values":["*value1","value2"]}],"tags_any":[{"key":"key1","values":["value1","value2"]}]},"properties":{"matches":{"description":"搜索字段,key为要匹配的字段,如resource_name等。\n\nvalue为匹配的值。key为固定字典值,不能包含重复的key或不支持的key。\n\n根据key的值确认是否需要模糊匹配,如resource_name默认为模糊搜索(不区分大小写),如果value为空字符串精确匹配(多数服务不存在资源名称为空的情况,因此此类情况返回空列表)。\n\nresource_id为精确匹配。第一期只做resource_name,后续再扩展。","items":{"$ref":"#/definitions/Match"},"maxItems":5,"minItems":0,"type":"array"},"not_tags":{"description":"不包含标签,最多包含50个key,每个key下面的value最多10个, 每个key对应的value可以为空数组但结构体不能缺失。Key不能重复,同一个key中values不能重复。\n\n结果返回不包含标签的资源列表,key之间是与的关系,key-value结构中value是或的关系。\n\n无过滤条件时返回全量数据。","items":{"$ref":"#/definitions/Tags"},"maxItems":5,"minItems":0,"type":"array"},"not_tags_any":{"description":"不包含任意标签,最多包含50个key,每个key下面的value最多10个, 每个key对应的value可以为空数组但结构体不能缺失。Key不能重复,同一个key中values不能重复。\n\n结果返回不包含标签的资源列表,key之间是或的关系,key-value结构中value是或的关系。\n\n无过滤条件时返回全量数据。","items":{"$ref":"#/definitions/Tags"},"maxItems":5,"minItems":0,"type":"array"},"sys_tags":{"description":"仅op_service权限可以使用此字段做资源实例过滤条件。\n\n目前TMS调用时只包含一个tag结构体。\n\nkey:_sys_enterprise_project_id\n\nvalue:企业项目id列表\n\n目前TMS调用时,key下面只包含一个value。0表示默认企业项目\n\nsys_tags和租户标签过滤条件(without_any_tag 、tags、tags_any、not_tags、not_tags_any)不能同时使用\n\n无sys_tags时按照tag接口处理,无tag过滤条件时返回全量数据。。","items":{"$ref":"#/definitions/Tags"},"maxItems":5,"minItems":0,"type":"array"},"tags":{"description":"包含标签,最多包含50个key,每个key下面的value最多10个,每个key对应的value可以为空数组但结构体不能缺失。\n\nKey不能重复,同一个key中values不能重复。结果返回包含所有标签的资源列表,key之间是与的关系,\nkey-value结构中value是或的关系。\n\n无tag过滤条件时返回全量数据。","items":{"$ref":"#/definitions/Tags"},"maxItems":5,"minItems":0,"type":"array"},"tags_any":{"description":"包含任意标签,最多包含50个key,每个key下面的value最多10个,每个key对应的value可以为空数组但结构体不能缺失。Key不能重复,同一个key中values不能重复。\n\n结果返回包含标签的资源列表,key之间是或的关系,key-value结构中value是或的关系。\n\n无过滤条件时返回全量数据。","items":{"$ref":"#/definitions/Tags"},"maxItems":5,"minItems":0,"type":"array"},"without_any_tag":{"description":"不包含任意一个标签,该字段为true时查询所有不带标签的资源。\n\n此时忽略 “tags”、“tags_any”、“not_tags”、“not_tags_any”字段。","type":"boolean"}}},"Match":{"description":"match字段值描述。","properties":{"key":{"description":"键。第一期限定为resource_name,后续扩展。","maxLength":255,"minLength":0,"type":"string"},"value":{"description":"值。每个值最大长度255个unicode字符 。不校验字符集范。。","maxLength":255,"minLength":0,"type":"string"}},"required":["key","value"]},"ResourceTag":{"description":"标签列表的结构体。","properties":{"key":{"description":"键。最大长度128个字符。","maxLength":128,"minLength":0,"pattern":"^((?!_sys_)[\\p{L}\\p{Z}\\p{N}_.:=+\\-@]*)$","type":"string"},"value":{"description":"值。每个值最大长度255个字符。","maxLength":255,"minLength":0,"pattern":"^([\\p{L}\\p{Z}\\p{N}_.:\\/=+\\-@]*)$","type":"string"}},"required":["key","value"]},"Resources":{"description":"查询资源实例列表返回体中用于存储标签列表的结构体。","properties":{"resource_detail":{"$ref":"#/definitions/InstanceDetail"},"resource_id":{"description":"实例ID。","maxLength":36,"minLength":0,"type":"string"},"resource_name":{"description":"资源名称。","maxLength":64,"minLength":0,"type":"string"},"sys_tags":{"description":"sys_tags。","items":{"$ref":"#/definitions/ResourceTag"},"maxItems":36,"minItems":0,"type":"array"},"tags":{"description":"tags。","items":{"$ref":"#/definitions/ResourceTag"},"maxItems":36,"minItems":0,"type":"array"}},"required":["resource_id","resource_detail","tags","sys_tags","resource_name"]},"Tags":{"description":"标签信息。\n\n> 说明:\n- 不允许重复key\n- 每实例最多允许20个标签(系统可配置),不包含_sys开头系统标签 \n- 优先按照创建时间的倒序排序。如果没有创建时间则按照资源名称ASCII码进行排序","properties":{"key":{"description":"键。\n\n> 说明:\n- key不能为空,长度1~128个字符(中文也可以输入128个字符)\n- 可用 UTF-8 格式表示的字母(包含中文)、数字和空格,以及以下字符: _ . : = + - @\n- _sys_开头属于系统标签,租户不能输入\n- 建议正则:^((?!_sys_)[\\\\p{L}\\\\p{Z}\\\\p{N}_.:=+\\\\-@]*)$","maxLength":36,"minLength":0,"type":"string"},"values":{"description":"值列表。\n\n> 说明:\n- 长度0~255个字符(中文也可以输入255个字符)\n- 可用 UTF-8 格式表示的字母(包含中文)、数字和空格,以及以下字符: _ . : / = + - @ 建议正则:^([\\p{L}\\p{Z}\\p{N}_.:\\/=+\\-@]*)$\n- 资源标签值可以为空(empty or null)\n- 预定义标签值不可以为空","items":{"maxLength":64,"minLength":0,"type":"string"},"maxItems":36,"minItems":0,"type":"array"}},"required":["key","values"]}},"description":null,"group_id":"7ca682347ead4c1fb438ad170990cc74","host":"cbh.cn-north-4.myhuaweicloud.com","id":"c06970a9be934da88826eeeb7e04cc0d","info_version":"v2","method":"post","name":"ListInstancesByTag","parameters":{"X-Auth-Token":{"description":"用户Token。\n\n通过调用IAM服务获取用户Token接口获取(响应消息头中X-Subject-Token的值)。\n\n可参考\"IAM获取IAM用户Token\"获取","in":"header","maxLength":28000,"minLength":0,"name":"X-Auth-Token","required":true,"type":"string","x-example":"MIIE5gYJKoZIhvcNAQcCoIIE1zCCXXXXXX..."},"project_id":{"description":"项目ID。\n\n获取方法详见API参考,附录\"获取项目ID\"","in":"path","maxLength":64,"minLength":0,"name":"project_id","required":true,"type":"string","x-example":"80baxxxxxxxxf9ad43xxxxxxxxx"}},"paths":{"/v2/{project_id}/cbs/instance/filter":{"post":{"description":"使用标签过滤实例。","operationId":"ListInstancesByTag","parameters":[{"$ref":"#/parameters/project_id"},{"$ref":"#/parameters/X-Auth-Token"},{"default":1000,"description":"查询记录数(action为count时无此参数)如果action为filter默认为1000,limit最多为1000,不能为负数,最小值为1。","in":"header","maxLength":64,"minLength":0,"name":"limit","required":false,"type":"string"},{"default":0,"description":"索引位置,偏移量(action为count时无此参数)从第一条数据偏移offset条数据后开始查询,如果action为filter默认为0(偏移0条数据,表示从第一条数据开始查询),必须为数字,不能为负数。","in":"header","maxLength":64,"minLength":0,"name":"offset","required":false,"type":"string"},{"description":"ListInstancesByTagRequestBody","in":"body","name":"ListInstancesByTagRequestBody","required":true,"schema":{"$ref":"#/definitions/ListCBHByTagsRequestBody"}}],"produces":["application/json"],"responses":{"200":{"description":"List CBH ByTags Success","examples":{"application/json":{"resources":[{"resource_id":"cdfs_cefs_wesas_12_dsad","resource_name":"resouece1","sys_tags":[{"key":"_sys_enterprise_project_id","value":"5aa119a8-xxxx-45a7-xxxx-88e12788xxxx"}],"tags":[{"key":"key1","value":"value1"},{"key":"key2","value":"value1"}]}],"total_count":1000}},"schema":{"$ref":"#/definitions/CbsShowProjectTags"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/ErrorRsp400"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/ErrorRsp401"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/ErrorRsp403"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/ErrorRsp404"}},"500":{"description":"系统异常"}},"summary":"使用标签过滤实例","tags":["标签管理"],"x-apigateway-ratelimit":"CBH_Server","x-is-registered":"Y","x-open-region-cloud":"hws,hws_hk,ctc,cmcc","x-support-sdk":"Y"}}},"product_short":"CBH","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"使用标签过滤实例","tags":"标签管理","uri":null,"version":"2.0"}