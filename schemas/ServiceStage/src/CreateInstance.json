{"base_path":null,"components":{"parameters":{"application_id":{"description":"应用ID。","in":"path","name":"application_id","required":true,"schema":{"type":"string"}},"auth-token":{"description":"租户身份验证令牌。","in":"header","name":"X-Auth-Token","required":true,"schema":{"type":"string"}},"component_id":{"description":"组件ID。","in":"path","name":"component_id","required":true,"schema":{"type":"string"}},"project_id":{"description":"租户项目ID。","in":"path","name":"project_id","required":true,"schema":{"type":"string"}}},"responses":{"400":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}},"description":"错误的请求。"},"500":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}},"description":"内部错误。"}},"schemas":{"ComponentContainerParameter":{"properties":{"env":{"$ref":"#/components/schemas/ConfigurationEnv"},"lifecycle":{"$ref":"#/components/schemas/ConfigurationLifecycle"},"name":{"description":"容器名称","type":"string"},"probes":{"$ref":"#/components/schemas/ConfigurationProbes"},"size":{"$ref":"#/components/schemas/ComponentContainerSize"},"storage":{"$ref":"#/components/schemas/ConfigurationStorage"}},"type":"object"},"ComponentContainerSize":{"properties":{"id":{"description":"资源规格,可查询获取所有支持的应用资源规格接口获取系统预定义好的资源规格。","type":"string"}},"type":"object"},"ComponentMount":{"properties":{"path":{"description":"挂载路径","type":"string"},"readOnly":{"description":"是否只读","type":"boolean"},"subPath":{"description":"挂载路径的子路径","type":"string"}},"required":["path","readOnly"],"type":"object"},"ComponentProbe":{"properties":{"delay":{"description":"表示启动后多久开始探测","type":"integer"},"parameters":{"$ref":"#/components/schemas/ProbeParameter"},"timeout":{"description":"表示探测超时时间","type":"integer"},"type":{"enum":["http","tcp","command"],"type":"string"}},"required":["type","parameters"],"type":"object"},"ComponentStorage":{"properties":{"mounts":{"items":{"$ref":"#/components/schemas/ComponentMount"},"type":"array"},"parameters":{"$ref":"#/components/schemas/StorageParameter"},"type":{"enum":["HostPath","EmptyDir","ConfigMap","Secret","PersistentVolumeClaim"],"type":"string"}},"required":["type","parameters","mounts"],"type":"object"},"ConfigurationContainer":{"description":"容器信息","items":{"$ref":"#/components/schemas/ComponentContainerParameter"},"type":"array"},"ConfigurationContainerSpec":{"properties":{"containers":{"$ref":"#/components/schemas/ConfigurationContainer"},"type":{"description":"工作负载类型。","type":"string"}},"type":"object"},"ConfigurationEnv":{"description":"应用环境变量。","items":{"$ref":"#/components/schemas/ConfigurationEnvParam"},"type":"array"},"ConfigurationEnvParam":{"properties":{"name":{"description":"环境变量名称。","type":"string"},"value":{"description":"环境变量取值。","type":"string"}},"required":["name","value"],"type":"object"},"ConfigurationLifecycle":{"description":"生命周期","properties":{"entrypoint":{"$ref":"#/components/schemas/LifecycleEntrypoint"},"post-start":{"$ref":"#/components/schemas/LifecycleProcess"},"pre-stop":{"$ref":"#/components/schemas/LifecycleProcess"}},"type":"object"},"ConfigurationProbes":{"properties":{"livenessProbe":{"$ref":"#/components/schemas/ComponentProbe"},"readinessProbe":{"$ref":"#/components/schemas/ComponentProbe"}},"type":"object"},"ConfigurationScheduler":{"description":"调度策略","properties":{"affinity":{"$ref":"#/components/schemas/SchedulerAffinity"},"anti-affinity":{"$ref":"#/components/schemas/SchedulerAffinity"}},"type":"object"},"ConfigurationStorage":{"items":{"$ref":"#/components/schemas/ComponentStorage"},"type":"array"},"ConfigurationStrategy":{"description":"部署策略","properties":{"upgrade":{"description":"部署策略","type":"string"}},"type":"object"},"ErrorResponse":{"properties":{"error_code":{"description":"错误码。","type":"string"},"error_detail":{"description":"详细定位信息。","type":"string"},"error_message":{"description":"错误详细信息。","example":"error message","type":"string"},"error_msg":{"description":"错误信息。","type":"string"}},"type":"object"},"ExternalAccessesCreate":{"description":"外网访问。","properties":{"address":{"description":"访问地址。","maxLength":256,"type":"string"},"forward_port":{"description":"端口号。","type":"integer"},"protocol":{"description":"协议,支持http、https。","enum":["http","https"],"type":"string"}},"required":["protocol","address","forward_port"],"type":"object"},"FlavorId":{"description":"资源规格。","enum":["MICRO-5G:0.5C:1G","SMALL-10G:1.0C:2G","STANDARD-30G:2.0C:4G","LARGE-50G:4.0C:8G","XLARGE-100G:4.0C:16G","CUSTOM-XG:X-X:X-X"],"type":"string"},"InstanceArtifact":{"additionalProperties":{"properties":{"auth":{"default":"iam","description":"认证方式,支持iam和none,默认为iam。","type":"string"},"properties":{"additionalProperties":{"type":"string"},"description":"属性。","type":"object"},"storage":{"description":"存储方式,支持swr、obs。","enum":["swr","obs"],"type":"string"},"type":{"description":"类别,虚机部署为package,容器部署为image。","enum":["image","package"],"type":"string"},"url":{"description":"软件包/镜像地址。对于需要使用组件的源码或者软件包自动生成的镜像,格式为“组件名:v${index}”","type":"string"},"version":{"description":"版本号。","maxLength":64,"type":"string"}},"required":["storage","type","url","auth"],"type":"object"},"description":"组件部署件。key为组件component_name,对于Docker多容器场景,key为容器名称。","example":{"container-name":{"auth":"iam","storage":"swr","type":"image","url":"100.125.0.198:20202/adminuser/junit-platformstest:1.0"}},"type":"object"},"InstanceConfiguration":{"description":"应用配置,环境变量等,如{“env”: [{“name”: “log-level”: “warn”}]}, 默认空。","properties":{"container_spec":{"$ref":"#/components/schemas/ConfigurationContainerSpec"},"env":{"$ref":"#/components/schemas/ConfigurationEnv"},"lifecycle":{"$ref":"#/components/schemas/ConfigurationLifecycle"},"probes":{"$ref":"#/components/schemas/ConfigurationProbes"},"scheduler":{"$ref":"#/components/schemas/ConfigurationScheduler"},"storage":{"$ref":"#/components/schemas/ConfigurationStorage"},"strategy":{"$ref":"#/components/schemas/ConfigurationStrategy"}},"type":"object"},"InstanceCreate":{"example":{"artifacts":{"container-name":{"auth":"iam","storage":"swr","type":"image","url":"100.125.0.198:20202/adminuser/junit-platformstest:1.0"}},"configuration":{"env":[],"lifecycle":{"entrypoint":{},"post-start":{},"pre-stop":{}},"logs":[],"metric":{},"probes":{},"scheduler":{},"storage":[],"strategy":{"upgrade":"RollingUpdate"}},"description":"instance desc","environment_id":"6e763000-9128-4a9d-adea-34c42cc5344d","flavor_id":"MICRO-5G:0.5C:1G","name":"component-instance-name","refer_resources":[{"id":"b6862a62-d916-11e9-bdf1-0255ac101fd9","parameters":{"namespace":"default"},"type":"cce"},{"id":"8c0a45cc-626f-4d65-8257-507ee059aa9a","type":"elb"},{"id":"apm-group","type":"apm"}],"replica":1,"version":1.0},"properties":{"artifacts":{"$ref":"#/components/schemas/InstanceArtifact"},"configuration":{"$ref":"#/components/schemas/InstanceConfiguration"},"description":{"description":"描述。","type":"string"},"environment_id":{"description":"环境ID。","maxLength":64,"type":"string"},"external_accesses":{"description":"访问方式。","items":{"$ref":"#/components/schemas/ExternalAccessesCreate"},"maxItems":10,"type":"array"},"flavor_id":{"$ref":"#/components/schemas/FlavorId"},"name":{"description":"应用组件实例名称。","maxLength":64,"pattern":"^[a-z0-9-]+$","type":"string"},"refer_resources":{"description":"部署资源。","items":{"$ref":"#/components/schemas/ReferResourceCreate"},"type":"array"},"replica":{"description":"实例副本数。","type":"integer"},"version":{"description":"应用组件版本号,满足版本语义,如1.0.0。。","maxLength":64,"pattern":"^([0-9]+)(.[0-9]+){2,3}$","type":"string"}},"required":["name","environment_id","flavor_id","replica","artifacts","version","refer_resources"],"type":"object"},"InstanceSummary":{"properties":{"instance_id":{"description":"应用组件实例ID。","type":"string"},"job_id":{"description":"Job ID,用于查询创建任务信息。","type":"string"}},"type":"object"},"LifecycleEntrypoint":{"description":"生命周期","properties":{"args":{"description":"运行参数","items":{"type":"string"},"type":"array"},"command":{"description":"执行命令行","items":{"type":"string"},"type":"array"}},"type":"object"},"LifecycleProcess":{"properties":{"parameters":{"$ref":"#/components/schemas/LifecycleProcessParameter"},"type":{"description":"取值为command或者http。command为执行命令行,http为发送http请求。","type":"string"}},"type":"object"},"LifecycleProcessParameter":{"description":"启动后处理或者停止前处理参数。","properties":{"command":{"description":"命令参数,适用于command类型","items":{"type":"string"},"type":"array"},"host":{"description":"默认为POD实例的IP地址。也可以自己指定。适用于http类型。","type":"string"},"path":{"description":"请求url,适用于http类型。","type":"string"},"port":{"description":"端口号,适用于http类型。","type":"integer"}},"type":"object"},"ProbeParameter":{"properties":{"command":{"description":"type为command类型时生效。命令列表","items":{"type":"string"},"type":"array"},"host":{"description":"type为http类型时生效。默认为POD的IP, 可以指定自定义的IP","type":"string"},"path":{"description":"type为http类型时生效。请求路径。","type":"string"},"port":{"description":"type为http和tcp类型时生效。","type":"integer"},"scheme":{"description":"type为http类型时生效","enum":["HTTP","HTTPS"],"type":"string"}},"type":"object"},"ReferResourceCreate":{"description":"部署资源。","properties":{"id":{"description":"资源ID。","maxLength":64,"type":"string"},"parameters":{"description":"引用资源参数。","type":"object"},"refer_alias":{"$ref":"#/components/schemas/ResourceReferAlias"},"type":{"$ref":"#/components/schemas/ResourceType"}},"required":["id","type"],"type":"object"},"ResourceReferAlias":{"description":"应用别名,dcs时才提供,支持“distributed_session”、“distributed_cache”、“distributed_session, distributed_cache”,\n\n默认值是“distributed_session, distributed_cache”。","type":"string"},"ResourceType":{"description":"资源类型。\n\n基础资源:cce、ecs、as。\n\n可选资源:rds、dcs、elb、cse等其他类型。","enum":["security_group","eip","elb","cce","cci","ecs","as","cse","dcs","rds","pvc","apm"],"type":"string"},"SchedulerAffinity":{"properties":{"application":{"items":{"type":"string"},"type":"string"},"az":{"items":{"type":"string"},"type":"string"},"node":{"items":{"type":"string"},"type":"string"}},"type":"object"},"StorageParameter":{"properties":{"defaultMode":{"description":"挂载的权限,十进制格式,如384","type":"integer"},"medium":{"description":"适用于EmptyDir类型的存储。不传参数为默认的磁盘介质,传参为memory则开启内存存储。","type":"string"},"name":{"description":"配置项、密钥或者PVC的名字, 适用于ConfigMap、Secret和PersistentVolumeClaim的存储类型","type":"string"},"path":{"description":"主机路径, 适用于HostPath的存储类型","type":"string"}},"type":"object"}}},"consumes":"","definitions":null,"description":null,"group_id":"66601b9b4dd246ddab6e76d90a0b0ecd","host":"servicestage.cn-north-4.myhuaweicloud.com","id":"7be2db07131f442289dc24a42a94751b","info_version":"v2","method":"post","name":"CreateInstance","parameters":null,"paths":{"/v2/{project_id}/cas/applications/{application_id}/components/{component_id}/instances":{"post":{"description":"此API用来创建应用组件实例。","operationId":"CreateInstance","parameters":[{"$ref":"#/components/parameters/auth-token"},{"$ref":"#/components/parameters/project_id"},{"$ref":"#/components/parameters/application_id"},{"$ref":"#/components/parameters/component_id"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InstanceCreate"}}}},"responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InstanceSummary"}}},"description":"操作成功。"},"400":{"$ref":"#/components/responses/400"},"500":{"$ref":"#/components/responses/500"}},"summary":"创建组件实例","tags":["实例"],"x-is-registered":"Y","x-support-sdk":"Y"}}},"product_short":"ServiceStage","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"创建组件实例","tags":"实例","uri":null,"version":"3.0.1"}