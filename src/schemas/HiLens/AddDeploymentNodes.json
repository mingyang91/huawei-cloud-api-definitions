{"base_path":"/","components":null,"consumes":"","definitions":{"AppDef":{"properties":{"app_order_id":{"description":"app应用的订单ID,技能来源是市场时,如果不填,则自动选择默认订单。","type":"string"},"app_url":{"description":"app应用的地址,可以是镜像地址或者OBS地址","type":"string"},"args":{"description":"容器启动参数,字符总长度最大为65536,不允许^#~^$|%&*<>()'\"\\[\\]{}]等特殊字符","items":{"type":"string"},"type":"array"},"channel_limit":{"description":"路数限制,添加作业的时候,摄像头和VCN的最大路数不超过该值,范围是0到1000","format":"int32","type":"integer"},"channel_resources":{"$ref":"#/definitions/ResQuest","description":"每增加一路所需要资源"},"channel_upper_limit":{"description":"用户可以指定的路数限制上限,范围是0到1000","format":"int32","type":"integer"},"command":{"description":"容器启动命令,字符总长度最大为65536。 command支持使用数组定义多条命令,但在IEF控制台界面只会显示第一条命令。不允许^#~^$|%&*<>()'\"\\[\\]{}]等特殊字符","items":{"type":"string"},"type":"array"},"envs":{"description":"环境变量","items":{"$ref":"#/definitions/Env"},"type":"array"},"is_modelbox":{"description":"是否是modelbox镜像","type":"boolean"},"liveness_probe":{"$ref":"#/definitions/Probe","description":"探针配置"},"msgs":{"description":"消息变量","items":{"$ref":"#/definitions/Env"},"type":"array"},"name":{"description":"应用名字,只允许英文小写字母、数字、中划线,最大长度32, 英文小写字母或数字开头和结尾。该名称同时对应技能名称,当不传订单id的时候,默认通过该名称和版本号version字段,选择指定技能版本,进行部署,并选择可用的订单(默认订单优先)扣除份额。","type":"string"},"npu_type":{"description":"npu类型,支持D310类型和D910类型。D310表示D310类型。\n\nD910表示D910类型。不填表示为D310类型","type":"string"},"ports":{"description":"容器端口映射值","items":{"$ref":"#/definitions/HostContainerPortMapping"},"type":"array"},"privileged":{"description":"是否启用特权容器,默认值false","type":"boolean"},"readiness_probe":{"$ref":"#/definitions/Probe","description":"探针配置"},"resources":{"$ref":"#/definitions/ResQuest","description":"创建应用时使用的资源"},"skill_project_id":{"description":"技能管理ID,技能来源source是skill的时候,需要传入该ID","type":"string"},"start_resources":{"$ref":"#/definitions/ResQuest","description":"创建部署所需要的起始资源"},"version":{"description":"版本号,长度不操作128,支持大小写数字,下划线,点,中划线","type":"string"},"volumes":{"description":"卷配置","items":{"$ref":"#/definitions/Volume"},"type":"array"}},"required":["app_url","name","resources"],"title":"AppDef","type":"object"},"ConfigsMap":{"properties":{"key":{"description":"配置项的名称,以英文字母或中划线开头,由英文字母、数字、点号、中划线和下划线组成,长度1到63个字符。","type":"string"},"name":{"description":"配置项的属性名,以英文小写字母开头,由中文字符,英文字母,数字,下划线和中划线组成,不能以中划线结尾,长度4-64位。","type":"string"}},"required":["key","name"],"title":"Config"},"Deployment":{"properties":{"api_version":{"description":"应用部署版本","type":"string"},"cluster_id":{"description":"应用部署的集群ID,与node_id二选一","type":"string"},"created_at":{"description":"创建时间","example":"2022-01-20 17:09:36 GMT+08:00","type":"string"},"description":{"description":"应用部署描述,最大长度255,不允许^ ~ # $ % & * < > ( ) [ ] { } ' \" \\","type":"string"},"id":{"description":"部署ID","example":"hilens-700dd1484e1c4af484ce7e11864d900e","type":"string"},"name":{"description":"部署名称","example":"badge-detection","type":"string"},"node_ids":{"description":"应用部署的指定节点,与clouster_id二选一","example":["hilens-0cbda3fa887a4e00ad1fe82453b671e1"],"items":{"type":"string"},"type":"array"},"node_num":{"description":"部署的节点数,最小为1,集群部署也为1","format":"int32","type":"integer"},"project_id":{"description":"项目ID","example":"fff47e1722f94c4e98531bae56821372","type":"string"},"ready_replicas":{"description":"已经就绪的实例节点数","example":1,"format":"int32","type":"integer"},"reason":{"description":"部署成功失败的理由","type":"string"},"replicas":{"description":"实例节点节点数","example":1,"format":"int32","type":"integer"},"result":{"description":"每个节点的部署结果","items":{"$ref":"#/definitions/NodeResult"},"type":"array"},"source":{"description":"应用部署来源: HiLens市场(hlm) or aigallery(aig) or 自定义(userdefined)","example":"userdefined","type":"string"},"state":{"description":"RUNNING:运行,\nFREEZE:冻结,\nUNFREEZE: 解冻,\nCREATING:创建中,\nCREATE_FAILED:创建失败,\nSTARTING:启动中,\nSTART_FAILED:启动失败,\nSTOPPING:停止中\nSTOP_FAILED:停止失败\nDELETING:删除中\nDELETE_FIALED:删除失败\nHIBERNATED:休眠","example":"RUNNING","type":"string"},"template":{"description":"部署模板信息","properties":{"apps":{"description":"部署应用列表","items":{"$ref":"#/definitions/AppDef"},"type":"array"},"configs":{"$ref":"#/definitions/PodConfig","description":"应用实例配置"}}},"updated_at":{"description":"更新时间","example":"2022-01-20 17:40:51 GMT+08:00","type":"string"}},"required":["template","ready_replicas","replicas","description","created_at","source","api_version","updated_at","project_id","name","id","state","node_num"]},"DeploymentAddNodesRequest":{"properties":{"deployment_id":{"description":"应用部署ID","type":"string"},"node_ids":{"description":"应用部署到指定节点","items":{"type":"string"},"type":"array"},"node_num":{"description":"添加的节点数量","format":"int32","type":"integer"},"node_tags":{"description":"添加节点的标签","items":{"$ref":"#/definitions/DeploymentTag"},"type":"array"}},"required":["deployment_id","node_num"],"title":"DeploymentCreateRequest"},"DeploymentSecrets":{"properties":{"key":{"description":"密钥的属性名,以英文字母和中划线开头,由英文字母、数字、点号、中划线和下划线组成,长度1-63位","type":"string"},"name":{"description":"密钥的名称,以英文小写字母开头,由中文字符,英文字母,数字,下划线和中划线组成,不能以中划线结尾,长度4-64位","type":"string"}}},"DeploymentTag":{"properties":{"key":{"description":"部署标签的key值,长度取值范围为1~36,由英文字母,数字,中划线和下划线组成,长度1到36个字符","type":"string"},"value":{"description":"部署标签的value值,长度取值范围为1~43,由英文字母,数字,下划线,点号和中划线组成,长度0到43个字符","type":"string"}},"required":["key","value"],"title":"DeploymentTag"},"Env":{"properties":{"field_path":{"description":"该参数目前只支持赋值\"status.hostIP\",即引用边缘节点的IP地址作为环境变量。value、value_from和field_path必须三选一使用","type":"string"},"name":{"description":"环境变量的key,由大小写字母或下划线开头,由数字、大小写字母、下划线组成,最大长度2048个字符,不允许重复","type":"string"},"value":{"description":"环境变量的value,最大长度20480个字符。value、value_from和field_path必须三选一使用","type":"string"},"value_from":{"$ref":"#/definitions/ValueFrom","description":"环境变量可使用配置项和密钥导入。value、value_from和field_path必须三选一使用"}},"required":["name"],"title":"Env"},"ErrorResponse":{"description":"请求响应失败时的响应消息","properties":{"error_code":{"description":"错误码","type":"string"},"error_message":{"description":"错误信息","type":"string"},"request_id":{"description":"请求ID","type":"string"}},"required":["request_id","error_code","error_message"],"type":"object"},"Exec":{"properties":{"command":{"description":"探针执行命令,最大长度10240个字符。不允许^#~^$|%&*<>()'\"[]{}这些特殊字符","type":"string"}},"required":["command"],"title":"Exec"},"HostContainerPortMapping":{"properties":{"container_port":{"description":"容器端口,1到65535之间的整数","format":"int64","type":"integer"},"host_ip":{"description":"对应主机网卡地址,形如192.168.0.1","type":"string"},"host_port":{"description":"主机端口,1到65535之间的整数,与主机端口范围二选一","format":"int64","type":"integer"},"host_port_range":{"$ref":"#/definitions/HostPortRange","description":"主机端口范围,在范围内为应用实例自动分配主机端口;与主机端口参数二选一"}},"required":["container_port"],"title":"HostContainerPortMapping"},"HostPortRange":{"properties":{"max_port":{"description":"主机端口上限值,1到65535之间的整数;max_port需大于min_port","format":"int64","type":"integer"},"min_port":{"description":"主机端口下限制,1到65535之间的整数","format":"int64","type":"integer"}},"required":["max_port","min_port"],"title":"HostPortRange"},"HttpGet":{"properties":{"host":{"description":"请求的主机地址,默认为容器IP","type":"string"},"path":{"description":"必须要以/开头,构造结果为:协议类型://主机地址:端口路径","type":"string"},"port":{"description":"探测的http端口,1到65535之间的整数","format":"int32","type":"integer"},"scheme":{"description":"协议类型,HTTP或HTTPS,默认HTTP","type":"string"}},"required":["path","port"],"title":"HttpGet"},"NodeResult":{"description":"部署节点的返回结果","properties":{"error_code":{"description":"部署到该节点失败时,返回的错误码","type":"string"},"error_message":{"description":"部署到该节点失败时,返回的错误信息","type":"string"},"node_id":{"description":"部署的节点ID","type":"string"}},"required":["node_id"]},"PodConfig":{"properties":{"host_network":{"description":"应用实例是否启用主机网络,不启用则使用端口映射,默认值false","type":"boolean"},"host_pid":{"description":"应用实例是否与主机共PID命名空间,默认值false","type":"boolean"},"migration":{"description":"应用实例故障是否迁移,指定节点组部署时必选,默认值false","type":"boolean"},"restart_policy":{"description":"应用实例重启策略,可选值Always、OnFailure、Never","type":"string"},"toleration_seconds":{"description":"应用实例故障容忍时间,容忍时间到达后迁移应用实例,只在指定节点组部署时生效","format":"int32","type":"integer"}},"required":["host_network","restart_policy"],"title":"PodConfig"},"Probe":{"properties":{"exec":{"$ref":"#/definitions/Exec","description":"执行命令检查,与http_get二选一"},"http_get":{"$ref":"#/definitions/HttpGet","description":"执行http探测"},"initial_delay_seconds":{"description":"表示从工作负载启动后从多久开始探测,大于0且不大于3600的整数,默认为10","format":"int64","type":"integer"},"timeout_seconds":{"description":"表示探测超时时间,大于0且不大于3600的整数,默认为1","format":"int64","type":"integer"}},"title":"Probe"},"Res":{"properties":{"cpu":{"description":"cpu数量,字符串所对应的数值在0.01到1000之间","type":"string"},"gpu":{"description":"gpu数量,值在0到1000","type":"string"},"memory":{"description":"内存数量,如果是资源限制,其值范围在4到1024000之间,否则在0.01到1024000之间","type":"string"},"npu":{"description":"npu数量,字符串所对应的数值在0.到1000之间","type":"string"}},"title":"Res","type":"object"},"ResQuest":{"properties":{"limits":{"$ref":"#/definitions/Res","description":"允许容器使用的最大资源"},"requests":{"$ref":"#/definitions/Res","description":"容器需要使用的最小资源"}},"title":"ResQuest"},"ValueFrom":{"properties":{"configmap":{"$ref":"#/definitions/ConfigsMap","description":"环境变量引用配置项时使用。使用ValueFrom时,secret与configmap必须二选一"},"secret":{"$ref":"#/definitions/DeploymentSecrets","description":"环境变量引用密钥时使用。使用ValueFrom时,secret与configmap必须二选一"}},"title":"ValueFrom"},"Volume":{"properties":{"destination":{"description":"卷挂载路径,必须是合法的路径","type":"string"},"key":{"description":"卷的类型,支持configMap,secret,emptyDir,hostPath","type":"string"},"name":{"description":"卷名称,小写字母或数字,最长63个字符","type":"string"},"read_only":{"description":"读写权限,configMap和secret类型只支持读权限","type":"boolean"},"source":{"description":"卷来源,type为hostPath时输入路径,要求以/开头,后面可包含中划线,反斜杠,下划线,点号,字母,数字; secret时输入secret名称,configMap时输入configMap名称,emptyDir时输入disk或memory","type":"string"},"type":{"description":"卷的类型,支持configMap,secret,emptyDir,hostPath","type":"string"}},"required":["destination","key","name","read_only","source","type"],"title":"Volume"}},"description":null,"group_id":"3309a57eaa6041a7a890c458be112fe2","host":"hilens.cn-north-4.myhuaweicloud.com","id":"9b64eddfd0c74f07aa1f482046051272","info_version":"v3","method":"put","name":"AddDeploymentNodes","parameters":{},"paths":{"/v3/{project_id}/ai-mgr/deployments/{deployment_id}/nodes":{"put":{"consumes":["application/json"],"description":"通过指定设备id列表或者设备标签将应用部署下发到多个设备上。","operationId":"AddDeploymentNodes","parameters":[{"description":"用户Token。获取方法请参见[获取Token](https://support.huaweicloud.com/api-iam/iam_30_0001.html)","in":"header","name":"X-Auth-Token","required":true,"type":"string"},{"description":"添加部署节点的相关信息","in":"body","name":"deploymentAddNodesRequest","required":true,"schema":{"$ref":"#/definitions/DeploymentAddNodesRequest"}},{"description":"部署ID","in":"path","name":"deployment_id","required":true,"type":"string"},{"description":"项目ID,获取方法请参见[获取项目ID](hilens_07_0020.xml)","in":"path","name":"project_id","required":true,"type":"string"},{"description":"平台提供者,分别为hilens及ief。当为hilens时,请求部署在hilens平台的相关数据。","in":"query","name":"provider","required":false,"type":"string"}],"produces":["*/*","application/json"],"responses":{"200":{"description":"请求成功","examples":{"application/json":{"api_version":null,"cluster_id":"","created_at":"2022-01-25 15:57:07 GMT+08:00","description":"","id":"hilens-9eebd2c03a2e48a6a47949fcb4f3f66f","name":"example1","node_ids":["hilens-e17b497c3a00406f89f605e5c16b40d7"],"project_id":"fff47e1722f94c4e98531bae56821372","ready_replicas":0,"reason":null,"replicas":1,"result":[{"node_id":"hilens-e17b497c3a00406f89f605e5c16b40d7"}],"source":"userdefined","state":"CREATING","template":{"apps":[{"app_id":"hilens-a0af9c565a5f4486951a47e852e0999d","app_url":"swr.cn-north-7.myhuaweicloud.com/ei_hilens_z00382034_01/hilens-framework-x64-image:20210318114258.8801483","args":[],"command":["--log_dir=/train --learning_rate=0.01 --batch_size=150"],"envs":[{"name":"IVA_SVC_CONFIG","value":"{\"algorithm\":{\"multiTask\":\"no\",\"algType\":\"hilens\"},\"cloud\":{\"disEndpoint\":\"https://dis.cn-north-7.myhuaweicloud.com\",\"region\":\"cn-north-7\"},\"svcInstanceId\":\"modelbox-instance-xxxx\"}"}],"is_modelbox":true,"msgs":[],"name":"example1-skill-name","ports":[{"container_port":10,"host_ip":"10.10.10.10","host_port":23}],"privileged":false,"resources":{"limits":{"cpu":"0.25","memory":"128"},"requests":{}},"volumes":[{"destination":"/tmp","name":"tmp","read_only":false,"source":"memory","type":"emptyDir"},{"destination":"/run","name":"run","read_only":false,"source":"memory","type":"emptyDir"},{"destination":"/sys/fs/cgroup","name":"cgroup","read_only":true,"source":"/sys/fs/cgroup","type":"hostPath"}]}],"configs":{"host_network":false,"host_pid":false,"migration":false,"restart_policy":"Always","toleration_seconds":0}},"updated_at":"2022-01-25 15:57:07 GMT+08:00"}},"schema":{"$ref":"#/definitions/Deployment"}},"401":{"description":"认证不通过","schema":{"$ref":"#/definitions/ErrorResponse"}},"403":{"description":"拒绝执行请求","schema":{"$ref":"#/definitions/ErrorResponse"}},"404":{"description":"请求的资源不存在","schema":{"$ref":"#/definitions/ErrorResponse"}},"500":{"description":"服务器内部错误","schema":{"$ref":"#/definitions/ErrorResponse"}}},"summary":"批量部署","tags":["应用部署管理"],"x-is-registered":"Y","x-open-region-cloud":"hc","x-request-examples-1":"Request Header:\nContent-Type: application/json\nX-Auth-Token: MIINRwYJKoZIhvcNAQcCoIINODCCDTQCAQExDTALBglghkgBZQMEAgEwgguVBgkqhkiG...\nRequest Body:\n{\n    \"node_num\": 2,\n    \"node_Ids\": [\n        \"hilens-d087f32be2c641278bfc4c4d071b86ef\",\n        \"hilens-d087f32be2c641278bfc4c4d071b86eg\"\n    ],\n    \"deployment_id\": \"hilens-d087f32be2c641278bfc4c4d071b86ef\"\n}","x-request-examples-2":"Request Header:\nContent-Type: application/json\nX-Auth-Token: MIINRwYJKoZIhvcNAQcCoIINODCCDTQCAQExDTALBglghkgBZQMEAgEwgguVBgkqhkiG...\nRequest Body:\n{\n    \"node_num\": 1,\n    \"node_tags\": [\n        {\n            \"key\": \"tag1\",\n            \"value\": \"val1\"\n        }\n    ],\n    \"deployment_id\": \"hilens-d087f32be2c641278bfc4c4d071b86ef\"\n}","x-request-examples-description-1":"发送往部署添加节点请求,把已有的部署下发到指定的节点。","x-request-examples-description-2":"往指定部署添加含有指定标签的设备","x-request-examples-text-1":"Request Header:\nContent-Type: application/json\nX-Auth-Token: MIINRwYJKoZIhvcNAQcCoIINODCCDTQCAQExDTALBglghkgBZQMEAgEwgguVBgkqhkiG...\nRequest Body:\n{\n    \"node_num\": 2,\n    \"node_Ids\": [\n        \"hilens-d087f32be2c641278bfc4c4d071b86ef\",\n        \"hilens-d087f32be2c641278bfc4c4d071b86eg\"\n    ],\n    \"deployment_id\": \"hilens-d087f32be2c641278bfc4c4d071b86ef\"\n}","x-request-examples-text-2":"Request Header:\nContent-Type: application/json\nX-Auth-Token: MIINRwYJKoZIhvcNAQcCoIINODCCDTQCAQExDTALBglghkgBZQMEAgEwgguVBgkqhkiG...\nRequest Body:\n{\n    \"node_num\": 1,\n    \"node_tags\": [\n        {\n            \"key\": \"tag1\",\n            \"value\": \"val1\"\n        }\n    ],\n    \"deployment_id\": \"hilens-d087f32be2c641278bfc4c4d071b86ef\"\n}","x-request-examples-url-1":"PUT https://{endpoint}/v3/{project_id}/ai-mgr/deployments/{deployment_id}/nodes","x-request-examples-url-2":"PUT https://{endpoint}/v3/{project_id}/ai-mgr/deployments/{deployment_id}/nodes","x-support-sdk":"Y"}}},"product_short":"HiLens","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"批量部署","tags":"应用部署管理","uri":null,"version":"2.0"}