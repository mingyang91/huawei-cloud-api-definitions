{"base_path":"/","components":null,"consumes":"[\"application/json;charset=UTF-8\"]","definitions":{"AutoScalingPolicy":{"properties":{"auto_scaling_enable":{"description":"当前自动伸缩规则是否开启。","type":"boolean"},"exec_scripts":{"description":"弹性伸缩自定义自动化脚本列表。若该参数为空表示不启用自动化脚本。","items":{"$ref":"#/definitions/ScaleScript"},"maxItems":10,"minItems":0,"type":"array"},"max_capacity":{"description":"指定该节点组的最大节点数。\n\n取值范围:[0~500]","format":"int32","maximum":500,"minimum":0,"type":"integer"},"min_capacity":{"description":"指定该节点组的最小保留节点数。\n\n取值范围:[0~500]","format":"int32","maximum":500,"minimum":0,"type":"integer"},"resources_plans":{"description":"资源计划列表。若该参数为空表示不启用资源计划。\n\n当启用弹性伸缩时,资源计划与自动伸缩规则需至少配置其中一种。","items":{"$ref":"#/definitions/ResourcesPlan"},"maxItems":5,"minItems":0,"type":"array"},"rules":{"description":"自动伸缩的规则列表。\n\n当启用弹性伸缩时,资源计划与自动伸缩规则需至少配置其中一种。","items":{"$ref":"#/definitions/Rule"},"maxItems":10,"minItems":0,"type":"array"}},"required":["auto_scaling_enable","max_capacity","min_capacity"],"type":"object"},"AutoScalingPolicyReqV11":{"properties":{"auto_scaling_policy":{"$ref":"#/definitions/AutoScalingPolicy","description":"弹性伸缩规则。"},"node_group":{"description":"弹性伸缩规则适用的节点类型,当前只支持task节点。","enum":["task_node_default_group"],"type":"string"}},"required":["auto_scaling_policy","node_group"],"type":"object"},"ResourcesPlan":{"properties":{"end_time":{"description":"资源计划的结束时间,格式与“start_time”相同,不早于start_time表示的时间,且与start_time间隔不小于30min。","type":"string"},"max_capacity":{"description":"资源计划内该节点组的最大保留节点数。\n\n取值范围:[0~500]","format":"int32","maximum":500,"minimum":0,"type":"integer"},"min_capacity":{"description":"资源计划内该节点组的最小保留节点数。\n\n取值范围:[0~500]","format":"int32","maximum":500,"minimum":0,"type":"integer"},"period_type":{"description":"资源计划的周期类型,当前只允许以下类型:\n\ndaily","type":"string"},"start_time":{"description":"资源计划的起始时间,格式为“hour:minute”,表示时间在0:00-23:59之间。","type":"string"}},"required":["end_time","max_capacity","min_capacity","period_type","start_time"],"type":"object"},"Rule":{"properties":{"adjustment_type":{"description":"弹性伸缩规则的调整类型,只允许以下类型:\n\n枚举值:\n- scale_out:扩容\n- scale_in:缩容","enum":["scale_out","scale_in"],"type":"string"},"cool_down_minutes":{"description":"触发弹性伸缩规则后,该集群处于冷却状态(不再执行弹性伸缩操作)的时长,单位为分钟。\n\n取值范围[0~10080],10080为一周的分钟数。","format":"int32","maximum":10080,"minimum":0,"type":"integer"},"description":{"description":"弹性伸缩规则的说明。\n\n最大长度为1024字符。","maxLength":1024,"minLength":0,"type":"string"},"name":{"description":"弹性伸缩规则的名称。\n\n只能由字母、数字、中划线和下划线组成,并且长度为1~64个字符。\n\n在一个节点组范围内,不允许重名。","maxLength":64,"minLength":1,"type":"string"},"scaling_adjustment":{"description":"单次调整集群节点的个数。\n\n取值范围[1~100]","format":"int32","maximum":100,"minimum":1,"type":"integer"},"trigger":{"$ref":"#/definitions/Trigger","description":"描述该规则触发条件。"}},"required":["adjustment_type","cool_down_minutes","name","scaling_adjustment","trigger"],"type":"object"},"ScaleScript":{"properties":{"action_stage":{"description":"脚本执行时机。\n\n枚举值:\n- before_scale_out:扩容前\n- before_scale_in:缩容前\n- after_scale_out:扩容后\n- after_scale_in:缩容后","enum":["before_scale_out","before_scale_in","after_scale_out","after_scale_in"],"type":"string"},"active_master":{"description":"自定义自动化脚本是否只运行在主Master节点上。\n\n缺省值为false,表示自定义自动化脚本可运行在所有Master节点上。","type":"boolean"},"fail_action":{"description":"自自定义自动化脚本执行失败后,是否继续执行后续脚本和创建集群。\n\n说明:\n\n- 建议您在调试阶段设置为“continue”,无论此自定义自动化脚本是否执行成功,则集群都能继续安装和启动。\n\n- 由于缩容成功无法回滚,因此缩容后执行的脚本“fail_action”必须设置为“continue”。\n\n枚举值:\n- continue:继续执行后续脚本。\n- errorout:终止操作。","enum":["continue","errorout"],"type":"string"},"name":{"description":"弹性伸缩自定义自动化脚本的名称,同一个集群的自定义自动化脚本名称不允许相同。\n\n只能由数字、英文字符、空格、中划线和下划线组成,且不能以空格开头。\n\n可输入的字符串长度为1~64个字符。","maxLength":64,"minLength":1,"type":"string"},"nodes":{"description":"自定义自动化脚本所执行的节点组名称(非自定义集群也可使用节点类型,包含Master、Core和Task三种类型)。","items":{"type":"string"},"type":"array"},"parameters":{"description":"自定义自动化脚本参数。\n\n多个参数间用空格隔开。\n可以传入以下系统预定义参数:\n- ${mrs_scale_node_num}:扩缩容节点数\n- ${mrs_scale_type}:扩缩容类型,扩容为scale_out,缩容为scale_in\n- ${mrs_scale_node_hostnames}:扩缩容的节点主机名称\n- ${mrs_scale_node_ips}:扩缩容的节点IP\n- ${mrs_scale_rule_name}:触发扩缩容的规则名\n\n\n其他用户自定义参数使用方式与普通shell脚本相同,多个参数中间用空格隔开。","type":"string"},"uri":{"description":"自定义自动化脚本的路径。设置为OBS桶的路径或虚拟机本地的路径。\n\n- OBS桶的路径:直接手动输入脚本路径。示例:s3a://XXX/scale.sh\n\n- 虚拟机本地的路径:用户需要输入正确的脚本路径。脚本所在的路径必须以‘/’开头,以.sh结尾。","type":"string"}},"required":["action_stage","fail_action","name","nodes","uri"],"type":"object"},"Trigger":{"properties":{"comparison_operator":{"description":"指标判断逻辑运算符,包括:\n\n- LT:小于\n- GT:大于\n- LTOE:小于等于\n- GTOE:大于等于","type":"string"},"evaluation_periods":{"description":"判断连续满足指标阈值的周期数(一个周期为5分钟)。\n\n取值范围[1~288]","format":"int32","maximum":288,"minimum":1,"type":"integer"},"metric_name":{"description":"指标名称。\n\n该触发条件会依据该名称对应指标的值来进行判断。\n\n最大长度为64个字符。","maxLength":64,"minLength":0,"type":"string"},"metric_value":{"description":"指标阈值。\n\n触发该条件的指标阈值,只允许输入整数或者带两位小数的数。","type":"string"}},"required":["evaluation_periods","metric_name","metric_value"],"type":"object"}},"description":null,"group_id":"64579295290047fea862f501e033ff3f","host":"mrs.cn-north-4.myhuaweicloud.com","id":"1d4606437d314eb7a51fb99141762ecd","info_version":"v1","method":"post","name":"CreateScalingPolicy","parameters":{},"paths":{"/v1.1/{project_id}/autoscaling-policy/{cluster_id}":{"post":{"consumes":["application/json"],"deprecated":false,"description":"对弹性伸缩规则进行编辑。\n\n在创建集群并执行作业接口中也可以创建弹性伸缩规则。","operationId":"CreateScalingPolicy","parameters":[{"description":"项目编号。获取方法,请参见[获取项目ID](https://support.huaweicloud.com/api-mrs/mrs_02_0011.html)。","in":"path","name":"project_id","required":true,"type":"string","x-example":"2b31ed520xxxxxxebedb6e57xxxxxxxx"},{"description":"集群ID。获取方法,请参见[获取集群ID](https://support.huaweicloud.com/api-mrs/mrs_02_9001.html)。","in":"path","name":"cluster_id","required":true,"type":"string","x-example":"431b135exxxxxxebedb6e57xxxxxxxx"},{"description":"弹性伸缩请求体","in":"body","name":"autoScalingPolicyReqV11","required":false,"schema":{"$ref":"#/definitions/AutoScalingPolicyReqV11"}}],"produces":["application/json"],"responses":{"200":{"description":"操作成功。","examples":{"application/json":{"result":"succeeded"}},"schema":{"type":"string"}}},"summary":"配置弹性伸缩规则","tags":["弹性伸缩接口"],"x-apiexplorer-hide":"N","x-apigateway-auth-type":"IAM","x-apigateway-match-mode":"NORMAL","x-apigateway-request-type":"public","x-call_frequency":"high","x-constraint":"无","x-ctc":"N","x-hc":"Y","x-hk":"Y","x-hybridcloud":true,"x-is-registered":"Y","x-is_calling":"Y","x-is_registered":"Y","x-name":"配置弹性伸缩规则","x-obc":"N","x-otc":"N","x-request-examples-1":{"auto_scaling_policy":{"auto_scaling_enable":true,"exec_scripts":[{"action_stage":"before_scale_out","active_master":true,"fail_action":"continue","name":"before_scale_out","nodes":["master","core","task"],"parameters":"${mrs_scale_node_num} ${mrs_scale_type} xxx","uri":"s3a://XXX/zeppelin_install.sh"},{"action_stage":"after_scale_out","active_master":true,"fail_action":"continue","name":"after_scale_out","nodes":["master_node_default_group","core_node_analysis_group","task_node_analysis_group"],"parameters":"${mrs_scale_node_hostnames} ${mrs_scale_node_ips}","uri":"s3a://XXX/storm_rebalance.sh"}],"max_capacity":"3","min_capacity":"1","resources_plans":[{"end_time":"10:20","max_capacity":"3","min_capacity":"2","period_type":"daily","start_time":"9:50"},{"end_time":"12:30","max_capacity":"2","min_capacity":"0","period_type":"daily","start_time":"10:20"}],"rules":[{"adjustment_type":"scale_out","cool_down_minutes":"5","name":"default-expand-1","scaling_adjustment":"1","trigger":{"comparison_operator":"LT","evaluation_periods":"10","metric_name":"YARNMemoryAvailablePercentage","metric_value":"25"}},{"adjustment_type":"scale_in","cool_down_minutes":"5","name":"default-shrink-1","scaling_adjustment":"1","trigger":{"comparison_operator":"GT","evaluation_periods":"10","metric_name":"YARNMemoryAvailablePercentage","metric_value":"70"}}]},"node_group":"task_node_analysis_group"},"x-request-examples-description-1":"配置弹性伸缩规则请求示例","x-request-examples-text-1":"{\n  \"node_group\": \"task_node_analysis_group\",\n  \"auto_scaling_policy\": {\n    \"auto_scaling_enable\": \"true\",\n    \"min_capacity\": \"1\",\n    \"max_capacity\": \"3\",\n    \"resources_plans\": [\n      {\n        \"period_type\": \"daily\",\n        \"start_time\": \"9:50\",\n        \"end_time\": \"10:20\",\n        \"min_capacity\": \"2\",\n        \"max_capacity\": \"3\"\n      },\n      {\n        \"period_type\": \"daily\",\n        \"start_time\": \"10:20\",\n        \"end_time\": \"12:30\",\n        \"min_capacity\": \"0\",\n        \"max_capacity\": \"2\"\n      }\n    ],\n    \"exec_scripts\": [\n      {\n        \"name\": \"before_scale_out\",\n        \"uri\": \"s3a://XXX/zeppelin_install.sh\",\n        \"parameters\": \"${mrs_scale_node_num} ${mrs_scale_type} xxx\",\n        \"nodes\": [\n          \"master_node_default_group\",\n          \"core_node_analysis_group\",\n          \"task_node_analysis_group\"\n        ],\n        \"active_master\": \"true\",\n        \"action_stage\": \"before_scale_out\",\n        \"fail_action\": \"continue\"\n      },\n      {\n        \"name\": \"after_scale_out\",\n        \"uri\": \"s3a://XXX/storm_rebalance.sh\",\n        \"parameters\": \"${mrs_scale_node_hostnames} ${mrs_scale_node_ips}\",\n        \"nodes\": [\n          \"master_node_default_group\",\n          \"core_node_analysis_group\",\n          \"task_node_analysis_group\"\n        ],\n        \"active_master\": \"true\",\n        \"action_stage\": \"after_scale_out\",\n        \"fail_action\": \"continue\"\n      }\n    ],\n    \"rules\": [\n      {\n        \"name\": \"default-expand-1\",\n        \"adjustment_type\": \"scale_out\",\n        \"cool_down_minutes\": \"5\",\n        \"scaling_adjustment\": \"1\",\n        \"trigger\": {\n          \"metric_name\": \"YARNMemoryAvailablePercentage\",\n          \"metric_value\": \"25\",\n          \"comparison_operator\": \"LT\",\n          \"evaluation_periods\": \"10\"\n        }\n      },\n      {\n        \"name\": \"default-shrink-1\",\n        \"adjustment_type\": \"scale_in\",\n        \"cool_down_minutes\": \"5\",\n        \"scaling_adjustment\": \"1\",\n        \"trigger\": {\n          \"metric_name\": \"YARNMemoryAvailablePercentage\",\n          \"metric_value\": \"70\",\n          \"comparison_operator\": \"GT\",\n          \"evaluation_periods\": \"10\"\n        }\n      }\n    ]\n  }\n}","x-request-examples-url-1":"POST https://{endpoint}/v1.1/{project_id}/autoscaling-policy/{cluster_id}","x-scope":"Commercial","x-support-sdk":"Y","x-tlf":"N","x-version":"v1.1"}}},"product_short":"MRS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"配置弹性伸缩规则","tags":"弹性伸缩接口","uri":null,"version":"2.0"}