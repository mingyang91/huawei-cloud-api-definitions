{"base_path":null,"components":null,"consumes":"[\"application/json;charset=UTF-8\"]","definitions":{"DeviceMessageRequest":{"properties":{"encoding":{"default":"none","description":"**参数说明**:消息内容编码格式。默认值none。\n**取值范围**:\n- none \n- base64","example":"none","pattern":"(none|base64)","type":"string"},"message":{"description":"**参数说明**:消息内容,支持string和json格式。","example":"HelloWorld","properties":{},"type":"object"},"message_id":{"description":"**参数说明**:消息id,由用户生成(推荐使用UUID),同一个设备下唯一, 如果用户填写的id在设备下不唯一, 则接口返回错误。\n**取值范围**:长度不超过100,只允许字母、数字、下划线(_)、连接符(-)的组合。","example":"99b32da9-cd17-4cdf-a286-f6e849cbc364","maxLength":128,"pattern":"^[\\u4e00-\\u9fa5a-zA-Z0-9_?'#()\\.,&%@!-]*$","type":"string"},"name":{"description":"**参数说明**:消息名称。\n**取值范围**:长度不超过128,只允许中文、字母、数字、以及_?'#().,&%@!-等字符的组合。","example":"messageName","maxLength":128,"pattern":"^[\\u4e00-\\u9fa5a-zA-Z0-9_?'#()\\.,&%@!-]*$","type":"string"},"payload_format":{"default":"standard","description":"**参数说明**:有效负载格式,在消息内容编码格式为none时有效。默认值standard(平台封装的标准格式)。\n**取值范围**:\n- standard \n- raw:直接将消息内容作为有效负载下发。","example":"standard","pattern":"(standard|raw)","type":"string"},"properties":{"$ref":"#/definitions/PropertiesDTO","description":"**参数说明**:消息下行到设备的属性参数。"},"topic":{"description":"**参数说明**:消息下行到设备的自定义topic后缀, 可选, 仅适用于MQTT协议接入的设备。 用户只能填写在租户产品界面配置的topic, 否则会校验不通过。 平台给消息topic添加的前缀为$oc/devices/{device_id}/user/, 用户可以在前缀的基础上增加自定义部分, 如增加messageDown,则平台拼接前缀后完整的topic为 $oc/devices/{device_id}/user/messageDown,其中device_id以实际设备的网关id替代。 如果用户指定该topic,消息会通过该topic下行到设备,如果用户不指定, 则消息通过系统默认的topic下行到设备,系统默认的topic格式为: $oc/devices/{device_id}/sys/messages/down。此字段与topic_full_name字段只可填写一个。","example":"messageDown","maxLength":128,"type":"string"},"topic_full_name":{"description":"**参数说明**:消息下行到设备的完整topic名称, 可选。用户需要下发用户自定义的topic给设备时,可以使用该参数指定完整的topic名称,物联网平台不校验该topic是否在平台定义,直接透传给设备。设备需要提前订阅该topic。此字段与topic字段只可填写一个。","example":"/device/message/down","maxLength":128,"pattern":"^([$/]?[a-zA-Z0-9(),\\-.:=@;_!*'%?+]*)([a-zA-Z0-9(),\\-.:=@;_!*'%?+]+/)*([a-zA-Z0-9(),\\-.:=@;_!*'%?+]*|#)$","type":"string"},"ttl":{"description":"**参数说明**:下发消息在平台缓存的老化时间,时间单位是分钟,默认值1440;ttl参数数值必须是5的倍数,即以5分钟为粒度;指定为0时表示不缓存消息,最大缓存时间1440分钟,即缓存一天","example":1440,"format":"int32","maximum":10080,"minimum":0,"type":"integer"}},"required":["message"],"title":"DeviceMessageRequest 创建设备消息的请求对象","type":"object"},"DeviceMessageResponse":{"properties":{"message_id":{"description":"消息id,由用户生成(推荐使用UUID),同一个设备下唯一, 如果用户不填写,则由物联网平台生成。","example":"b1224afb-e9f0-4916-8220-b6bab568e888","type":"string"},"result":{"$ref":"#/definitions/MessageResult","description":"消息下发结果。Json格式。"}},"title":"DeviceMessageResponse 创建设备消息返回结构体V5","type":"object"},"MessageResult":{"description":"下发的消息响应结果","properties":{"created_time":{"description":"消息的创建时间,\"yyyyMMdd'T'HHmmss'Z'\"格式的UTC字符串。","example":"20151212T121212Z","type":"string"},"finished_time":{"description":"消息结束时间, \"yyyyMMdd'T'HHmmss'Z'\"格式的UTC字符串,包含消息转换到DELIVERED,FAILED和TIMEOUT状态的时间。","example":"20151212T121213Z","type":"string"},"status":{"description":"消息状态, PENDING,DELIVERED,FAILED和TIMEOUT。如果设备不在线,则平台缓存消息,并且返回PENDING,等设备数据上报之后再下发;如果设备在线,则消息直接进行下发,下发成功后接口返回DELIVERED,失败返回FAILED;如果消息在平台默认时间内(1天)还没有下发给设备,则平台会将消息设置为超时,状态为TIMEOUT。另外应用可以订阅消息的执行结果,平台会将消息结果推送给订阅的应用。","example":"PENDING","type":"string"}},"type":"object"},"PropertiesDTO":{"description":"属性数据","properties":{"correlation_data":{"description":"**参数说明**:MQTT 5.0版本请求和响应模式中的相关数据,可选。用户可以通过该参数配置MQTT协议请求和响应模式中的相关数据。\n**取值范围**:长度不超过128,只允许字母、数字、下划线(_)、连接符(-)的组合。","example":"d4922d8a-6c8e-4396-852c-164aefa6638q","pattern":"^[a-zA-Z0-9_-]{0,128}$","type":"string"},"response_topic":{"description":"**参数说明**:MQTT 5.0版本请求和响应模式中的响应主题,可选。用户可以通过该参数配置MQTT协议请求和响应模式中的响应主题。\n**取值范围**:长度不超过128, 只允许字母、数字、以及_-?=$#+/等字符的组合。","example":"/device/message/response","maxLength":128,"pattern":"^[a-zA-Z0-9_?=$#+/-]{0,128}$","type":"string"},"user_properties":{"description":"**参数说明**:用户自定义属性,可选。用户可以通过该参数配置用户自定义属性。可以配置的最大自定义属性数量为20。","items":{"$ref":"#/definitions/UserPropDTO"},"type":"array","x-maxLength":20,"x-minLength":0}},"title":"属性数据结构体","type":"object","x-imports":"java.util.List"},"UserPropDTO":{"description":"用户自定义属性","properties":{"prop_key":{"description":"**参数说明**:用户自定义属性键。\n**取值范围**:长度不超过128,只允许字母、数字、下划线(_)、连接符(-)的组合。","example":"propKey1","pattern":"^[a-zA-Z0-9_-]{0,128}$","type":"string"},"prop_value":{"description":"**参数说明**:用户自定义属性值。\n**取值范围**:长度不超过128,只允许中文、字母、数字、以及_? '#().,&%@!-等字符的组合。","example":"propValue1","pattern":"^[\\u4e00-\\u9fa5a-zA-Z0-9_?'#()\\.,&%@!-]{0,128}$","type":"string"}},"title":"用户自定义属性结构体","type":"object"}},"description":null,"group_id":"bf0cdd341d8b4c6f833486a40289d422","host":"iotda.cn-north-4.myhuaweicloud.com","id":"e81778110d8d40ada34acf66f0b6c242","info_version":"v5","method":"post","name":"CreateMessage","parameters":{},"paths":{"/v5/iot/{project_id}/devices/{device_id}/messages":{"post":{"consumes":["application/json"],"description":"物联网平台可向设备下发消息,应用服务器可调用此接口向指定设备下发消息,以实现对设备的控制。应用将消息下发给平台后,平台返回应用响应结果,平台再将消息发送给设备。平台返回应用响应结果不一定是设备接收结果,建议用户应用通过订阅[设备消息状态变更通知](https://support.huaweicloud.com/api-iothub/iot_06_v5_01203.html),订阅后平台会将设备接收结果推送给订阅的应用。\n注意:\n- 此接口适用于MQTT设备消息下发,暂不支持其他协议接入的设备消息下发。\n- 此接口仅支持单个设备消息下发,如需多个设备消息下发,请参见 [创建批量任务](https://support.huaweicloud.com/api-iothub/iot_06_v5_0045.html)。","operationId":"CreateMessage","parameters":[{"description":"**参数说明**:项目ID。获取方法请参见 [获取项目ID](https://support.huaweicloud.com/api-iothub/iot_06_v5_1001.html) 。","in":"path","name":"project_id","pattern":"^[a-fA-F0-9]{1,32}$","required":true,"type":"string","x-example":"2b31ed520xxxxxxebedb6e57xxxxxxxx"},{"description":"**参数说明**:下发消息的设备ID,用于唯一标识一个设备,在注册设备时由物联网平台分配获得。\n**取值范围**:长度不超过128,只允许字母、数字、下划线(_)、连接符(-)的组合。","in":"path","name":"device_id","pattern":"^[a-zA-Z0-9_-]{1,128}$","required":true,"type":"string"},{"description":"**参数说明**:用户Token。通过调用IAM服务 [获取IAM用户Token](https://support.huaweicloud.com/api-iam/iam_30_0001.html)接口获取,接口返回的响应消息头中“X-Subject-Token”就是需要获取的用户Token。简要的获取方法样例请参见 [Token认证](https://support.huaweicloud.com/api-iothub/iot_06_v5_0091.html#section0)。","in":"header","name":"X-Auth-Token","required":false,"type":"string","x-effective-scene":"huaweicloud","x-example":"MIIDkgYJKoZIhvcNAQcCoIIDgzCCXXXXX..."},{"description":"**参数说明**:实例ID。物理多租下各实例的唯一标识,建议携带该参数,在使用专业版时必须携带该参数。您可以在IoTDA管理控制台界面,选择左侧导航栏“总览”页签查看当前实例的ID,具体获取方式请参考[查看实例详情](https://support.huaweicloud.com/usermanual-iothub/iot_01_0121.html) 。","in":"header","name":"Instance-Id","pattern":"[0-9a-f-]{1,36}","required":false,"type":"string","x-example":"1a7ffc5c-d89c-44dd-8265-b1653d951ce0"},{"description":"请求结构体,见请求结构体说明","in":"body","name":"CreateMessageRequestBody","required":true,"schema":{"$ref":"#/definitions/DeviceMessageRequest"}}],"produces":["application/json"],"responses":{"201":{"description":"Created","examples":{"application/json":{"message_id":"b1224afb-e9f0-4916-8220-b6bab568e888","result":{"created_time":"20151212T121212Z","finished_time":"20151212T121213Z","status":"PENDING"}}},"schema":{"$ref":"#/definitions/DeviceMessageResponse"},"x-SuccessCode":true},"400":{"description":"Bad Request","x-Error":["IOTDA.014130","IOTDA.014150","IOTDA.014151"]},"403":{"description":"Forbidden","x-Error":["IOTDA.000021","IOTDA.001006","IOTDA.000022","IOTDA.014018"]},"404":{"description":"Not Found","x-Error":["IOTDA.014000"]},"500":{"description":"Internal Server Error","x-Error":["IOTDA.000001","IOTDA.000020"]}},"summary":"下发设备消息","tags":["MessageManagement"],"x-imports":"org.springframework.http.ResponseEntity;","x-is-registered":"Y","x-publishpath":"iot_06_v5_0059","x-request-examples-1":{"message":"HelloWorld","message_id":"99b32da9-cd17-4cdf-a286-f6e849cbc364","name":"messageName"},"x-request-examples-description-1":"平台默认topic下发","x-request-examples-description-2":"平台自定义topic下发","x-request-examples-description-3":"自定义topic下发","x-request-examples-text-1":{"message":"HelloWorld","message_id":"99b32da9-cd17-4cdf-a286-f6e849cbc364","name":"messageName"},"x-request-examples-text-2":{"message":"HelloWorld","message_id":"99b32da9-cd17-4cdf-a286-f6e849cbc364","name":"messageName","topic":"testTopic"},"x-request-examples-text-3":{"message":"HelloWorld","message_id":"99b32da9-cd17-4cdf-a286-f6e849cbc364","name":"messageName","topic_full_name":"/test/customTopic/testTopic"},"x-request-examples-url-1":"POST https://{endpoint}/v5/iot/{project_id}/devices/{device_id}/messages","x-request-examples-url-2":"POST https://{endpoint}/v5/iot/{project_id}/devices/{device_id}/messages","x-request-examples-url-3":"POST https://{endpoint}/v5/iot/{project_id}/devices/{device_id}/messages","x-returnType":"ResponseEntity<DeviceMessageResponse>","x-support-sdk":"Y"}}},"product_short":"IoTDA","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"下发设备消息","tags":"设备消息","uri":null,"version":"2.0"}