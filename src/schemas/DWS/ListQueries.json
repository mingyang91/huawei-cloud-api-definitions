{"base_path":"/","components":null,"consumes":"[\"application/json;charset=UTF-8\"]","definitions":{"ListQueriesCondition":{"properties":{"field":{"description":"字段名称参考下方字段列表\nsystemQuery\tboolean\t是否隐藏系统查询\nuserName\tString\t用户名称\napplicationName\tString\t应用名称\ndbName\tString\t数据库名称\nresourcePool\tString\t资源池\nqueryStatus\tString\t查询状态\nenqueue\tString\t排队状态\nlane\tString\t快慢车道\ninstName\tString\t接入CN\npid\tString\t会话ID\nblockTime\tint\t阻塞时间(ms)\nduration\tint\t执行时间(ms)\nminCpuTime\tint\t最小cpu时间(ms)\nmaxCpuTime\tint\t最大cpu时间(ms)\ntotalCpuTime\tint\tCPU时间(ms)\ncpuSkewPercent\tint\tCPU时间倾斜(%)\nspillInfo\tString\tdn下盘信息\nminSpillSize\tint\tdn上下盘的最小数据量(mb)\nmaxSpillSize\tint\tdn上下盘的最大数据量(mb)\naverageSpillSize\tint\t平均下盘量(MB)\nspillSkewPercent\tint\tdn间下盘倾斜率\nqueryBand\tString\t作业类型\njobName\tString\t任务名称\njobInst\tString\t任务实例\nclientHostname\tString\t主机名称\nclientPort\tString\tTCP端口\nwaiting\tboolean\t是否等待\nestimateTotalTime\tint\t预估总执行时间(ms)\nestimateLeftTime\tint\t预估剩余时间(ms)\ncontrolGroup\tString\tcgroup\nminPeakMemory\tint\tdn最小内存峰值(mb)\nmaxPeakMemory\tint\tdn最大内存峰值(mb)\naveragePeakMemory\tint\t内存使用平均值(mb)\nmemorySkewPercent\tint\t各dn内存使用倾斜率\nestimateMemory\tint\t预估使用内存(mb)\nminDnTime\tint\tdn最小执行时间(ms)\nmaxDnTime\tint\tdn最大执行时间(ms)\naverageDnTime\tint\tdn平均执行时间(ms)\ndntimeSkewPercent\tint\t各dn的执行时间倾斜率\nwarning\tString\t告警\naveragePeakIops\tint\tdn每秒平均io 峰值(列存是次/s,行存是万次/s)\niopsSkewPercent\tint\tdn间的io倾斜率\nwlmStatus\tString\t语句运行状态\nwlmAttrib\tString\t语句属性","type":"string"},"operator":{"description":"比较方式:\nString类型参数:=、!=、like、not like\nint类型参数:=、!=、>、<、>=、<=\nboolean类型参数:=、!=","type":"string"},"value":{"description":"字段值","type":"string"}},"required":["field","value","operator"],"type":"object"},"ListQueriesData":{"properties":{"queries":{"description":"查询数据列表。","items":{"$ref":"#/definitions/ListQueriesDto"},"type":"array"},"status":{"$ref":"#/definitions/ListQueriesStatus","description":"统计数据。"}},"type":"object"},"ListQueriesDto":{"properties":{"application_name":{"description":"连接到后端的应用名。","example":"workload","type":"string"},"average_dn_time":{"description":"语句在所有dn上的平均执行时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"average_peak_iops":{"description":"语句在所有dn上的每秒平均io峰值(列存单位是次/s,行存单位是万次/s)。","example":0,"format":"int32","type":"integer"},"average_peak_memory":{"description":"语句执行过程中的内存使用平均值 (单位mb)。","example":0,"format":"int32","type":"integer"},"average_spill_size":{"description":"若发生下盘,所有dn上下盘的平均数据量 (单位mb) 默认为0。","example":0,"format":"int32","type":"integer"},"backend_start":{"description":"该过程开始的时间,即当客户端连接服务器时。","example":0,"format":"int64","type":"integer"},"block_time":{"description":"语句执行前的阻塞时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"client_address":{"description":"连接到后端的客户端的ip地址。","example":"","type":"string"},"client_hostname":{"description":"客户端的主机名。","example":"","type":"string"},"client_port":{"description":"客户端用于与后端通讯的tcp端口号。","example":"","type":"string"},"control_group":{"description":"语句所使用的cgroup。","example":"","type":"string"},"cpu_skew_percent":{"description":"语句在各dn间的cpu时间倾斜率。","example":0,"format":"int32","type":"integer"},"ctime":{"description":"采集时间","example":1699062846000,"format":"int64","type":"integer"},"curr_xact_start":{"description":"启动当前事务的时间,如果没有事务是活跃的,则为null。如果当前查询是首个事务,则这列等同于query_start列。","example":0,"format":"int64","type":"integer"},"db_name":{"description":"数据库名称。","example":"postgres","type":"string"},"dntime_skew_percent":{"description":"语句在各dn间的执行时间倾斜率。","example":0,"format":"int32","type":"integer"},"duration":{"description":"语句已经执行的时间 (单位ms)。","format":"int64","type":"integer"},"elapsed_time":{"description":"到目前为止的执行时间。","example":0,"format":"int64","type":"integer"},"enqueue":{"description":"工作负载管理资源状态。","example":"","type":"string"},"estimate_left_time":{"description":"语句执行预估剩余时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"estimate_memory":{"description":"语句预估使用内存 (单位mb)。","example":0,"format":"int32","type":"integer"},"estimate_total_time":{"description":"语句执行预估总时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"inst_name":{"description":"实例名称。","example":"cn_5002","type":"string"},"iops_skew_percent":{"description":"语句在dn间的io倾斜率。","example":0,"format":"int32","type":"integer"},"job_inst":{"description":"这个值是从query_band的字段中取出来的,位置1。","example":"","type":"string"},"job_name":{"description":"这个值是从query_band的字段中取出来的,位置0。","example":"","type":"string"},"lane":{"description":"快慢车道 (fast or slow)。","example":"","type":"string"},"max_cpu_time":{"description":"语句在所有dn上的最大cpu时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"max_dn_time":{"description":"语句在所有dn上的最大执行时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"max_peak_iops":{"description":"语句在所有dn上的每秒最大io峰值(列存单位是次/s,行存单位是万次/s)。","example":0,"format":"int32","type":"integer"},"max_peak_memory":{"description":"语句在所有dn上的最大内存峰值 (单位mb)。","example":0,"format":"int32","type":"integer"},"max_spill_size":{"description":"若发生下盘,所有dn上下盘的最大数据量 (单位mb) 默认为0。","example":0,"format":"int32","type":"integer"},"memory_skew_percent":{"description":"语句在各dn间的内存使用倾斜率。","example":0,"format":"int32","type":"integer"},"min_cpu_time":{"description":"语句在所有dn上的最小cpu时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"min_dn_time":{"description":"语句在所有dn上的最小执行时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"min_peak_iops":{"description":"语句在所有dn上的每秒最小io峰值(列存单位是次/s,行存单位是万次/s)。","example":0,"format":"int32","type":"integer"},"min_peak_memory":{"description":"语句在所有dn上的最小内存峰值 (单位mb)。","example":0,"format":"int32","type":"integer"},"min_spill_size":{"description":"若发生下盘,所有dn上下盘的最小数据量 (单位mb) 默认为0。","example":0,"format":"int32","type":"integer"},"pid":{"description":"会话id。","example":140535026615872,"type":"string"},"priority":{"description":"job在资源池中的优先级,取值:1,2,4,8(rush、high、medium、low)。","example":null,"type":"string"},"query":{"description":"查询语句。","example":"WLM fetch collect info from data nodes","type":"string"},"query_band":{"description":"用于标示作业类型,可通过guc参数query_band进行设置,默认为空字符串。","example":"","type":"string"},"query_elapsed_time":{"description":"语句当前为止的实际执行时间,(单位:s)。","example":0,"format":"int64","type":"integer"},"query_id":{"description":"语句执行使用的内部query_id。","example":145522562959855061,"type":"string"},"query_plan":{"description":"查询计划。","example":"","type":"string"},"query_start":{"description":"语句执行的开始时间。","example":0,"format":"int64","type":"integer"},"query_status":{"description":"当前查询语句的实时运行状态 (active, idle, idle in transaction, idle in transaction(aborted), fastpath function call, disabled)。","example":"active","type":"string"},"resource_pool":{"description":"用户使用的资源池。","example":"default_pool","type":"string"},"spill_info":{"description":"语句在所有dn上的下盘信息。","example":"","type":"string"},"spill_skew_percent":{"description":"若发生下盘,dn间下盘倾斜率。","example":0,"format":"int32","type":"integer"},"start_time":{"description":"语句执行的开始时间。","example":0,"format":"int64","type":"integer"},"state_change":{"description":"上次状态改变的时间。","example":0,"format":"int64","type":"integer"},"system_query":{"description":"是否系统查询。","example":false,"type":"boolean"},"total_cpu_time":{"description":"语句在所有dn上的cpu总时间 (单位ms)。","example":0,"format":"int64","type":"integer"},"user_name":{"description":"连接到后端的用户名。","example":"Ruby","type":"string"},"virtual_cluster_id":{"description":"虚拟集群ID","example":0,"format":"int32","type":"integer"},"waiting":{"description":"如果后台当前正等待锁则为true。","example":false,"type":"boolean"},"warning":{"description":"主要显示如下几类告警信息以及sql自诊断调优相关告警。","example":"","type":"string"},"wlm_attrib":{"description":"语句的属性 (ordinary, simple, complicated, internal)","example":"","type":"string"},"wlm_status":{"description":"当前查询语句在资源池上的运行状态 (pending, running, finished, aborted, active, unknown)。","example":"","type":"string"}},"type":"object"},"ListQueriesRep":{"properties":{"code":{"description":"响应码。","format":"int32","type":"integer"},"count":{"description":"总条数。","format":"int32","type":"integer"},"data":{"$ref":"#/definitions/ListQueriesData","description":"响应数据。"},"msg":{"description":"响应信息。","type":"string"}},"type":"object"},"ListQueriesRequestBody":{"properties":{"cluster_id":{"description":"集群ID。","type":"string"},"conditions":{"description":"查询条件数组","items":{"$ref":"#/definitions/ListQueriesCondition"},"type":"array"},"limit":{"description":"每页显示的条目数量。","type":"string"},"offset":{"description":"偏移量,表示从此偏移量开始查询,offset>=0。","type":"string"},"order_by":{"description":"排序字段","type":"string"},"project_id":{"description":"项目ID。","type":"string"},"target":{"description":"固定值db_queries","type":"string"}},"required":["cluster_id","project_id","offset","limit","conditions","target"],"type":"object"},"ListQueriesStatus":{"properties":{"average_query_waiting_time":{"description":"平均查询等待时间。","format":"double","type":"number"},"average_time_consumption_of_queries":{"description":"平均查询耗时。","format":"double","type":"number"},"average_time_consumption_of_sessions":{"description":"平均会话耗时。","format":"double","type":"number"},"queries_count":{"description":"查询数量。","format":"int64","type":"integer"},"session_count":{"description":"会话数量。","format":"int64","type":"integer"}},"type":"object"}},"description":null,"group_id":"b886262c55704cd0bb59f02cc32eca0c","host":"dws.cn-north-4.myhuaweicloud.com","id":"24dc0f80d68044b088c242228e4573d5","info_version":"v2","method":"post","name":"ListQueries","parameters":{},"paths":{"/v2/{project_id}/clusters/{cluster_id}/dms/queries":{"post":{"deprecated":false,"description":"该接口用于查询实时SQL列表。","operationId":"ListQueries","parameters":[{"description":"项目ID。","in":"path","name":"project_id","required":true,"type":"string"},{"description":"集群ID。","in":"path","name":"cluster_id","required":true,"type":"string"},{"description":"参数请求体","in":"body","name":"ListQueriesRequestBody","required":true,"schema":{"$ref":"#/definitions/ListQueriesRequestBody"}}],"responses":{"200":{"description":"","examples":{"application/json":{"code":0,"count":0,"data":{"queries":[{"application_name":"workload","average_dn_time":0,"average_peak_iops":0,"average_peak_memory":0,"average_spill_size":0,"backend_start":1698998138,"block_time":0,"client_address":"","client_hostname":"","client_port":"","control_group":"","cpu_skew_percent":0,"ctime":1699062726000,"curr_xact_start":1699062726,"db_name":"postgres","dntime_skew_percent":0,"duration":0,"elapsed_time":64585,"enqueue":"","estimate_left_time":0,"estimate_memory":0,"estimate_total_time":0,"inst_name":"cn_5002","iops_skew_percent":0,"job_inst":"","job_name":"","lane":"","max_cpu_time":0,"max_dn_time":0,"max_peak_iops":0,"max_peak_memory":0,"max_spill_size":0,"memory_skew_percent":0,"min_cpu_time":0,"min_dn_time":0,"min_peak_iops":0,"min_peak_memory":0,"min_spill_size":0,"pid":"140535026615872","priority":null,"query":"WLM fetch collect info from data nodes","query_band":"","query_elapsed_time":-1,"query_id":"145522562959854219","query_plan":null,"query_start":1698998142,"query_status":"active","resource_pool":"default_pool","spill_info":"","spill_skew_percent":0,"start_time":0,"state_change":1698998142,"system_query":true,"total_cpu_time":0,"user_name":"Ruby","virtual_cluster_id":0,"waiting":false,"warning":"","wlm_attrib":"","wlm_status":""}],"status":{"average_query_waiting_time":0,"average_time_consumption_of_queries":48799.8,"average_time_consumption_of_sessions":51297.58,"queries_count":19,"session_count":19}},"msg":"OK"}},"schema":{"$ref":"#/definitions/ListQueriesRep"}},"400":{"description":"请求错误。"},"401":{"description":"鉴权失败。"},"403":{"description":"没有操作权限。"},"404":{"description":"找不到资源。"},"500":{"description":"服务内部错误。"},"503":{"description":"服务不可用。"}},"summary":"查询SQL列表","tags":["主机监控"],"x-constraint":"","x-ctc":"Y","x-ei-general-ai-release-status":"","x-fusioncloud":"","x-hc":"Y","x-hk":"Y","x-is-registered":"Y","x-name":"查询SQL列表","x-obc":"Y","x-otc":"Y","x-request-examples-1":{"cluster_id":"cluster_id","conditions":[{"field":"userName","operator":"=","value":"用户名称"},{"field":"applicationName","operator":"<>","value":"应用名称"},{"field":"dbName","operator":"=","value":"数据库名称"},{"field":"resourcePool","operator":"<>","value":"资源池"},{"field":"queryStatus","operator":"=","value":"查询状态"},{"field":"enqueue","operator":"<>","value":"排队状态"},{"field":"lane","operator":"=","value":"快慢车道"},{"field":"instName","operator":"<>","value":"接入CN"},{"field":"pid","operator":"=","value":"会话ID"},{"field":"blockTime","operator":"=","value":"1"},{"field":"duration","operator":"<>","value":"2"},{"field":"minCpuTime","operator":">","value":"3"},{"field":"maxCpuTime","operator":"<","value":"4"},{"field":"totalCpuTime","operator":">=","value":"5"},{"field":"cpuSkewPercent","operator":"<=","value":"6"},{"field":"spillInfo","operator":"=","value":"dn下盘信息"},{"field":"minSpillSize","operator":"<>","value":"7"},{"field":"maxSpillSize","operator":">","value":"8"},{"field":"averageSpillSize","operator":"<","value":"9"},{"field":"spillSkewPercent","operator":">=","value":"10"},{"field":"queryBand","operator":"<>","value":"作业类型"},{"field":"jobName","operator":"=","value":"任务名称"},{"field":"jobInst","operator":"<>","value":"任务实例"},{"field":"clientHostname","operator":"=","value":"主机名称"},{"field":"clientPort","operator":"<>","value":"TCP端口"},{"field":"waiting","operator":"=","value":"是否等待"},{"field":"estimateTotalTime","operator":"=","value":"11"},{"field":"estimateLeftTime","operator":"<>","value":"12"},{"field":"controlGroup","operator":"like","value":"cgroup"},{"field":"minPeakMemory","operator":"=","value":"13"},{"field":"maxPeakMemory","operator":"<>","value":"14"},{"field":"averagePeakMemory","operator":">","value":"15"},{"field":"memorySkewPercent","operator":"<","value":"16"},{"field":"estimateMemory","operator":">=","value":"17"},{"field":"minDnTime","operator":"<=","value":"18"},{"field":"maxDnTime","operator":"=","value":"19"},{"field":"averageDnTime","operator":"<>","value":"20"},{"field":"dntimeSkewPercent","operator":">","value":"21"},{"field":"warning","operator":"=","value":"告警"},{"field":"averagePeakIops","operator":"<>","value":"22"},{"field":"iopsSkewPercent","operator":">","value":"23"},{"field":"wlmStatus","operator":"=","value":"语句运行状态"},{"field":"wlmAttrib","operator":"not like","value":"语句属性"}],"limit":1,"offset":0,"order_by":"duration asc","project_id":"project_id","target":"db_queries"},"x-request-examples-text-1":{"cluster_id":"cluster_id","conditions":[{"field":"userName","operator":"=","value":"用户名称"},{"field":"applicationName","operator":"<>","value":"应用名称"},{"field":"dbName","operator":"=","value":"数据库名称"},{"field":"resourcePool","operator":"<>","value":"资源池"},{"field":"queryStatus","operator":"=","value":"查询状态"},{"field":"enqueue","operator":"<>","value":"排队状态"},{"field":"lane","operator":"=","value":"快慢车道"},{"field":"instName","operator":"<>","value":"接入CN"},{"field":"pid","operator":"=","value":"会话ID"},{"field":"blockTime","operator":"=","value":"1"},{"field":"duration","operator":"<>","value":"2"},{"field":"minCpuTime","operator":">","value":"3"},{"field":"maxCpuTime","operator":"<","value":"4"},{"field":"totalCpuTime","operator":">=","value":"5"},{"field":"cpuSkewPercent","operator":"<=","value":"6"},{"field":"spillInfo","operator":"=","value":"dn下盘信息"},{"field":"minSpillSize","operator":"<>","value":"7"},{"field":"maxSpillSize","operator":">","value":"8"},{"field":"averageSpillSize","operator":"<","value":"9"},{"field":"spillSkewPercent","operator":">=","value":"10"},{"field":"queryBand","operator":"<>","value":"作业类型"},{"field":"jobName","operator":"=","value":"任务名称"},{"field":"jobInst","operator":"<>","value":"任务实例"},{"field":"clientHostname","operator":"=","value":"主机名称"},{"field":"clientPort","operator":"<>","value":"TCP端口"},{"field":"waiting","operator":"=","value":"是否等待"},{"field":"estimateTotalTime","operator":"=","value":"11"},{"field":"estimateLeftTime","operator":"<>","value":"12"},{"field":"controlGroup","operator":"like","value":"cgroup"},{"field":"minPeakMemory","operator":"=","value":"13"},{"field":"maxPeakMemory","operator":"<>","value":"14"},{"field":"averagePeakMemory","operator":">","value":"15"},{"field":"memorySkewPercent","operator":"<","value":"16"},{"field":"estimateMemory","operator":">=","value":"17"},{"field":"minDnTime","operator":"<=","value":"18"},{"field":"maxDnTime","operator":"=","value":"19"},{"field":"averageDnTime","operator":"<>","value":"20"},{"field":"dntimeSkewPercent","operator":">","value":"21"},{"field":"warning","operator":"=","value":"告警"},{"field":"averagePeakIops","operator":"<>","value":"22"},{"field":"iopsSkewPercent","operator":">","value":"23"},{"field":"wlmStatus","operator":"=","value":"语句运行状态"},{"field":"wlmAttrib","operator":"not like","value":"语句属性"}],"limit":1,"offset":0,"order_by":"duration asc","project_id":"project_id","target":"db_queries"},"x-request-examples-url-1":"https://{Endpoint}/v2/{project_id}/clusters/{cluster_id}/dms/queries ","x-scope":"Commercial","x-source":"","x-support-sdk":"Y","x-tlf":"Y"}}},"product_short":"DWS","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"查询SQL列表","tags":"主机监控","uri":null,"version":"2.0"}