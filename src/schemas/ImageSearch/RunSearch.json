{"base_path":null,"components":null,"consumes":"[\"application/json\"]","definitions":{"ErrorResponse":{"properties":{"error_code":{"description":"请求失败时的错误编码,请求成功时无此字段。","type":"string"},"error_msg":{"description":"请求失败时的错误信息,请求成功时无此字段。","type":"string"}},"type":"object"},"ItemSource":{"description":"数据的元信息,不同数据包含的字段可能不同。","properties":{"custom_num_tags":{"additionalProperties":{"format":"double","type":"number"},"description":"数据自定义数值标签。","type":"object"},"custom_tags":{"additionalProperties":{"type":"string"},"description":"数据自定义字符标签。","type":"object"},"desc":{"description":"数据描述信息。","type":"string"},"keywords":{"description":"数据关键词列表。","items":{"type":"string"},"type":"array"}},"type":"object"},"RangeParam":{"description":"数值范围参数结构体。","properties":{"from":{"description":"数值下界,默认包含该下界。","format":"double","type":"number"},"to":{"description":"数值上界,默认包含该上界。","format":"double","type":"number"}},"type":"object"},"SearchAfterParam":{"description":"最后一个结果的排序信息,用于全量召回场景。\n- 目前仅KEYWORD搜索和条件检查支持全量召回。","properties":{"id":{"description":"结果的唯一ID。","type":"string"},"score":{"description":"结果的得分。","format":"double","type":"number"}},"type":"object"},"SearchInfo":{"description":"搜索结果的相关信息。","properties":{"last_item":{"$ref":"#/definitions/SearchAfterParam","description":"最后一个搜索结果的排序信息。仅对全量召回生效,非全量召回场景返回null。"},"return_num":{"description":"返回结果总数。","format":"int32","type":"integer"},"search_time":{"description":"搜索过程耗时,单位为毫秒。","format":"int32","type":"integer"},"total_num":{"description":"搜索结果总数。","format":"int32","type":"integer"}},"type":"object"},"SearchItem":{"description":"搜索结果参数结构体。","properties":{"id":{"description":"数据唯一ID。","type":"string"},"score":{"description":"数据匹配分数。","format":"double","type":"number"},"source":{"$ref":"#/definitions/ItemSource"}},"type":"object"},"SearchOptionalParam":{"description":"搜索的可选参数,其中每个参数仅对部分服务类型生效,具体可参见服务类型说明。","properties":{"box":{"description":"目标矩形框坐标,如给定则不进行目标检测,直接使用该box作为目标。格式为“x1,y1,x2,y2”(无空格),x1/y1为目标左上角坐标,x2/y2为目标右下角坐标,具体要求如下:\n- 0 <= x1 < x2 <= width,默认要求x2-x1 >= 15,具体可参考服务类型说明。\n- 0 <= y1 < y2 <= height,默认要求y2-y1 >= 15,具体可参考服务类型说明。","type":"string"},"category":{"description":"对象类目,如给定则不进行对象分类,直接使用该category作为类目。具体类目信息可参见对应的服务类型说明。","format":"int32","type":"integer"},"collapse_key":{"description":"去重标签名,必须为服务实例custom_tags中已存在的key。\n- 如给定则会对该key下相同value的数据进行去重,仅保留得分最高的数据。\n- 针对没有设置该标签的数据,会直接过滤。","type":"string"},"do_cls":{"default":true,"description":"是否进行对象分类,默认为true。","type":"boolean"},"do_det":{"default":true,"description":"是否进行目标检测,默认为true。","type":"boolean"},"max_scan_num":{"description":"扫描节点上限。值越大精度越高,查询速度变慢。默认值为10000。","format":"int32","maximum":100000,"minimum":1000,"type":"integer"},"nprobe":{"description":"查询考察中心点的数目。值越大精度越高,查询速度变慢。默认值为100。","format":"int32","maximum":100000,"minimum":1,"type":"integer"}},"type":"object"},"SearchParam":{"properties":{"custom_num_tags":{"additionalProperties":{"$ref":"#/definitions/RangeParam"},"description":"自定义数值标签,用于对搜索结果进行条件过滤。格式为键值对{key:value}。\n- key: 必须为服务实例custom_num_tags中已存在的key,可在创建服务实例时进行配置,或在更新服务实例时进行新增。针对没有设置该数值标签的数据,会直接过滤。\n- value: 标签值的取值范围,标签值在给定的取值范围内即视为符合条件。","type":"object"},"custom_tags":{"additionalProperties":{"items":{"description":"自定义字符标签值","maxLength":64,"minLength":1,"type":"string"},"maxItems":32,"minItems":1,"type":"array"},"description":"自定义字符标签,用于对搜索结果进行条件过滤。格式为键值对{key:value}。\n- key: 必须为服务实例custom_tags中已存在的key,可在创建服务实例时进行配置,或在更新服务实例时进行新增。\n- value: 标签值列表,列表内多个标签值为“或”关系,即满足一个即可。列表长度范围为[1, 32],标签值类型为字符串,字符长度范围为[1, 64]。","type":"object"},"image_base64":{"description":"图像文件的base64字符串,基于图像搜索时,与image_url二选一。要求如下:\n- 格式:目前仅支持JPEG/JPG/PNG/BMP/WEBP格式的图像。\n- 大小:图像文件大小要求不超过5M。\n- 尺寸:默认情况下,要求图像的最短边大于64px,最长边小于4096px。部分服务类型有特殊要求,可参见服务类型说明。\n- 其他:图片中不能包含旋转信息。","type":"string"},"image_url":{"description":"图像文件的服务可访问URL,字符长度范围为[1, 4096]。基于图像搜索时,与image_base64二选一。","maxLength":4096,"minLength":1,"type":"string"},"keywords":{"description":"关键词列表,搜索时关键词数量范围为[1, 10],关键词字符长度范围为[1, 64]。使用KEYWORD搜索类型进行搜索时,必须提供该参数。","items":{"maxLength":64,"minLength":1,"type":"string"},"maxItems":10,"minItems":1,"type":"array"},"last_item":{"$ref":"#/definitions/SearchAfterParam","description":"前一次搜索的最后一个搜索结果的排序信息。仅对全量召回场景生效,可将上一次搜索返回结果中的last_item字段直接用于此处。\n- 目前仅有KEYWORD支持全量召回。\n- 使用全量召回时,offset必须为0。"},"limit":{"default":10,"description":"返回搜索结果的数量,默认为10,取值范围为[1, 100]。","format":"int32","maximum":100,"minimum":1,"type":"integer"},"min_score":{"description":"返回搜索结果的最小得分,用于对搜索结果进行score过滤,取值范围为[0, 1]。\n- 目前仅对IMAGE/CATEGORY搜索类型生效。","format":"double","maximum":1,"minimum":0,"type":"number"},"offset":{"default":0,"description":"返回搜索结果的偏移量,即返回序号在[offset, offset+limit]内的搜索结果。默认为0,取值范围为[0, N]。\n- 默认情况下,搜索要求offset+limit <= 1000。\n- 针对支持全量召回的场景,使用全量召回时,要求offset必须为0。","format":"int32","minimum":0,"type":"integer"},"optional_params":{"$ref":"#/definitions/SearchOptionalParam"},"search_type":{"description":"搜索类型,必须为服务实例支持的搜索类型。服务实例的搜索类型列表可在创建服务实例时进行配置。\n> 可以使用枚举名或者枚举值(例如IMAGE/0),枚举值可能会变动,建议使用枚举名。","enum":["IMAGE","KEYWORD","CATEGORY"],"type":"string"}},"required":["search_type"],"type":"object"},"SearchResponse":{"properties":{"data":{"$ref":"#/definitions/SearchRestInfo"},"result":{"description":"搜索完成返回success。","type":"string"}},"type":"object"},"SearchRestInfo":{"description":"搜索的相关信息。","properties":{"image_info":{"description":"搜索图像的相关信息,不同服务类型返回信息不同,具体可参见服务类型说明。","properties":{"box":{"description":"用于搜索的主体目标框。","type":"string"},"category":{"description":"用于搜索的主体类目序号。","format":"int32","type":"integer"},"category_name":{"description":"用于搜索的主体类目名称。","type":"string"},"objects":{"description":"搜索图像中的所有主体列表。","items":{"properties":{"box":{"description":"主体目标框。","type":"string"},"category":{"description":"主体类目序号。","format":"int32","type":"integer"},"category_name":{"description":"主体类目名称。","type":"string"}}},"type":"array"}}},"items":{"description":"搜索结果列表。","items":{"$ref":"#/definitions/SearchItem"},"type":"array"},"search_info":{"$ref":"#/definitions/SearchInfo"}},"type":"object"}},"description":null,"group_id":"066e5d262ff9447f8d9790f171b1c42a","host":"mms.cn-north-4.myhuaweicloud.com","id":"dde3799a08794c00a5c6ea285f7dc57a","info_version":"v2","method":"post","name":"RunSearch","parameters":{},"paths":{"/v2/{project_id}/mms/{service_name}/search":{"post":{"description":"从指定服务实例中进行搜索。","operationId":"RunSearch","parameters":[{"description":"服务实例所属的项目ID,登陆华为云->用户中心->我的凭证->API凭证,即可查看对应区域的项目ID。","in":"path","name":"project_id","required":true,"type":"string"},{"description":"服务实例的名称,用户创建服务实例时指定。","in":"path","name":"service_name","required":true,"type":"string"},{"description":"搜索的请求body参数。","in":"body","name":"searchParam","required":true,"schema":{"$ref":"#/definitions/SearchParam"}}],"responses":{"200":{"description":"搜索的响应body参数。","examples":{"application/json":{"data":{"image_info":{"box":"26,223,771,704","category":11,"category_name":"electronics","objects":[{"box":"26,223,771,704","category":11,"category_name":"electronics"},{"box":"55,66,420,315","category":0,"category_name":"others"}]},"items":[{"id":"electronics_01","score":1,"source":{"custom_num_tags":{"year":2022},"custom_tags":{"brand":"HUAWEI"},"desc":"行摄天地,纵横自然,我心宇宙"}}],"search_info":{"return_num":1,"search_time":512,"total_num":10}},"result":"success"}},"schema":{"$ref":"#/definitions/SearchResponse"}},"400":{"description":"BAD REQUEST","examples":{"application/json":{"error_code":"MMS.0003","error_msg":"Invalid parameter: custom_tags"}},"schema":{"$ref":"#/definitions/ErrorResponse"}},"403":{"description":"FORBIDDEN","examples":{"application/json":{"error_code":"MMS.0001","error_msg":"Request is unauthorized."}},"schema":{"$ref":"#/definitions/ErrorResponse"}},"500":{"description":"INTERNAL SERVER ERROR","examples":{"application/json":{"error_code":"MMS.1015","error_msg":"Process INDEX failed."}},"schema":{"$ref":"#/definitions/ErrorResponse"}}},"summary":"搜索","tags":["搜索"],"x-apiexplorer-hide":"N","x-is-registered":"Y","x-request-examples-1":{"custom_num_tags":{"year":{"from":2020,"to":2022}},"custom_tags":{"brand":["HUAWEI"]},"image_base64":"/9j/4AAQSkZJRgABAgEASABIAAD/4RFZRXhpZgAATU0AKgAAAAgABwESAAMAAAABAAEAAAEaAAUAAAABAAAAYgEbAA...","search_type":"CATEGORY"},"x-request-examples-description-1":"搜索商品图像,使用图像BASE64编码","x-request-examples-url-1":"POST https://{endpoint}/v2/{project_id}/mms/{service_name}/search","x-support-sdk":"Y"}}},"product_short":"ImageSearch","region_id":"cn-north-4","schemes":["HTTPS"],"security_definitions":null,"summary":"搜索","tags":"搜索","uri":null,"version":"2.0"}